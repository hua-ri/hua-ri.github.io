<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="google-site-verification" content="TZE0rZyIqLl10trYu3BWBWa1Vmz6HFwhb2OcNEK4u-s" />
     <link rel="shortcut icon" href= /img/favicon.ico >
    <title>
        花日の博客
    </title>
    <meta name="description" content= 嘿，我是花日，这是我的博客。欢迎访问！ >
    <meta name="keywords" content=  >
    
<link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>
<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-home
 replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            Kustomize与Helm对比
        </p>
        <hr>
    </div>
    <div class="post-content">
        <h1 id="0、前言"><a href="#0、前言" class="headerlink" title="0、前言"></a>0、前言</h1><p>K8s 是一个开源容器编排平台，可自动执行容器化应用程序的部署、扩展和管理。近年来，K8s 已成为采用云原生架构和容器化技术的组织的标准。</p>
<p>但是由于K8s的复杂性，所以很多公司以及开源组织都在开发相关的工具来简化k8s的使用门槛，这其中就包括两个很优秀的开源工具，Kustomize<br>（K8s 的配置管理器）和Helm （K8s 的包管理器）。</p>
<p>本文将针对二者来进行对比。</p>
<table>
<thead>
<tr>
<th></th>
<th>Kustomize</th>
<th>Helm</th>
</tr>
</thead>
<tbody><tr>
<td>操作方法</td>
<td>overlays</td>
<td>templating</td>
</tr>
<tr>
<td>使用成本</td>
<td>简单</td>
<td>复杂</td>
</tr>
<tr>
<td>是否支持封装</td>
<td>简单</td>
<td>是</td>
</tr>
<tr>
<td>kubectl集成</td>
<td>是</td>
<td>否</td>
</tr>
<tr>
<td>kubectl集成</td>
<td>声明式</td>
<td>命令式</td>
</tr>
</tbody></table>
<h1 id="1、Kustomize"><a href="#1、Kustomize" class="headerlink" title="1、Kustomize"></a>1、Kustomize</h1><p>Kustomize 是 k8s集群的配置定制工具。它允许管理员使用非模板文件进行声明性更改，而不影响原始清单文件。</p>
<p>来看一下kubebuilder生成项目的Kustomize配置，以&#x2F;config&#x2F;crd目录为例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">├── crd</span><br><span class="line">│   ├── bases</span><br><span class="line">│   │   └── apps.kubenode.alibaba-inc.com_myapps.yaml</span><br><span class="line">│   ├── kustomization.yaml</span><br><span class="line">│   ├── kustomizeconfig.yaml</span><br><span class="line">│   └── patches</span><br><span class="line">│       ├── cainjection_in_myapps.yaml</span><br><span class="line">│       └── webhook_in_myapps.yaml</span><br></pre></td></tr></table></figure>

<p>其中config&#x2F;crd目录是执行<code>kubebuilder create api</code>后生成的，最原始的目录结构是：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">├── crd</span><br><span class="line">│   ├── kustomization.yaml</span><br><span class="line">│   └── kustomizeconfig.yaml</span><br></pre></td></tr></table></figure>

<p>所以bases子目录和patches子目录都是执行<code>make manifests</code>后生成的。</p>
<p>执行<code>kubebuilder create api</code>可以参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41004932/article/details/142702284">https://blog.csdn.net/qq_41004932/article/details/142702284</a></p>
<p>执行<code>make manifests</code>可以参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41004932/article/details/142703870">https://blog.csdn.net/qq_41004932/article/details/142703870</a></p>
<p>在 Kubebuilder 生成的项目中，config&#x2F;crd 目录下的文件主要用于管理和配置自定义资源定义（Custom Resource Definitions, CRDs）。这些文件通过 Kustomize 工具进行管理，以便于在不同的环境中部署和管理 CRDs。下面是每个文件的作用解释：</p>
<ol>
<li>bases 目录<br>bases&#x2F;apps.kubenode.alibaba-inc.com_myapps.yaml:<br>这个文件包含了自定义资源定义（CRD）的 YAML 描述。它定义了你的自定义资源（Custom Resource, CR）的结构和元数据。<br>例如，如果我们创建了一个名为 MyApp 的自定义资源，这个文件将描述 MyApp 的 API 版本、资源名称、字段等。</li>
<li>kustomization.yaml:<br>这个文件是 Kustomize 的配置文件，用于定义如何组合和修改 Kubernetes 资源文件。<br>它指定了哪些资源文件（如 CRD 文件）需要被应用，并且可以包含补丁文件和其他配置选项。<br>例如，它可以指定 bases 目录中的 CRD 文件，以及 patches 目录中的补丁文件。</li>
<li>kustomizeconfig.yaml:<br>这个文件通常用于配置 Kustomize 的一些高级选项，但在这个上下文中可能不是必需的。它可能会包含一些特定的配置项，用于定制 Kustomize 的行为。<br>在大多数情况下，这个文件可能不需要手动编辑。</li>
<li>patches&#x2F;cainjection_in_myapps.yaml:<br>这个文件是一个补丁文件，用于在 CRD 上应用 Webhook 注入（例如，证书注入）。<br>例如，如果你的 CRD 需要与 mutating 或 validating webhooks 一起工作，这个补丁文件会确保 Webhook 配置正确地注入到 CRD 中。</li>
<li>patches&#x2F;webhook_in_myapps.yaml:<br>这个文件也是一个补丁文件，用于在 CRD 上应用 Webhook 配置。<br>例如，它可能会添加或修改 Webhook 的配置，以便在创建或更新自定义资源时触发特定的行为。</li>
</ol>
<p>总结</p>
<p>bases 目录：包含 CRD 的基本定义文件。</p>
<p>kustomization.yaml：Kustomize 的配置文件，用于定义如何组合和修改资源文件。</p>
<p>kustomizeconfig.yaml：Kustomize 的高级配置文件（可选）。</p>
<p>patches 目录：包含用于修改 CRD 的补丁文件，通常用于注入 Webhook 配置。</p>
<p>如果我们像让这个crd根据不同的环境做针对性部署的，例如下面的目录结构:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">├── crd</span><br><span class="line">│   ├── bases</span><br><span class="line">│   │   └── apps.kubenode.alibaba-inc.com_myapps.yaml</span><br><span class="line">│   ├── development</span><br><span class="line">│   │   ├── kustomization.yaml</span><br><span class="line">│   │   └── patches</span><br><span class="line">│   │       └── webhook_in_myapps.yaml</span><br><span class="line">│   ├── testing</span><br><span class="line">│   │   ├── kustomization.yaml</span><br><span class="line">│   │   └── patches</span><br><span class="line">│   │       └── webhook_in_myapps.yaml</span><br><span class="line">│   ├── production</span><br><span class="line">│   │   ├── kustomization.yaml</span><br><span class="line">│   │   └── patches</span><br><span class="line">│   │       └── webhook_in_myapps.yaml</span><br><span class="line">│   ├── kustomization.yaml</span><br><span class="line">│   ├── kustomizeconfig.yaml</span><br><span class="line">│   └── patches</span><br><span class="line">│       ├── cainjection_in_myapps.yaml</span><br><span class="line">│       └── webhook_in_myapps.yaml</span><br></pre></td></tr></table></figure>

<p>所有自定义规范都包含在 kustomization.yaml 文件中，该文件将规范叠加在现有清单之上以生成资源的自定义版本。</p>
<p>所以我们可以根据这一特性，针对不同的环境，对crd进行定制。</p>
<h1 id="2、Helm"><a href="#2、Helm" class="headerlink" title="2、Helm"></a>2、Helm</h1><p>Helm 是一个能够在 K8s 上打包、部署和管理应用程序的工具，即使是最复杂的 K8s 应用程序它都可以帮助定义，安装和升级，同时Helm 也是 <a target="_blank" rel="noopener" href="https://cncf.io/">CNCF</a> 的毕业项目。<br>这里涉及到了以及关于helm的重要概念：</p>
<ul>
<li>Helm Charts：预先配置yaml的模板，在这里叫Chart，用于描述 K8s 应用程序的yaml和配置</li>
<li>Helm Client：用于与 Helm 交互并管理这些Chart版本的命令行界面</li>
<li>Chart 仓库：管理Chart的仓库，跟Maven的Nexus一个意思，比如在公司环境构建上传，在客户的机房连接到这Chart 仓库下载Chart，并部署到k8s中。</li>
</ul>
<h1 id="2-1-helm示例"><a href="#2-1-helm示例" class="headerlink" title="2.1 helm示例"></a>2.1 helm示例</h1><p>helm的示例需要用到kubectl、helm以及k8s集群，相应的安装参考：</p>
<ul>
<li>mac环境：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41004932/article/details/142684319">https://blog.csdn.net/qq_41004932/article/details/142684319</a></li>
<li>ubuntu环境：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41004932/article/details/142691490">https://blog.csdn.net/qq_41004932/article/details/142691490</a></li>
<li>kind集群：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41004932/article/details/142691490">https://blog.csdn.net/qq_41004932/article/details/142691490</a></li>
</ul>
<p>Helm Charts 是预先配置的 K8s 资源包。Helm Chart 包含部署特定应用程序或服务所需的所有信息，包括 K8s 清单、环境变量和其他配置</p>
<p>目录名称是Chart的名称，如<a target="_blank" rel="noopener" href="https://helm.sh/docs/topics/charts/">Helm 文档</a>所示，我们通过helm create demo命令创建一个Chart，执行完以后，默认会生成一个 nginx 的Chart。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm create demo</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">helm create demo                                                                                                                      [10:33:35]</span></span><br><span class="line">Creating demo</span><br></pre></td></tr></table></figure>

<p>查看目录结构：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── Chart.yaml</span><br><span class="line">├── charts</span><br><span class="line">├── templates</span><br><span class="line">│   ├── NOTES.txt</span><br><span class="line">│   ├── _helpers.tpl</span><br><span class="line">│   ├── deployment.yaml</span><br><span class="line">│   ├── hpa.yaml</span><br><span class="line">│   ├── ingress.yaml</span><br><span class="line">│   ├── service.yaml</span><br><span class="line">│   ├── serviceaccount.yaml</span><br><span class="line">│   └── tests</span><br><span class="line">│       └── test-connection.yaml</span><br><span class="line">└── values.yaml</span><br><span class="line"></span><br><span class="line">3 directories, 10 files</span><br></pre></td></tr></table></figure>

<h2 id="2-2-Chart-yaml"><a href="#2-2-Chart-yaml" class="headerlink" title="2.2 Chart.yaml"></a>2.2 Chart.yaml</h2><p>定义了当前 chart版本，以及描述当前chart用途，其中 name 参数表示 chart 名称，后期上传下载都会用此名称</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v2</span><br><span class="line">name: demo</span><br><span class="line">description: A Helm chart for Kubernetes</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">A chart can be either an <span class="string">&#x27;application&#x27;</span> or a <span class="string">&#x27;library&#x27;</span> chart.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Application charts are a collection of templates that can be packaged into versioned archives</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">to be deployed.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Library charts provide useful utilities or functions for the chart developer. They&#x27;re included as</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a dependency of application charts to inject those utilities and <span class="built_in">functions</span> into the rendering</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pipeline. Library charts <span class="keyword">do</span> not define any templates and therefore cannot be deployed.</span></span><br><span class="line">type: application</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This is the chart version. This version number should be incremented each <span class="keyword">time</span> you make changes</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">to the chart and its templates, including the app version.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Versions are expected to follow Semantic Versioning (https://semver.org/)</span></span><br><span class="line">version: 0.1.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This is the version number of the application being deployed. This version number should be</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">incremented each <span class="keyword">time</span> you make changes to the application. Versions are not expected to</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">follow Semantic Versioning. They should reflect the version the application is using.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">It is recommended to use it with quotes.</span></span><br><span class="line">appVersion: &quot;1.16.0&quot;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-values-yaml"><a href="#2-3-values-yaml" class="headerlink" title="2.3 values.yaml"></a>2.3 values.yaml</h2><p>可变参数，都是在此文件中定义，在yaml模板中引用，比如：image.repository，而引用则通过.Values+变量的名进行引用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Default values <span class="keyword">for</span> demo.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This is a YAML-formatted file.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Declare variables to be passed into your templates.</span></span><br><span class="line"></span><br><span class="line">replicaCount: 1</span><br><span class="line"></span><br><span class="line">image:</span><br><span class="line">  repository: nginx</span><br><span class="line">  pullPolicy: IfNotPresent</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">Overrides the image tag whose default is the chart appVersion.</span></span><br><span class="line">  tag: &quot;&quot;</span><br><span class="line"></span><br><span class="line">imagePullSecrets: []</span><br><span class="line">nameOverride: &quot;&quot;</span><br><span class="line">fullnameOverride: &quot;&quot;</span><br><span class="line"></span><br><span class="line">serviceAccount:</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">Specifies whether a service account should be created</span></span><br><span class="line">  create: true</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">Annotations to add to the service account</span></span><br><span class="line">  annotations: &#123;&#125;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">The name of the service account to use.</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">If not <span class="built_in">set</span> and create is <span class="literal">true</span>, a name is generated using the fullname template</span></span><br><span class="line">  name: &quot;&quot;</span><br><span class="line"></span><br><span class="line">podAnnotations: &#123;&#125;</span><br><span class="line"></span><br><span class="line">podSecurityContext: &#123;&#125;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">fsGroup: 2000</span></span><br><span class="line"></span><br><span class="line">securityContext: &#123;&#125;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">capabilities:</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">  drop:</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">  - ALL</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">readOnlyRootFilesystem: <span class="literal">true</span></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">runAsNonRoot: <span class="literal">true</span></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">runAsUser: 1000</span></span><br><span class="line"></span><br><span class="line">service:</span><br><span class="line">  type: ClusterIP</span><br><span class="line">  port: 80</span><br><span class="line"></span><br><span class="line">ingress:</span><br><span class="line">  enabled: false</span><br><span class="line">  className: &quot;&quot;</span><br><span class="line">  annotations: &#123;&#125;</span><br><span class="line">    # kubernetes.io/ingress.class: nginx</span><br><span class="line">    # kubernetes.io/tls-acme: &quot;true&quot;</span><br><span class="line">  hosts:</span><br><span class="line">    - host: chart-example.local</span><br><span class="line">      paths:</span><br><span class="line">        - path: /</span><br><span class="line">          pathType: ImplementationSpecific</span><br><span class="line">  tls: []</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash"> - secretName: chart-example-tls</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">   hosts:</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">     - chart-example.local</span></span><br><span class="line"></span><br><span class="line">resources: &#123;&#125;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">We usually recommend not to specify default resources and to leave this as a conscious</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">choice <span class="keyword">for</span> the user. This also increases chances charts run on environments with little</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">resources, such as Minikube. If you <span class="keyword">do</span> want to specify resources, uncomment the following</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">lines, adjust them as necessary, and remove the curly braces after <span class="string">&#x27;resources:&#x27;</span>.</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">limits:</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">  cpu: 100m</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">  memory: 128Mi</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">requests:</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">  cpu: 100m</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">  memory: 128Mi</span></span><br><span class="line"></span><br><span class="line">autoscaling:</span><br><span class="line">  enabled: false</span><br><span class="line">  minReplicas: 1</span><br><span class="line">  maxReplicas: 100</span><br><span class="line">  targetCPUUtilizationPercentage: 80</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">targetMemoryUtilizationPercentage: 80</span></span><br><span class="line"></span><br><span class="line">nodeSelector: &#123;&#125;</span><br><span class="line"></span><br><span class="line">tolerations: []</span><br><span class="line"></span><br><span class="line">affinity: &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-4-helpers-tpl"><a href="#2-4-helpers-tpl" class="headerlink" title="2.4 _helpers.tpl"></a>2.4 _helpers.tpl</h2><p>定义通用代码块，然后yaml 文件会通过 include 引用</p>
<p>定义:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;- define &quot;demo.name&quot; -&#125;&#125;</span><br><span class="line">&#123;&#123;- default .Chart.Name .Values.nameOverride | trunc 63 | trimSuffix &quot;-&quot; &#125;&#125;</span><br><span class="line">&#123;&#123;- end &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>引用:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; include &quot;demo.fullname&quot; . &#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-5-templates"><a href="#2-5-templates" class="headerlink" title="2.5 templates"></a>2.5 templates</h2><p>此目录主要存放的是要部署的 yaml文件模板，同时也包含_helpers.tpl文件，模板会引用values.yaml、Chart.yaml定义的参数，以及_helpers.tpl定义的通用代码块</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: &#123;&#123; include &quot;demo.fullname&quot; . &#125;&#125;</span><br><span class="line">  labels:</span><br><span class="line">    &#123;&#123;- include &quot;demo.labels&quot; . | nindent 4 &#125;&#125;</span><br><span class="line">spec:</span><br><span class="line">  &#123;&#123;- if not .Values.autoscaling.enabled &#125;&#125;</span><br><span class="line">  replicas: &#123;&#123; .Values.replicaCount &#125;&#125;</span><br><span class="line">  &#123;&#123;- end &#125;&#125;</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      &#123;&#123;- include &quot;demo.selectorLabels&quot; . | nindent 6 &#125;&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      &#123;&#123;- with .Values.podAnnotations &#125;&#125;</span><br><span class="line">      annotations:</span><br><span class="line">        &#123;&#123;- toYaml . | nindent 8 &#125;&#125;</span><br><span class="line">      &#123;&#123;- end &#125;&#125;</span><br><span class="line">      labels:</span><br><span class="line">        &#123;&#123;- include &quot;demo.selectorLabels&quot; . | nindent 8 &#125;&#125;</span><br><span class="line">    spec:</span><br><span class="line">      &#123;&#123;- with .Values.imagePullSecrets &#125;&#125;</span><br><span class="line">      imagePullSecrets:</span><br><span class="line">        &#123;&#123;- toYaml . | nindent 8 &#125;&#125;</span><br><span class="line">      &#123;&#123;- end &#125;&#125;</span><br><span class="line">      serviceAccountName: &#123;&#123; include &quot;demo.serviceAccountName&quot; . &#125;&#125;</span><br><span class="line">      securityContext:</span><br><span class="line">        &#123;&#123;- toYaml .Values.podSecurityContext | nindent 8 &#125;&#125;</span><br><span class="line">      containers:</span><br><span class="line">        - name: &#123;&#123; .Chart.Name &#125;&#125;</span><br><span class="line">          securityContext:</span><br><span class="line">            &#123;&#123;- toYaml .Values.securityContext | nindent 12 &#125;&#125;</span><br><span class="line">          image: &quot;&#123;&#123; .Values.image.repository &#125;&#125;:&#123;&#123; .Values.image.tag | default .Chart.AppVersion &#125;&#125;&quot;</span><br><span class="line">          imagePullPolicy: &#123;&#123; .Values.image.pullPolicy &#125;&#125;</span><br><span class="line">          ports:</span><br><span class="line">            - name: http</span><br><span class="line">              containerPort: &#123;&#123; .Values.service.port &#125;&#125;</span><br><span class="line">              protocol: TCP</span><br><span class="line">          livenessProbe:</span><br><span class="line">            httpGet:</span><br><span class="line">              path: /</span><br><span class="line">              port: http</span><br><span class="line">          readinessProbe:</span><br><span class="line">            httpGet:</span><br><span class="line">              path: /</span><br><span class="line">              port: http</span><br><span class="line">          resources:</span><br><span class="line">            &#123;&#123;- toYaml .Values.resources | nindent 12 &#125;&#125;</span><br><span class="line">      &#123;&#123;- with .Values.nodeSelector &#125;&#125;</span><br><span class="line">      nodeSelector:</span><br><span class="line">        &#123;&#123;- toYaml . | nindent 8 &#125;&#125;</span><br><span class="line">      &#123;&#123;- end &#125;&#125;</span><br><span class="line">      &#123;&#123;- with .Values.affinity &#125;&#125;</span><br><span class="line">      affinity:</span><br><span class="line">        &#123;&#123;- toYaml . | nindent 8 &#125;&#125;</span><br><span class="line">      &#123;&#123;- end &#125;&#125;</span><br><span class="line">      &#123;&#123;- with .Values.tolerations &#125;&#125;</span><br><span class="line">      tolerations:</span><br><span class="line">        &#123;&#123;- toYaml . | nindent 8 &#125;&#125;</span><br><span class="line">      &#123;&#123;- end &#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">image: &quot;&#123;&#123; .Values.image.repository &#125;&#125;:&#123;&#123; .Values.image.tag | default .Chart.AppVersion &#125;&#125;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="2-5-部署"><a href="#2-5-部署" class="headerlink" title="2.5 部署"></a>2.5 部署</h2><p>如果想部署的话，可以使用下面命令进行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm package helm-demo</span><br></pre></td></tr></table></figure>

<p>可以发现，这里helm是将要部署的资源当作一个整体来进行操作的，也就是讲一个资源的所有yaml配置作为一个整体的形式来进行操作。</p>
<h1 id="3、主要差异"><a href="#3、主要差异" class="headerlink" title="3、主要差异"></a>3、主要差异</h1><h2 id="3-1-操作方法"><a href="#3-1-操作方法" class="headerlink" title="3.1 操作方法"></a>3.1 操作方法</h2><p>Kustomize 依赖特定于目录的kustomization.yaml文件来构建各个资源并对其进行更改。这些文件将补丁和覆盖应用到共享基文件夹中声明的资源，以提供自动化的多环境配置。</p>
<p>Helm 通过引用value.yaml文件作为变量源，使用模板生成有效的 K8s 配置。模板目录托管 Helm Chart在部署期间用于创建资源的文件。</p>
<h2 id="3-2-便捷性"><a href="#3-2-便捷性" class="headerlink" title="3.2 便捷性"></a>3.2 便捷性</h2><p>从K8s 版本 1.14 开始，Kustomize 与 kubectl CLI 捆绑在一起，因此不需要掌握任何其他工具。Kustomize 支持声明式部署，并对每个文件使用纯 YAML，从而更容易使用。</p>
<p>Helm 为K8s包管理任务添加了额外的抽象层，从而加快了希望简化集群配置和发布自动化的团队的学习曲线。Helm Chart 相对Kustomize复杂，不过功能更加强大。</p>
<h2 id="3-3-打包"><a href="#3-3-打包" class="headerlink" title="3.3 打包"></a>3.3 打包</h2><p>Kustomize 缺乏的打包功能，并且每个资源都必须在基本文件夹中声明，并在覆盖kustomization.yaml文件中单独声明变体。</p>
<p>而Helm将所有必需的K8s资源都打包到一个文件夹中，该文件夹可以根据需要重复使用。Helm 还允许设置应用程序默认值，并且使用values.yaml文件修改参数，从而注入引用的 yaml 文件中。</p>
<h2 id="3-4-原生-kubectl-集成"><a href="#3-4-原生-kubectl-集成" class="headerlink" title="3.4 原生 kubectl 集成"></a>3.4 原生 kubectl 集成</h2><p>从 K8s 1.14 版开始，Kustomize 就预装了 kubectl，Helm 并未与 K8s 预先集成，因此必须手动安装 Helm。</p>
<h2 id="3-5-Kustomize-与-Helm-何时使用"><a href="#3-5-Kustomize-与-Helm-何时使用" class="headerlink" title="3.5 Kustomize 与 Helm - 何时使用"></a>3.5 Kustomize 与 Helm - 何时使用</h2><h3 id="3-5-1-何时使用-Kustomize"><a href="#3-5-1-何时使用-Kustomize" class="headerlink" title="3.5.1 何时使用 Kustomize"></a>3.5.1 何时使用 Kustomize</h3><p>Kustomize允许在不改变原始文件的情况下进行精确更改。 因此可以有以下场景</p>
<ul>
<li>应用配置的变体管理：当你需要管理多个环境（例如开发、测试、生产）中应用的变体时，Kustomize 是一个很好的选择。它允许你为不同的环境创建不同的配置，并使用一套基础配置来定义通用部分。</li>
<li>持续集成和持续部署（CI&#x2F;CD）流水线：Kustomize 可以与 CI&#x2F;CD 工具集成，帮助你实现自动化部署。通过在流水线中使用 Kustomize，你可以根据需要生成特定环境的配置，并将其应用到集群中。</li>
</ul>
<h3 id="3-5-2-何时使用-Helm"><a href="#3-5-2-何时使用-Helm" class="headerlink" title="3.5.2 何时使用 Helm"></a>3.5.2 何时使用 Helm</h3><p>Helm 将所有 K8s 对象封装到一个包中，减少了与各个yaml 文件的交互。除此之外，大多数第三方供应商还提供预构建的 Helm 图表，以简化将其产品部署到 K8s 中的过程。因此，Helm 通常是安装现成解决方案（例如监控、数据库和消息中间件等）的首选</p>

    </div>

    
</div>
    <div class="footer" id="footer">
    <p><h4>版权所有 © 2020 | 作者: 花日 | 主题 By <a class="theme-author" target="_blank" rel="noopener" href="https://github.com/Xunzhuo/hexo-theme-coder" style="font-size:14px; color: #969696">Coder</a></h4>
    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <span id="busuanzi_container_site_pv">本站浏览总访问量: <span id="busuanzi_value_site_pv"></span></span>
        <span class="post-meta-divider">|</span>
        <span id="busuanzi_container_site_uv">本站访问人数: <span id="busuanzi_value_site_uv"></span></span>
    
    <label class="el-switch el-switch-blue el-switch-sm" style="vertical-align: sub;">
        <input type="checkbox" name="switch" id="update_style">
        <span class="el-switch-style"></span>
    </label>

    <!--         <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
    document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script> -->
</p>
</div>

<input type="hidden" id="web_style" value="black">
<input type="hidden" id="valine_appid" value="ipUXLgJtbz1bF0aJdxHUCLp0-MdYXbMMI">
<input type="hidden" id="valine_appKey" value="7z2HlZVXXCRLYggFe4GvEqle">

<script src="/libs/jquery.min.js"></script>


<script src="/libs/highlight/highlight.pack.js"></script>

<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>

<script src="/js/js.js"></script>

<style type="text/css">
.v * {
color: #698fca;
}
.v .vlist .vcard .vhead .vsys {
color: #3a3e4a;
}
.v .vlist .vcard .vh .vmeta .vat {
color: #638fd5;
}
.v .vlist .vcard .vhead .vnick {
color: #6ba1ff;
}
.v a {
color: #8696b1;
}
.v .vlist .vcard .vhead .vnick:hover {
color: #669bfc;
}
</style>
    <script type="text/javascript" color="173,174,173" opacity='1' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>
