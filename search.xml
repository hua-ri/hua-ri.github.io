<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Hello World</title>
    <url>/2025/07/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>Ldapé€šè¿‡helméƒ¨ç½²</title>
    <url>/2025/07/devops/ldap/Ldap%E9%80%9A%E8%BF%87helm%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote>
<p>âš¡ï¸: OpenLDAPæ˜¯è½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼ˆLDAPï¼‰çš„å¼€æºå®ç°ï¼Œå®ƒæä¾›äº†ä¸€ç§å­˜å‚¨å’Œè®¿é—®å…³äºç”¨æˆ·ã€ç»„ã€è®¡ç®—æœºå’Œå…¶ä»–èµ„æºçš„ä¿¡æ¯çš„ä¸­å¿ƒåŒ–ç›®å½•æœåŠ¡ã€‚</p>
</blockquote>
<h1 id="å±æ€§ä»‹ç»"><a href="#å±æ€§ä»‹ç»" class="headerlink" title="å±æ€§ä»‹ç»"></a>å±æ€§ä»‹ç»</h1><ul>
<li>cnï¼ˆcommon nameï¼‰ï¼šé€šç”¨åç§°ï¼Œè¡¨ç¤ºä¸€ä¸ªå¯¹è±¡çš„åç§°ã€‚åœ¨ç”¨æˆ·æ¡ç›®ä¸­ï¼Œé€šå¸¸ä¸ç”¨æˆ·çš„å§“åç›¸å¯¹åº”ï¼›åœ¨ç»„æ¡ç›®ä¸­ï¼Œåˆ™ä¸ç»„åç›¸å¯¹åº”ã€‚</li>
<li>ouï¼ˆorganizational unitï¼‰ï¼šç»„ç»‡å•ä½ï¼Œè¡¨ç¤ºä¸€ä¸ªç»„ç»‡æˆ–éƒ¨é—¨ã€‚åœ¨LDAPç›®å½•æœåŠ¡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ouæ¥åˆ›å»ºå¤šçº§ç»„ç»‡ç»“æ„ï¼Œå¹¶å°†ç”¨æˆ·å’Œå…¶ä»–å¯¹è±¡åˆ†é…åˆ°ç›¸åº”çš„ç»„ç»‡å•å…ƒä¸­ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç®¡ç†å®ƒä»¬ã€‚</li>
<li>dcï¼ˆdomain componentï¼‰ï¼šåŸŸç»„ä»¶ï¼Œè¡¨ç¤ºåŸŸåçš„ä¸€éƒ¨åˆ†ã€‚åœ¨LDAPä¸­ï¼ŒåŸŸåé€šå¸¸æ˜¯æŒ‰ç…§å±‚æ¬¡ç»“æ„ç»„ç»‡çš„ï¼Œä¾‹å¦‚ï¼šexample.comå¯ä»¥è¢«æ‹†åˆ†ä¸ºdc&#x3D;example,dc&#x3D;comã€‚è¿™æ ·åšæœ‰åˆ©äºæœ‰æ•ˆåœ°ç»„ç»‡å’Œç®¡ç†å¤§è§„æ¨¡çš„ç›®å½•æœåŠ¡ã€‚</li>
<li>snï¼ˆsurnameï¼‰ï¼šå§“æ°ï¼Œè¡¨ç¤ºä¸€ä¸ªäººçš„å§“æ°ã€‚ä¸cnå±æ€§ä¸åŒï¼Œsnåªè¡¨ç¤ºå§“æ°ï¼Œè€Œä¸”é€šå¸¸ä¸å”¯ä¸€ã€‚</li>
</ul>
<h1 id="kubernetesé›†ç¾¤éƒ¨ç½²"><a href="#kubernetesé›†ç¾¤éƒ¨ç½²" class="headerlink" title="kubernetesé›†ç¾¤éƒ¨ç½²"></a>kubernetesé›†ç¾¤éƒ¨ç½²</h1><p>å‚è€ƒå¿«é€Ÿæ­å»ºkindæµ‹è¯•é›†ç¾¤å¿«é€Ÿæ­å»ºä¸€æœ¬åœ°æµ‹ä½¿ç”¨çš„kindé›†ç¾¤ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>BKCI ç®€ä»‹</title>
    <url>/2025/07/devops/blueking/BKCI%E7%AE%80%E4%BB%8B/</url>
    <content><![CDATA[<h1 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h1><p>BK-CIå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/intro/README.md">https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/intro/README.md</a><br>githubä»“åº“åœ°å€ï¼š<a href="https://github.com/TencentBlueKing/bk-ci">https://github.com/TencentBlueKing/bk-ci</a></p>
<h1 id="å¯¼èˆª"><a href="#å¯¼èˆª" class="headerlink" title="å¯¼èˆª"></a>å¯¼èˆª</h1><table>
<thead>
<tr>
<th>ğŸ¤ äº†è§£åŸºæœ¬æ¦‚å¿µ</th>
<th>ğŸ‘‰ ä½¿ç”¨ BKCI</th>
<th>ğŸš€ éƒ¨ç½² BKCI</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/intro/bkci.md">BKCI æ˜¯ä»€ä¹ˆï¼Ÿ</a></td>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Quickstarts/Create-your-first-pipeline.md">åˆ›å»ºä½ çš„ç¬¬ä¸€æ¡æµæ°´çº¿</a></td>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Setup/system-requirements/hardware.md">BKCI ç¡¬ä»¶è§„æ ¼æŒ‡å—</a></td>
</tr>
<tr>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/intro/terminology/components.md">BKCI ç»„ä»¶</a></td>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Quickstarts/Link-your-first-repo.md">å…³è”ä½ çš„ç¬¬ä¸€ä¸ªä»£ç åº“</a></td>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Setup/system-requirements/system.md">BKCI ç³»ç»Ÿè¦æ±‚</a></td>
</tr>
<tr>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/intro/terminology/Learn-pipeline-in-5min.md">å¿«é€Ÿç†Ÿæ‚‰æµæ°´çº¿</a></td>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Quickstarts/Enable-ci.md">ä¸ºä½ çš„Gitå·¥ç¨‹å¼€å¯CI</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/intro/terminology/Learn-pipeline-in-5min.md">æœ¯è¯­è§£é‡Š</a></td>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Quickstarts/Case/Examples/vars-usage.md">ç¤ºä¾‹</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Developer/rest-api/read-before-use.md">APIæ¥å£</a></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>ğŸ“” äº§å“åŠŸèƒ½</th>
<th>ğŸª ç ”å‘å•†åº—</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Services/Pipeline/pipeline-list.md">æµæ°´çº¿</a></td>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Services/Store/home.md">æµè§ˆç ”å‘å•†åº—</a></td>
</tr>
<tr>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Services/Console/Console.md">æ§åˆ¶å°</a></td>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Services/Store/start-new-task.md">å¼€å‘ä¸€ä¸ªæµæ°´çº¿æ’ä»¶</a></td>
</tr>
<tr>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Services/Ticket/ticket.md">å‡­è¯ç®¡ç†</a></td>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Services/Store/upload-new-task.md">åœ¨ BKCI é‡Œä½¿ç”¨å•†åº—æ’ä»¶</a></td>
</tr>
<tr>
<td><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Services/Pools/host-to-bkci.md">æ„å»ºèµ„æº</a></td>
<td></td>
</tr>
</tbody></table>
<h1 id="ç›¸å…³æ–‡æ¡£"><a href="#ç›¸å…³æ–‡æ¡£" class="headerlink" title="ç›¸å…³æ–‡æ¡£"></a>ç›¸å…³æ–‡æ¡£</h1><p>è“é²¸å­¦ä¹ ç¤¾åŒºï¼š<a href="https://bk.tencent.com/s-mart/communities">https://bk.tencent.com/s-mart/communities</a><br>è“é²¸å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://bk.tencent.com/docs/">https://bk.tencent.com/docs/</a></p>
<p><strong>è“é²¸ä½“ç³»</strong><br>è“é²¸ç®€ä»‹ï¼š<a href="https://bk.tencent.com/docs/markdown/ZH/BlueKingFamily/7.2/UserGuide/intro.md">https://bk.tencent.com/docs/markdown/ZH/BlueKingFamily/7.2/UserGuide/intro.md</a><br>æ ¸å¿ƒä¼˜åŠ¿ï¼š<a href="https://bk.tencent.com/docs/markdown/ZH/BlueKingFamily/7.2/UserGuide/advantages.md">https://bk.tencent.com/docs/markdown/ZH/BlueKingFamily/7.2/UserGuide/advantages.md</a><br>ä½“ç³»æ¶æ„ï¼š<a href="https://bk.tencent.com/docs/markdown/ZH/BlueKingFamily/7.2/UserGuide/Solution/solution.md">https://bk.tencent.com/docs/markdown/ZH/BlueKingFamily/7.2/UserGuide/Solution/solution.md</a><br>CIé¢†åŸŸï¼š<a href="https://bk.tencent.com/docs/markdown/ZH/BlueKingFamily/7.2/UserGuide/Solution/ci_intro.md">https://bk.tencent.com/docs/markdown/ZH/BlueKingFamily/7.2/UserGuide/Solution/ci_intro.md</a><br>CDé¢†åŸŸï¼š<a href="https://bk.tencent.com/docs/markdown/ZH/BlueKingFamily/7.2/UserGuide/Solution/cd_intro.md">https://bk.tencent.com/docs/markdown/ZH/BlueKingFamily/7.2/UserGuide/Solution/cd_intro.md</a><br>COé¢†åŸŸï¼š<a href="https://bk.tencent.com/docs/markdown/ZH/BlueKingFamily/7.2/UserGuide/Solution/co_intro.md">https://bk.tencent.com/docs/markdown/ZH/BlueKingFamily/7.2/UserGuide/Solution/co_intro.md</a></p>
]]></content>
  </entry>
  <entry>
    <title>alicloud_alikafka_instance</title>
    <url>/2025/07/devops/terraform/alicloud_alikafka_instance/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>çº¦å®šæ ¼å¼ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”œâ”€â”€ aliyun                                             # äº‘å‚å•†å®ä¾‹æ–‡ä»¶</span><br><span class="line">â”‚   â””â”€â”€ aliyun_ecs_mod_demo                           # æ¨¡å‹å</span><br><span class="line">â”‚       â””â”€â”€ aliyun_china_platform_7111                # äº‘è´¦å·å</span><br><span class="line">â”‚           â””â”€â”€ ecs_instance_name_20241224121212      # å®ä¾‹å</span><br><span class="line">â”‚               â”œâ”€â”€ backend.tf                        # å®ä¾‹stateæ–‡ä»¶ä¿å­˜è¯´æ˜ï¼šoss</span><br><span class="line">â”‚               â””â”€â”€ main.tf                           # å®ä¾‹å…·ä½“çš„å‚æ•°</span><br><span class="line">â”œâ”€â”€ modules                                            # æ¨¡å‹æ•°æ®æ–‡ä»¶å¤¹</span><br><span class="line">â”‚   â”œâ”€â”€ aliyun                                        # äº‘å‚å•†æ¨¡å‹æ–‡ä»¶å¤¹</span><br><span class="line">â”‚   â”‚   â””â”€â”€ aliyun_ecs_mod_demo                       # æ¨¡å‹å</span><br><span class="line">â”‚   â”‚       â”œâ”€â”€ main.tf                               # æ¨¡å‹å®šä¹‰ä¸»æ–‡ä»¶</span><br><span class="line">â”‚   â”‚       â”œâ”€â”€ outputs.tf                            # æ¨¡å‹å®šä¹‰è¾“å‡ºæ–‡ä»¶</span><br><span class="line">â”‚   â”‚       â””â”€â”€ variables.tf                          # æ¨¡å‹å®šä¹‰å‚æ•°æ–‡ä»¶</span><br><span class="line">â”‚   â””â”€â”€ tenmod                                         # å¦ä¸€ä¸ªäº‘å‚å•†æ¨¡å‹</span><br><span class="line">â””â”€â”€ tenent                                              # å¦ä¸€ä¸ªäº‘å‚å•†å®ä¾‹æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<h1 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ aliyun</span><br><span class="line">â”‚   â””â”€â”€ aliyun_alikafka_demo</span><br><span class="line">â”‚       â””â”€â”€ aliyun_china_pt_7111</span><br><span class="line">â”‚           â””â”€â”€ alikafka_demo_202502061910</span><br><span class="line">â”‚               â”œâ”€â”€ backend.tf</span><br><span class="line">â”‚               â””â”€â”€ main.tf</span><br><span class="line">â””â”€â”€ modules</span><br><span class="line">    â””â”€â”€ aliyun</span><br><span class="line">        â””â”€â”€ aliyun_alikafka_mod_demo</span><br><span class="line">            â”œâ”€â”€ main.tf</span><br><span class="line">            â””â”€â”€ variables.tf</span><br></pre></td></tr></table></figure>

<h2 id="modules"><a href="#modules" class="headerlink" title="modules"></a>modules</h2><h3 id="modules-aliyun-aliyun-alikafka-mod-demo-main-tf"><a href="#modules-aliyun-aliyun-alikafka-mod-demo-main-tf" class="headerlink" title="&#x2F;modules&#x2F;aliyun&#x2F;aliyun_alikafka_mod_demo&#x2F;main.tf"></a>&#x2F;modules&#x2F;aliyun&#x2F;aliyun_alikafka_mod_demo&#x2F;main.tf</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">terraform &#123;</span><br><span class="line">  required_providers &#123;</span><br><span class="line">    alicloud = &#123;</span><br><span class="line">      source  = &quot;aliyun/alicloud&quot;</span><br><span class="line">      version = &quot;1.225.0&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">provider &quot;alicloud&quot; &#123;</span><br><span class="line">  region = var.region</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;alicloud_alikafka_instance&quot; &quot;this&quot; &#123;</span><br><span class="line">  name          = var.instance_name</span><br><span class="line">  deploy_type   = var.deploy_type</span><br><span class="line">  disk_size     = var.disk_size</span><br><span class="line">  disk_type     = var.disk_type</span><br><span class="line">  vswitch_id    = var.vswitch_id</span><br><span class="line">  partition_num = var.partition_num</span><br><span class="line">  io_max        = var.io_max</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="modules-aliyun-aliyun-alikafka-mod-demo-variables-tf"><a href="#modules-aliyun-aliyun-alikafka-mod-demo-variables-tf" class="headerlink" title="&#x2F;modules&#x2F;aliyun&#x2F;aliyun_alikafka_mod_demo&#x2F;variables.tf"></a>&#x2F;modules&#x2F;aliyun&#x2F;aliyun_alikafka_mod_demo&#x2F;variables.tf</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">variable &quot;region&quot; &#123;</span><br><span class="line">  description = &quot;åœ°åŸŸ&quot;</span><br><span class="line">  type        = string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;instance_name&quot; &#123;</span><br><span class="line">  description = &quot;kafkaå®ä¾‹å&quot;</span><br><span class="line">  type        = string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;deploy_type&quot; &#123;</span><br><span class="line">  // - 4: eip/vpc instanceï¼›- 5: vpc instance.</span><br><span class="line">  description = &quot;éƒ¨ç½²ç±»å‹&quot;</span><br><span class="line">  type        = number</span><br><span class="line">  default = 5</span><br><span class="line">  validation &#123;</span><br><span class="line">    condition     = contains([4, 5], var.deploy_type)</span><br><span class="line">    error_message = &quot;The deploy_type must be one of 4, 5&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;disk_size&quot; &#123;</span><br><span class="line">  description = &quot;kafkaå®ä¾‹ç£ç›˜è§„æ ¼&quot;</span><br><span class="line">  type = number</span><br><span class="line">  validation &#123;</span><br><span class="line">    condition     = contains([500, 1000], var.disk_size)</span><br><span class="line">    error_message = &quot;The disk_size must be one of 200, 400&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;disk_type&quot; &#123;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">0: efficient cloud disk , 1: SSD.</span></span><br><span class="line">  description = &quot;ç£ç›˜ç±»å‹&quot;</span><br><span class="line">  type = number</span><br><span class="line">  default = 1</span><br><span class="line">  validation &#123;</span><br><span class="line">    condition     = contains([0, 1], var.disk_type)</span><br><span class="line">    error_message = &quot;The disk_type must be empty, or one of 0, 1&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;vswitch_id&quot; &#123;</span><br><span class="line">  description = &quot;ç»‘å®šè™šæ‹Ÿäº¤æ¢æœºid&quot;</span><br><span class="line">  type = string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;partition_num&quot; &#123;</span><br><span class="line">  description = &quot;åˆ†åŒºæ•°é‡&quot;</span><br><span class="line">  type = number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">variable &quot;io_max&quot; &#123;</span><br><span class="line">  description = &quot;ioçš„æœ€å¤§å€¼&quot;</span><br><span class="line">  type = number</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><h3 id="aliyun-aliyun-alikafka-demo-aliyun-china-pt-7111-alikafka-demo-202502061910-backend-tf"><a href="#aliyun-aliyun-alikafka-demo-aliyun-china-pt-7111-alikafka-demo-202502061910-backend-tf" class="headerlink" title="&#x2F;aliyun&#x2F;aliyun_alikafka_demo&#x2F;aliyun_china_pt_7111&#x2F;alikafka_demo_202502061910&#x2F;backend.tf"></a>&#x2F;aliyun&#x2F;aliyun_alikafka_demo&#x2F;aliyun_china_pt_7111&#x2F;alikafka_demo_202502061910&#x2F;backend.tf</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">terraform &#123;</span><br><span class="line">  backend &quot;oss&quot; &#123;</span><br><span class="line">    endpoint = &quot;oss-cn-hangzhou.aliyuncs.com&quot;</span><br><span class="line">    bucket   = &quot;dz-devops&quot; # æ›¿æ¢ä¸ºä½ çš„ OSS Bucket åç§°</span><br><span class="line">    prefix = &quot;terraform_state//aliyun/aliyun_alikafka_demo/aliyun_china_pt_7111/alikafka_demo_202502061910&quot;</span><br><span class="line">    key      = &quot;terraform.tfstate&quot; # å­˜å‚¨çŠ¶æ€æ–‡ä»¶çš„è·¯å¾„å’Œåç§°</span><br><span class="line">    region   = &quot;cn-hangzhou&quot;       # OSS çš„åœ°åŸŸï¼ˆæ ¹æ®ä½ çš„å®é™…æƒ…å†µè°ƒæ•´ï¼‰</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="aliyun-aliyun-alikafka-demo-aliyun-china-pt-7111-alikafka-demo-202502061910-main-tf"><a href="#aliyun-aliyun-alikafka-demo-aliyun-china-pt-7111-alikafka-demo-202502061910-main-tf" class="headerlink" title="&#x2F;aliyun&#x2F;aliyun_alikafka_demo&#x2F;aliyun_china_pt_7111&#x2F;alikafka_demo_202502061910&#x2F;main.tf"></a>&#x2F;aliyun&#x2F;aliyun_alikafka_demo&#x2F;aliyun_china_pt_7111&#x2F;alikafka_demo_202502061910&#x2F;main.tf</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">module &quot;alikafka_instance&quot; &#123;</span><br><span class="line">  source        = &quot;../../../../modules/aliyun/aliyun_alikafka_mod_demo&quot;</span><br><span class="line">  region        = &quot;cn-hangzhou&quot;</span><br><span class="line">  disk_size     = 500</span><br><span class="line">  instance_name = &quot;alikafka-testV2&quot;</span><br><span class="line">  deploy_type   = 5</span><br><span class="line">  vswitch_id    = &quot;vsw-bp1co65f3q2s0bis9yfkg&quot;</span><br><span class="line">  partition_num = 50</span><br><span class="line">  io_max        = 20</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="è¿è¡Œæµ‹è¯•"><a href="#è¿è¡Œæµ‹è¯•" class="headerlink" title="è¿è¡Œæµ‹è¯•"></a>è¿è¡Œæµ‹è¯•</h2><h3 id="è·å–-AK-SK"><a href="#è·å–-AK-SK" class="headerlink" title="è·å– AK&#x2F;SK"></a>è·å– AK&#x2F;SK</h3><p>åœ¨é¦–æ¬¡ä½¿ç”¨ Terraform ä¹‹å‰ï¼Œéœ€è¦å‰å¾€è…¾è®¯äº‘çš„<a href="https://console.cloud.tencent.com/cam/capi">äº‘ API å¯†é’¥é¡µé¢</a>ç”³è¯·å®‰å…¨å‡­è¯SecretIdå’ŒSecretKey2ã€‚è‹¥å·²æœ‰å¯ä½¿ç”¨çš„å®‰å…¨å‡­è¯ï¼Œåˆ™è·³è¿‡è¯¥æ­¥éª¤2ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹2ï¼š</p>
<ol>
<li>ç™»å½•è…¾è®¯äº‘<a href="https://console.cloud.tencent.com/cam">è®¿é—®ç®¡ç†æ§åˆ¶å°</a>ï¼Œåœ¨å·¦ä¾§å¯¼èˆªæ ï¼Œé€‰æ‹©è®¿é—®å¯†é’¥&gt;API å¯†é’¥ç®¡ç†ã€‚</li>
<li>åœ¨API å¯†é’¥ç®¡ç†é¡µé¢ï¼Œå•å‡»æ–°å»ºå¯†é’¥ï¼Œå³å¯ä»¥åˆ›å»ºä¸€å¯¹SecretId&#x2F;SecretKeyã€‚</li>
</ol>
<h3 id="è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®ç¯å¢ƒå˜é‡"></a>è®¾ç½®ç¯å¢ƒå˜é‡</h3><p>å°†è·å–åˆ°çš„SecretIdå’ŒSecretKeyè®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export TENCENTCLOUD_SECRET_ID=your_secret_id</span><br><span class="line">export TENCENTCLOUD_SECRET_KEY=your_secret_key</span><br></pre></td></tr></table></figure>

<h3 id="è¿è¡Œé¡¹ç›®"><a href="#è¿è¡Œé¡¹ç›®" class="headerlink" title="è¿è¡Œé¡¹ç›®"></a>è¿è¡Œé¡¹ç›®</h3><p>è¿›å…¥é¡¹ç›®æ ¹ç›®å½•ï¼Œalikafka_demo_202502061910ç›®å½•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ./aliyun/aliyun_alikafka_demo/aliyun_china_pt_7111/alikafka_demo_202502061910</span><br></pre></td></tr></table></figure>

<p>åˆå§‹åŒ– Terraform é¡¹ç›®:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†xxxæ›¿æ¢ä¸ºå®é™…backendçš„akï¼Œå°†yyyæ›¿æ¢ä¸ºå®é™…backendçš„sk</span></span><br><span class="line">terraform init -backend-config=&quot;access_key=xxx&quot; -backend-config=&quot;secret_key=yyy&quot;</span><br></pre></td></tr></table></figure>

<p>è¯¥å‘½ä»¤ä¼šä¸‹è½½æ‰€éœ€çš„æ’ä»¶å’Œä¾èµ–ï¼Œå¹¶åˆå§‹åŒ–åç«¯é…ç½®ã€‚<br>ç±»ä¼¼çš„è¾“å‡ºï¼ˆé¦–æ¬¡ä½¿ç”¨æŸä¸€ä¸ªprovieræ—¶ï¼Œä¼šå…ˆä¸‹è½½ï¼‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Initializing the backend...</span><br><span class="line"></span><br><span class="line">Successfully configured the backend &quot;oss&quot;! Terraform will automatically</span><br><span class="line">use this backend unless the backend configuration changes.</span><br><span class="line">Initializing modules...</span><br><span class="line">Initializing provider plugins...</span><br><span class="line">- Reusing previous version of aliyun/alicloud from the dependency lock file</span><br><span class="line">- Using previously-installed aliyun/alicloud v1.225.0</span><br><span class="line"></span><br><span class="line">Terraform has been successfully initialized!</span><br><span class="line"></span><br><span class="line">You may now begin working with Terraform. Try running &quot;terraform plan&quot; to see</span><br><span class="line">any changes that are required for your infrastructure. All Terraform commands</span><br><span class="line">should now work.</span><br><span class="line"></span><br><span class="line">If you ever set or change modules or backend configuration for Terraform,</span><br><span class="line">rerun this command to reinitialize your working directory. If you forget, other</span><br><span class="line">commands will detect it and remind you to do so if necessary.</span><br></pre></td></tr></table></figure>

<p>é¢„è§ˆè®¡åˆ’å˜æ›´ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">terraform plan</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:</span><br><span class="line">  + create</span><br><span class="line"></span><br><span class="line">Terraform will perform the following actions:</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">module.alikafka_instance.alicloud_alikafka_instance.this will be created</span></span><br><span class="line">  + resource &quot;alicloud_alikafka_instance&quot; &quot;this&quot; &#123;</span><br><span class="line">      + config            = (known after apply)</span><br><span class="line">      + deploy_type       = 5</span><br><span class="line">      + disk_size         = 500</span><br><span class="line">      + disk_type         = 1</span><br><span class="line">      + eip_max           = (known after apply)</span><br><span class="line">      + end_point         = (known after apply)</span><br><span class="line">      + group_left        = (known after apply)</span><br><span class="line">      + group_used        = (known after apply)</span><br><span class="line">      + id                = (known after apply)</span><br><span class="line">      + io_max            = 20</span><br><span class="line">      + io_max_spec       = (known after apply)</span><br><span class="line">      + is_partition_buy  = (known after apply)</span><br><span class="line">      + name              = &quot;alikafka-testV2&quot;</span><br><span class="line">      + paid_type         = &quot;PostPaid&quot;</span><br><span class="line">      + partition_left    = (known after apply)</span><br><span class="line">      + partition_num     = 50</span><br><span class="line">      + partition_used    = (known after apply)</span><br><span class="line">      + resource_group_id = (known after apply)</span><br><span class="line">      + security_group    = (known after apply)</span><br><span class="line">      + service_version   = (known after apply)</span><br><span class="line">      + spec_type         = &quot;normal&quot;</span><br><span class="line">      + status            = (known after apply)</span><br><span class="line">      + topic_left        = (known after apply)</span><br><span class="line">      + topic_num_of_buy  = (known after apply)</span><br><span class="line">      + topic_quota       = (known after apply)</span><br><span class="line">      + topic_used        = (known after apply)</span><br><span class="line">      + vpc_id            = (known after apply)</span><br><span class="line">      + vswitch_id        = &quot;vsw-bp1co65f3q2s0bis9yfkg&quot;</span><br><span class="line">      + zone_id           = (known after apply)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">Plan: 1 to add, 0 to change, 0 to destroy.</span><br><span class="line"></span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line"></span><br><span class="line">Note: You didn&#x27;t use the -out option to save this plan, so Terraform can&#x27;t guarantee to take exactly these actions if you run &quot;terraform apply&quot; now.</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå˜æ›´ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">terraform apply</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:</span><br><span class="line">  + create</span><br><span class="line"></span><br><span class="line">Terraform will perform the following actions:</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">module.alikafka_instance.alicloud_alikafka_instance.this will be created</span></span><br><span class="line">  + resource &quot;alicloud_alikafka_instance&quot; &quot;this&quot; &#123;</span><br><span class="line">      + config            = (known after apply)</span><br><span class="line">      + deploy_type       = 5</span><br><span class="line">      + disk_size         = 500</span><br><span class="line">      + disk_type         = 1</span><br><span class="line">      + eip_max           = (known after apply)</span><br><span class="line">      + end_point         = (known after apply)</span><br><span class="line">      + group_left        = (known after apply)</span><br><span class="line">      + group_used        = (known after apply)</span><br><span class="line">      + id                = (known after apply)</span><br><span class="line">      + io_max            = 20</span><br><span class="line">      + io_max_spec       = (known after apply)</span><br><span class="line">      + is_partition_buy  = (known after apply)</span><br><span class="line">      + name              = &quot;alikafka-testV2&quot;</span><br><span class="line">      + paid_type         = &quot;PostPaid&quot;</span><br><span class="line">      + partition_left    = (known after apply)</span><br><span class="line">      + partition_num     = 50</span><br><span class="line">      + partition_used    = (known after apply)</span><br><span class="line">      + resource_group_id = (known after apply)</span><br><span class="line">      + security_group    = (known after apply)</span><br><span class="line">      + service_version   = (known after apply)</span><br><span class="line">      + spec_type         = &quot;normal&quot;</span><br><span class="line">      + status            = (known after apply)</span><br><span class="line">      + topic_left        = (known after apply)</span><br><span class="line">      + topic_num_of_buy  = (known after apply)</span><br><span class="line">      + topic_quota       = (known after apply)</span><br><span class="line">      + topic_used        = (known after apply)</span><br><span class="line">      + vpc_id            = (known after apply)</span><br><span class="line">      + vswitch_id        = &quot;vsw-bp1co65f3q2s0bis9yfkg&quot;</span><br><span class="line">      + zone_id           = (known after apply)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">Plan: 1 to add, 0 to change, 0 to destroy.</span><br><span class="line"></span><br><span class="line">Do you want to perform these actions?</span><br><span class="line">  Terraform will perform the actions described above.</span><br><span class="line">  Only &#x27;yes&#x27; will be accepted to approve.</span><br><span class="line"></span><br><span class="line">  Enter a value: yes</span><br><span class="line"></span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Creating...</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [10s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [20s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [30s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [40s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [50s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [1m0s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [1m10s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [1m20s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [1m30s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [1m40s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [1m50s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [2m0s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [2m10s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [2m20s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [2m30s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [2m40s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [2m50s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [3m0s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [3m10s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [3m20s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [3m30s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [3m40s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [3m50s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [4m0s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [4m10s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [4m20s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [4m30s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still creating... [4m40s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Creation complete after 4m45s [id=alikafka_post-cn-0gx44g6dm006]</span><br><span class="line"></span><br><span class="line">Apply complete! Resources: 1 added, 0 changed, 0 destroyed.</span><br></pre></td></tr></table></figure>

<h3 id="éªŒè¯åˆ›å»º"><a href="#éªŒè¯åˆ›å»º" class="headerlink" title="éªŒè¯åˆ›å»º"></a>éªŒè¯åˆ›å»º</h3><p>åœ¨å‰ç«¯æŸ¥çœ‹æ˜¯å¦æˆåŠŸåˆ›å»ºå®ä¾‹ï¼š<br><img src="/img.png" alt="img.png"></p>
<h3 id="é”€æ¯èµ„æº"><a href="#é”€æ¯èµ„æº" class="headerlink" title="é”€æ¯èµ„æº"></a>é”€æ¯èµ„æº</h3><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿›è¡Œé”€æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">terraform destroy</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Refreshing state... [id=alikafka_post-cn-0gx44g6dm006]</span><br><span class="line"></span><br><span class="line">Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:</span><br><span class="line">  - destroy</span><br><span class="line"></span><br><span class="line">Terraform will perform the following actions:</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">module.alikafka_instance.alicloud_alikafka_instance.this will be destroyed</span></span><br><span class="line">  - resource &quot;alicloud_alikafka_instance&quot; &quot;this&quot; &#123;</span><br><span class="line">      - config            = jsonencode(</span><br><span class="line">            &#123;</span><br><span class="line">              - &quot;cloud.maxTieredStoreSpace&quot;           = &quot;0&quot;</span><br><span class="line">              - &quot;enable.acl&quot;                          = &quot;false&quot;</span><br><span class="line">              - &quot;enable.compact&quot;                      = &quot;true&quot;</span><br><span class="line">              - &quot;enable.tiered&quot;                       = &quot;false&quot;</span><br><span class="line">              - &quot;enable.vpc_sasl_ssl&quot;                 = &quot;false&quot;</span><br><span class="line">              - &quot;kafka.log.retention.hours&quot;           = &quot;72&quot;</span><br><span class="line">              - &quot;kafka.message.max.bytes&quot;             = &quot;1048576&quot;</span><br><span class="line">              - &quot;kafka.offsets.retention.minutes&quot;     = &quot;10080&quot;</span><br><span class="line">              - &quot;kafka.ssl.bit&quot;                       = &quot;1024&quot;</span><br><span class="line">              - &quot;message.timestamp.difference.max.ms&quot; = &quot;9223372036854775807&quot;</span><br><span class="line">              - &quot;message.timestamp.type&quot;              = &quot;CreateTime&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ) -&gt; null</span><br><span class="line">      - deploy_type       = 5 -&gt; null</span><br><span class="line">      - disk_size         = 500 -&gt; null</span><br><span class="line">      - disk_type         = 1 -&gt; null</span><br><span class="line">      - eip_max           = 0 -&gt; null</span><br><span class="line">      - end_point         = &quot;172.31.1.64:9092,172.31.1.66:9092,172.31.1.65:9092&quot; -&gt; null</span><br><span class="line">      - group_left        = 2100 -&gt; null</span><br><span class="line">      - group_used        = 0 -&gt; null</span><br><span class="line">      - id                = &quot;alikafka_post-cn-0gx44g6dm006&quot; -&gt; null</span><br><span class="line">      - io_max            = 20 -&gt; null</span><br><span class="line">      - io_max_spec       = &quot;alikafka.hw.2xlarge&quot; -&gt; null</span><br><span class="line">      - is_partition_buy  = 1 -&gt; null</span><br><span class="line">      - name              = &quot;alikafka-testV2&quot; -&gt; null</span><br><span class="line">      - paid_type         = &quot;PostPaid&quot; -&gt; null</span><br><span class="line">      - partition_left    = 1050 -&gt; null</span><br><span class="line">      - partition_num     = 50 -&gt; null</span><br><span class="line">      - partition_used    = 0 -&gt; null</span><br><span class="line">      - resource_group_id = &quot;rg-acfmzpn54i5ejry&quot; -&gt; null</span><br><span class="line">      - security_group    = &quot;sg-bp184o2lwjnssf12wf3w&quot; -&gt; null</span><br><span class="line">      - service_version   = &quot;2.2.0&quot; -&gt; null</span><br><span class="line">      - spec_type         = &quot;normal&quot; -&gt; null</span><br><span class="line">      - status            = 5 -&gt; null</span><br><span class="line">      - tags              = &#123;&#125; -&gt; null</span><br><span class="line">      - topic_left        = 1050 -&gt; null</span><br><span class="line">      - topic_num_of_buy  = 1050 -&gt; null</span><br><span class="line">      - topic_quota       = 1050 -&gt; null</span><br><span class="line">      - topic_used        = 0 -&gt; null</span><br><span class="line">      - vpc_id            = &quot;vpc-bp1sro6pb0sec14x7s05l&quot; -&gt; null</span><br><span class="line">      - vswitch_id        = &quot;vsw-bp1co65f3q2s0bis9yfkg&quot; -&gt; null</span><br><span class="line">      - zone_id           = &quot;zonei&quot; -&gt; null</span><br><span class="line">        # (1 unchanged attribute hidden)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">Plan: 0 to add, 0 to change, 1 to destroy.</span><br><span class="line"></span><br><span class="line">Do you really want to destroy all resources?</span><br><span class="line">  Terraform will destroy all your managed infrastructure, as shown above.</span><br><span class="line">  There is no undo. Only &#x27;yes&#x27; will be accepted to confirm.</span><br><span class="line"></span><br><span class="line">  Enter a value: yes</span><br><span class="line"></span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Destroying... [id=alikafka_post-cn-0gx44g6dm006]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still destroying... [id=alikafka_post-cn-0gx44g6dm006, 10s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still destroying... [id=alikafka_post-cn-0gx44g6dm006, 20s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still destroying... [id=alikafka_post-cn-0gx44g6dm006, 30s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still destroying... [id=alikafka_post-cn-0gx44g6dm006, 40s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still destroying... [id=alikafka_post-cn-0gx44g6dm006, 50s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still destroying... [id=alikafka_post-cn-0gx44g6dm006, 1m1s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still destroying... [id=alikafka_post-cn-0gx44g6dm006, 1m11s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still destroying... [id=alikafka_post-cn-0gx44g6dm006, 1m21s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still destroying... [id=alikafka_post-cn-0gx44g6dm006, 1m31s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still destroying... [id=alikafka_post-cn-0gx44g6dm006, 1m41s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still destroying... [id=alikafka_post-cn-0gx44g6dm006, 1m51s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still destroying... [id=alikafka_post-cn-0gx44g6dm006, 2m1s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still destroying... [id=alikafka_post-cn-0gx44g6dm006, 2m11s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still destroying... [id=alikafka_post-cn-0gx44g6dm006, 2m21s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Still destroying... [id=alikafka_post-cn-0gx44g6dm006, 2m31s elapsed]</span><br><span class="line">module.alikafka_instance.alicloud_alikafka_instance.this: Destruction complete after 2m37s</span><br><span class="line"></span><br><span class="line">Destroy complete! Resources: 1 destroyed.</span><br></pre></td></tr></table></figure>


]]></content>
  </entry>
  <entry>
    <title>tencentcloud_ckafka_instance</title>
    <url>/2025/07/devops/terraform/tencentcloud_ckafka_instance/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>çº¦å®šæ ¼å¼ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”œâ”€â”€ aliyun                                             # äº‘å‚å•†å®ä¾‹æ–‡ä»¶</span><br><span class="line">â”‚   â””â”€â”€ aliyun_ecs_mod_demo                           # æ¨¡å‹å</span><br><span class="line">â”‚       â””â”€â”€ aliyun_china_platform_7111                # äº‘è´¦å·å</span><br><span class="line">â”‚           â””â”€â”€ ecs_instance_name_20241224121212      # å®ä¾‹å</span><br><span class="line">â”‚               â”œâ”€â”€ backend.tf                        # å®ä¾‹stateæ–‡ä»¶ä¿å­˜è¯´æ˜ï¼šoss</span><br><span class="line">â”‚               â””â”€â”€ main.tf                           # å®ä¾‹å…·ä½“çš„å‚æ•°</span><br><span class="line">â”œâ”€â”€ modules                                            # æ¨¡å‹æ•°æ®æ–‡ä»¶å¤¹</span><br><span class="line">â”‚   â”œâ”€â”€ aliyun                                        # äº‘å‚å•†æ¨¡å‹æ–‡ä»¶å¤¹</span><br><span class="line">â”‚   â”‚   â””â”€â”€ aliyun_ecs_mod_demo                       # æ¨¡å‹å</span><br><span class="line">â”‚   â”‚       â”œâ”€â”€ main.tf                               # æ¨¡å‹å®šä¹‰ä¸»æ–‡ä»¶</span><br><span class="line">â”‚   â”‚       â”œâ”€â”€ outputs.tf                            # æ¨¡å‹å®šä¹‰è¾“å‡ºæ–‡ä»¶</span><br><span class="line">â”‚   â”‚       â””â”€â”€ variables.tf                          # æ¨¡å‹å®šä¹‰å‚æ•°æ–‡ä»¶</span><br><span class="line">â”‚   â””â”€â”€ tenmod                                         # å¦ä¸€ä¸ªäº‘å‚å•†æ¨¡å‹</span><br><span class="line">â””â”€â”€ tenent                                              # å¦ä¸€ä¸ªäº‘å‚å•†å®ä¾‹æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<h1 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ modules</span><br><span class="line">â”‚   â””â”€â”€ tcloud</span><br><span class="line">â”‚       â””â”€â”€ tcloud_ckafka_mod_demo</span><br><span class="line">â”‚           â”œâ”€â”€ main.tf</span><br><span class="line">â”‚           â”œâ”€â”€ outputs.tf</span><br><span class="line">â”‚           â””â”€â”€ variables.tf</span><br><span class="line">â””â”€â”€ tcloud</span><br><span class="line">    â””â”€â”€ tcloud_ckafka_demo</span><br><span class="line">        â””â”€â”€ tcloud_china_game_x6</span><br><span class="line">            â””â”€â”€ ckafaka_demo_202501221738</span><br><span class="line">                â”œâ”€â”€ backend.tf</span><br><span class="line">                â””â”€â”€ main.tf</span><br></pre></td></tr></table></figure>

<h2 id="modules"><a href="#modules" class="headerlink" title="modules"></a>modules</h2><h3 id="modules-tcloud-tcloud-ckafka-mod-demo-main-tf"><a href="#modules-tcloud-tcloud-ckafka-mod-demo-main-tf" class="headerlink" title="&#x2F;modules&#x2F;tcloud&#x2F;tcloud_ckafka_mod_demo&#x2F;main.tf"></a>&#x2F;modules&#x2F;tcloud&#x2F;tcloud_ckafka_mod_demo&#x2F;main.tf</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">terraform &#123;</span><br><span class="line">  required_providers &#123;</span><br><span class="line">    tencentcloud = &#123;</span><br><span class="line">      source = &quot;tencentcloudstack/tencentcloud&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">provider &quot;tencentcloud&quot; &#123;</span><br><span class="line">  region = var.region</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data &quot;tencentcloud_availability_zones_by_product&quot; &quot;zone&quot; &#123;</span><br><span class="line">  name    = var.availability_zone</span><br><span class="line">  product = &quot;ckafka&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;tencentcloud_ckafka_instance&quot; &quot;this&quot; &#123;</span><br><span class="line">  instance_name      = var.instance_name</span><br><span class="line">  zone_id            = data.tencentcloud_availability_zones_by_product.zone.zones[0].id</span><br><span class="line">  vpc_id             = var.vpc_id</span><br><span class="line">  subnet_id          = var.vswitch_id</span><br><span class="line">  msg_retention_time = var.msg_retention_time</span><br><span class="line">  kafka_version      = var.kafka_version</span><br><span class="line">  disk_size          = var.disk_size</span><br><span class="line">  band_width         = var.band_width</span><br><span class="line">  disk_type          = var.disk_type</span><br><span class="line">  partition          = var.partition</span><br><span class="line">  charge_type        = var.charge_type</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  config &#123;</span><br><span class="line">    auto_create_topic_enable   = var.auto_create_topic_enable</span><br><span class="line">    default_num_partitions     = var.num_partitions</span><br><span class="line">    default_replication_factor = var.replication_factor</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  dynamic_retention_config &#123;</span><br><span class="line">    enable = var.dynamic_retention_config_enable</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="modules-tcloud-tcloud-ckafka-mod-demo-outputs-tf"><a href="#modules-tcloud-tcloud-ckafka-mod-demo-outputs-tf" class="headerlink" title="&#x2F;modules&#x2F;tcloud&#x2F;tcloud_ckafka_mod_demo&#x2F;outputs.tf"></a>&#x2F;modules&#x2F;tcloud&#x2F;tcloud_ckafka_mod_demo&#x2F;outputs.tf</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">output &quot;ckafka_instance_id&quot; &#123;</span><br><span class="line">  value = tencentcloud_ckafka_instance.this.id</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="modules-tcloud-tcloud-ckafka-mod-demo-variables-tf"><a href="#modules-tcloud-tcloud-ckafka-mod-demo-variables-tf" class="headerlink" title="&#x2F;modules&#x2F;tcloud&#x2F;tcloud_ckafka_mod_demo&#x2F;variables.tf"></a>&#x2F;modules&#x2F;tcloud&#x2F;tcloud_ckafka_mod_demo&#x2F;variables.tf</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">variable &quot;region&quot; &#123;</span><br><span class="line">  description = &quot;åœ°åŸŸ&quot;</span><br><span class="line">  type        = string</span><br><span class="line">  default     = &quot;ap-shanghai&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;instance_name&quot; &#123;</span><br><span class="line">  description = &quot;kafkaå®ä¾‹å&quot;</span><br><span class="line">  type        = string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;availability_zone&quot; &#123;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">å¦‚ap-shanghai-2</span></span><br><span class="line">  description = &quot;å¯ç”¨åŒº&quot;</span><br><span class="line">  type = string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;charge_type&quot; &#123;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">PREPAID(é¢„ä»˜è´¹), POSTPAID_BY_HOUR(æŒ‰é‡ä»˜è´¹)</span></span><br><span class="line">  description = &quot;kafkaå®ä¾‹è®¡è´¹æ–¹å¼&quot;</span><br><span class="line">  type = string</span><br><span class="line">  validation &#123;</span><br><span class="line">    condition     = contains([&quot;PREPAID&quot;, &quot;POSTPAID_BY_HOUR&quot;], var.charge_type)</span><br><span class="line">    error_message = &quot;The charge_type must be one of PREPAID, POSTPAID_BY_HOUR&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;kafka_version&quot; &#123;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">0.10.2/1.1.1/2.4.1/2.8.1</span></span><br><span class="line">  description = &quot;kafkaå®ä¾‹ç‰ˆæœ¬&quot;</span><br><span class="line">  type = string</span><br><span class="line">  validation &#123;</span><br><span class="line">    condition     = contains([&quot;0.10.2&quot;, &quot;1.1.1&quot;, &quot;2.4.1&quot;, &quot;2.4.2&quot;, &quot;2.8.1&quot;], var.kafka_version)</span><br><span class="line">    error_message = &quot;The kafka_version must be one of 0.10.2, 1.1.1, 2.4.1, 2.4.2, 2.8.1&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">variable &quot;vswitch_id&quot; &#123;</span><br><span class="line">  // é˜¿é‡Œäº‘vswitch_id -&gt; è…¾è®¯äº‘subnet_id</span><br><span class="line">  description = &quot;ç»‘å®šå­ç½‘id&quot;</span><br><span class="line">  type = string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;vpc_id&quot; &#123;</span><br><span class="line">  description = &quot;ç»‘å®švpc_id&quot;</span><br><span class="line">  type = string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;disk_size&quot; &#123;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">éœ€æ»¡è¶³å½“å‰å®ä¾‹çš„è®¡è´¹è§„æ ¼ï¼Œæ­¤å¤„é¢„è®¾200å’Œ400ï¼Œå¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹</span></span><br><span class="line">  description = &quot;kafkaå®ä¾‹ç£ç›˜è§„æ ¼&quot;</span><br><span class="line">  type = number</span><br><span class="line">  validation &#123;</span><br><span class="line">    condition     = contains([200, 400], var.disk_size)</span><br><span class="line">    error_message = &quot;The disk_size must be one of 200, 400&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;disk_type&quot; &#123;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">ä¸“ä¸šç‰ˆå®ä¾‹ç£ç›˜ç±»å‹ï¼Œæ ‡å‡†ç‰ˆå®ä¾‹ä¸éœ€è¦å¡«å†™ï¼ŒCLOUD_SSD(SSDäº‘ç¡¬ç›˜), CLOUD_BASIC(é«˜æ€§èƒ½äº‘ç¡¬ç›˜)</span></span><br><span class="line">  description = &quot;kafkaä¸“ä¸šç‰ˆå®ä¾‹ç£ç›˜ç±»å‹&quot;</span><br><span class="line">  type = string</span><br><span class="line">  default = &quot;&quot;</span><br><span class="line">  validation &#123;</span><br><span class="line">    condition     = contains([&quot;&quot;, &quot;CLOUD_SSD&quot;, &quot;CLOUD_BASIC&quot;], var.disk_type)</span><br><span class="line">    error_message = &quot;The disk_type must be empty, or one of CLOUD_SSD, CLOUD_BASIC&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;band_width&quot; &#123;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">å•ä½ä¸ºMBps.</span></span><br><span class="line">  description = &quot;kafkaå®ä¾‹å¸¦å®½&quot;</span><br><span class="line">  type = number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;auto_create_topic_enable&quot; &#123;</span><br><span class="line">  description = &quot;æ˜¯å¦è‡ªåŠ¨åˆ›å»ºtopic&quot;</span><br><span class="line">  type = bool</span><br><span class="line">  default = true</span><br><span class="line">  validation &#123;</span><br><span class="line">    condition     = contains([true, false], var.auto_create_topic_enable)</span><br><span class="line">    error_message = &quot;The auto_create_topic_enable must be one of true, false&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;num_partitions&quot; &#123;</span><br><span class="line">  description = &quot;kafkaå®ä¾‹é»˜è®¤åˆ†åŒºæ•°&quot;</span><br><span class="line">  type = number</span><br><span class="line">  default = 3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;replication_factor&quot; &#123;</span><br><span class="line">  description = &quot;kafkaå®ä¾‹é»˜è®¤å‰¯æœ¬æ•°&quot;</span><br><span class="line">  type = number</span><br><span class="line">  default = 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;dynamic_retention_config_enable&quot; &#123;</span><br><span class="line">  description = &quot;æ˜¯å¦å¯ç”¨åŠ¨æ€æ¶ˆæ¯ä¿ç•™æ—¶é—´é…ç½®&quot;</span><br><span class="line">  type = number</span><br><span class="line">  default = 0</span><br><span class="line">  validation &#123;</span><br><span class="line">    condition     = contains([0, 1], var.dynamic_retention_config_enable)</span><br><span class="line">    error_message = &quot;The dynamic_retention_config_enable must be one of 0, 1&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;msg_retention_time&quot; &#123;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">ä»¥åˆ†é’Ÿä¸ºå•ä½</span></span><br><span class="line">  description = &quot;kafkaå®ä¾‹æ—¥å¿—çš„æœ€å¤§ä¿ç•™æ—¶é—´&quot;</span><br><span class="line">  type = number</span><br><span class="line">  default = 10080</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;partition&quot; &#123;</span><br><span class="line">  description = &quot;kafkaå®ä¾‹åˆ†åŒºå¤§å°&quot;</span><br><span class="line">  type = number</span><br><span class="line">  default = 3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><h3 id="tcloud-tcloud-ckafka-demo-tcloud-china-game-x6-ckafaka-demo-202501221738-backend-tf"><a href="#tcloud-tcloud-ckafka-demo-tcloud-china-game-x6-ckafaka-demo-202501221738-backend-tf" class="headerlink" title="&#x2F;tcloud&#x2F;tcloud_ckafka_demo&#x2F;tcloud_china_game_x6&#x2F;ckafaka_demo_202501221738&#x2F;backend.tf"></a>&#x2F;tcloud&#x2F;tcloud_ckafka_demo&#x2F;tcloud_china_game_x6&#x2F;ckafaka_demo_202501221738&#x2F;backend.tf</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">terraform &#123;</span><br><span class="line">  backend &quot;oss&quot; &#123;</span><br><span class="line">    endpoint = &quot;oss-cn-hangzhou.aliyuncs.com&quot;</span><br><span class="line">    bucket   = &quot;dz-devops&quot; # æ›¿æ¢ä¸ºä½ çš„ OSS Bucket åç§°</span><br><span class="line">    prefix = &quot;terraform_state/tcloud/tcloud_ckafka_demo/tcloud_china_game_x6/ckafka_demo_202501221738&quot;</span><br><span class="line">    key      = &quot;terraform.tfstate&quot; # å­˜å‚¨çŠ¶æ€æ–‡ä»¶çš„è·¯å¾„å’Œåç§°</span><br><span class="line">    region   = &quot;cn-hangzhou&quot;       # OSS çš„åœ°åŸŸï¼ˆæ ¹æ®ä½ çš„å®é™…æƒ…å†µè°ƒæ•´ï¼‰</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="tcloud-tcloud-ckafka-demo-tcloud-china-game-x6-ckafaka-demo-202501221738-main-tf"><a href="#tcloud-tcloud-ckafka-demo-tcloud-china-game-x6-ckafaka-demo-202501221738-main-tf" class="headerlink" title="&#x2F;tcloud&#x2F;tcloud_ckafka_demo&#x2F;tcloud_china_game_x6&#x2F;ckafaka_demo_202501221738&#x2F;main.tf"></a>&#x2F;tcloud&#x2F;tcloud_ckafka_demo&#x2F;tcloud_china_game_x6&#x2F;ckafaka_demo_202501221738&#x2F;main.tf</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">module &quot;ckafka_instance&quot; &#123;</span><br><span class="line">  source              = &quot;../../../../modules/tcloud/tcloud_ckafka_mod_demo&quot;</span><br><span class="line">  region              = &quot;ap-shanghai&quot;</span><br><span class="line">  instance_name       = &quot;ckafka-test&quot;</span><br><span class="line">  availability_zone   = &quot;ap-shanghai-2&quot;</span><br><span class="line">  charge_type         = &quot;POSTPAID_BY_HOUR&quot;</span><br><span class="line">  kafka_version       = &quot;2.4.2&quot;</span><br><span class="line">  vpc_id              = &quot;vpc-4tkroxts&quot;</span><br><span class="line">  vswitch_id          = &quot;subnet-oy1pqvzv&quot;</span><br><span class="line">  disk_size           = 200</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">disk_type           = <span class="string">&quot;CLOUD_BASIC&quot;</span></span></span><br><span class="line">  band_width          = 20</span><br><span class="line">  auto_create_topic_enable = true</span><br><span class="line">  num_partitions     = 3</span><br><span class="line">  replication_factor = 3</span><br><span class="line">  dynamic_retention_config_enable = 1</span><br><span class="line">  msg_retention_time = 1300</span><br><span class="line">  partition = 400</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="è¿è¡Œæµ‹è¯•"><a href="#è¿è¡Œæµ‹è¯•" class="headerlink" title="è¿è¡Œæµ‹è¯•"></a>è¿è¡Œæµ‹è¯•</h2><h3 id="è·å–-AK-SK"><a href="#è·å–-AK-SK" class="headerlink" title="è·å– AK&#x2F;SK"></a>è·å– AK&#x2F;SK</h3><p>åœ¨é¦–æ¬¡ä½¿ç”¨ Terraform ä¹‹å‰ï¼Œéœ€è¦å‰å¾€è…¾è®¯äº‘çš„<a href="https://console.cloud.tencent.com/cam/capi">äº‘ API å¯†é’¥é¡µé¢</a>ç”³è¯·å®‰å…¨å‡­è¯SecretIdå’ŒSecretKey2ã€‚è‹¥å·²æœ‰å¯ä½¿ç”¨çš„å®‰å…¨å‡­è¯ï¼Œåˆ™è·³è¿‡è¯¥æ­¥éª¤2ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹2ï¼š</p>
<ol>
<li>ç™»å½•è…¾è®¯äº‘<a href="https://console.cloud.tencent.com/cam">è®¿é—®ç®¡ç†æ§åˆ¶å°</a>ï¼Œåœ¨å·¦ä¾§å¯¼èˆªæ ï¼Œé€‰æ‹©è®¿é—®å¯†é’¥&gt;API å¯†é’¥ç®¡ç†ã€‚</li>
<li>åœ¨API å¯†é’¥ç®¡ç†é¡µé¢ï¼Œå•å‡»æ–°å»ºå¯†é’¥ï¼Œå³å¯ä»¥åˆ›å»ºä¸€å¯¹SecretId&#x2F;SecretKeyã€‚</li>
</ol>
<h3 id="è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®ç¯å¢ƒå˜é‡"></a>è®¾ç½®ç¯å¢ƒå˜é‡</h3><p>å°†è·å–åˆ°çš„SecretIdå’ŒSecretKeyè®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export TENCENTCLOUD_SECRET_ID=your_secret_id</span><br><span class="line">export TENCENTCLOUD_SECRET_KEY=your_secret_key</span><br></pre></td></tr></table></figure>

<h3 id="è¿è¡Œé¡¹ç›®"><a href="#è¿è¡Œé¡¹ç›®" class="headerlink" title="è¿è¡Œé¡¹ç›®"></a>è¿è¡Œé¡¹ç›®</h3><p>è¿›å…¥é¡¹ç›®æ ¹ç›®å½•ï¼Œè¿™é‡Œæ˜¯ckafaka_demo_202501221738ç›®å½•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ./tcloud/tcloud_ckafka_demo/tcloud_china_game_x6/ckafaka_demo_202501221738/</span><br></pre></td></tr></table></figure>

<p>åˆå§‹åŒ– Terraform é¡¹ç›®:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†xxxæ›¿æ¢ä¸ºå®é™…backendçš„akï¼Œå°†yyyæ›¿æ¢ä¸ºå®é™…backendçš„sk</span></span><br><span class="line">terraform init -backend-config=&quot;access_key=xxx&quot; -backend-config=&quot;secret_key=yyy&quot;</span><br></pre></td></tr></table></figure>

<p>è¯¥å‘½ä»¤ä¼šä¸‹è½½æ‰€éœ€çš„æ’ä»¶å’Œä¾èµ–ï¼Œå¹¶åˆå§‹åŒ–åç«¯é…ç½®ã€‚<br>ç±»ä¼¼çš„è¾“å‡ºï¼ˆé¦–æ¬¡ä½¿ç”¨æŸä¸€ä¸ªprovieræ—¶ï¼Œä¼šå…ˆä¸‹è½½ï¼‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Initializing the backend...</span><br><span class="line"></span><br><span class="line">Successfully configured the backend &quot;oss&quot;! Terraform will automatically</span><br><span class="line">use this backend unless the backend configuration changes.</span><br><span class="line">Initializing modules...</span><br><span class="line">- ckafka_instance in ../../../../modules/tcloud/tcloud_ckafka_mod_demo</span><br><span class="line">Initializing provider plugins...</span><br><span class="line">- Finding latest version of tencentcloudstack/tencentcloud...</span><br><span class="line">- Installing tencentcloudstack/tencentcloud v1.81.162...</span><br><span class="line">- Installed tencentcloudstack/tencentcloud v1.81.162 (signed by a HashiCorp partner, key ID 84F69E1C1BECF459)</span><br><span class="line">Partner and community providers are signed by their developers.</span><br><span class="line">If you&#x27;d like to know more about provider signing, you can read about it here:</span><br><span class="line">https://www.terraform.io/docs/cli/plugins/signing.html</span><br><span class="line">Terraform has created a lock file .terraform.lock.hcl to record the provider</span><br><span class="line">selections it made above. Include this file in your version control repository</span><br><span class="line">so that Terraform can guarantee to make the same selections by default when</span><br><span class="line">you run &quot;terraform init&quot; in the future.</span><br><span class="line"></span><br><span class="line">Terraform has been successfully initialized!</span><br><span class="line"></span><br><span class="line">You may now begin working with Terraform. Try running &quot;terraform plan&quot; to see</span><br><span class="line">any changes that are required for your infrastructure. All Terraform commands</span><br><span class="line">should now work.</span><br><span class="line"></span><br><span class="line">If you ever set or change modules or backend configuration for Terraform,</span><br><span class="line">rerun this command to reinitialize your working directory. If you forget, other</span><br><span class="line">commands will detect it and remind you to do so if necessary.</span><br></pre></td></tr></table></figure>

<h3 id="é¢„è§ˆè®¡åˆ’å˜æ›´ï¼š"><a href="#é¢„è§ˆè®¡åˆ’å˜æ›´ï¼š" class="headerlink" title="é¢„è§ˆè®¡åˆ’å˜æ›´ï¼š"></a>é¢„è§ˆè®¡åˆ’å˜æ›´ï¼š</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">terraform plan</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">module.ckafka_instance.data.tencentcloud_availability_zones_by_product.zone: Reading...</span><br><span class="line">module.ckafka_instance.data.tencentcloud_availability_zones_by_product.zone: Read complete after 0s [id=2066006299]</span><br><span class="line"></span><br><span class="line">Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:</span><br><span class="line">  + create</span><br><span class="line"></span><br><span class="line">Terraform will perform the following actions:</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">module.ckafka_instance.tencentcloud_ckafka_instance.this will be created</span></span><br><span class="line">  + resource &quot;tencentcloud_ckafka_instance&quot; &quot;this&quot; &#123;</span><br><span class="line">      + band_width          = 20</span><br><span class="line">      + charge_type         = &quot;POSTPAID_BY_HOUR&quot;</span><br><span class="line">      + disk_size           = 200</span><br><span class="line">      + disk_type           = &quot;CLOUD_BASIC&quot;</span><br><span class="line">      + id                  = (known after apply)</span><br><span class="line">      + instance_name       = &quot;ckafka-test&quot;</span><br><span class="line">      + instance_type       = (known after apply)</span><br><span class="line">      + kafka_version       = &quot;kafka_version&quot;</span><br><span class="line">      + max_message_byte    = (known after apply)</span><br><span class="line">      + msg_retention_time  = 1300</span><br><span class="line">      + partition           = 400</span><br><span class="line">      + public_network      = (known after apply)</span><br><span class="line">      + renew_flag          = (known after apply)</span><br><span class="line">      + specifications_type = &quot;profession&quot;</span><br><span class="line">      + subnet_id           = &quot;subnet-oy1pqvzv&quot;</span><br><span class="line">      + tag_set             = (known after apply)</span><br><span class="line">      + upgrade_strategy    = 1</span><br><span class="line">      + vip                 = (known after apply)</span><br><span class="line">      + vpc_id              = &quot;vpc-4tkroxts&quot;</span><br><span class="line">      + vport               = (known after apply)</span><br><span class="line">      + zone_id             = 200002</span><br><span class="line"></span><br><span class="line">      + config &#123;</span><br><span class="line">          + auto_create_topic_enable   = true</span><br><span class="line">          + default_num_partitions     = 3</span><br><span class="line">          + default_replication_factor = 3</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      + dynamic_retention_config &#123;</span><br><span class="line">          + bottom_retention        = (known after apply)</span><br><span class="line">          + disk_quota_percentage   = (known after apply)</span><br><span class="line">          + enable                  = 1</span><br><span class="line">          + step_forward_percentage = (known after apply)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      + tags (known after apply)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">Plan: 1 to add, 0 to change, 0 to destroy.</span><br><span class="line"></span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line"></span><br><span class="line">Note: You didn&#x27;t use the -out option to save this plan, so Terraform can&#x27;t guarantee to take exactly these actions if you run &quot;terraform apply&quot; now.</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå˜æ›´ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">terraform apply</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">module.ckafka_instance.data.tencentcloud_availability_zones_by_product.zone: Reading...</span><br><span class="line">module.ckafka_instance.data.tencentcloud_availability_zones_by_product.zone: Read complete after 1s [id=2066006299]</span><br><span class="line"></span><br><span class="line">Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:</span><br><span class="line">  + create</span><br><span class="line"></span><br><span class="line">Terraform will perform the following actions:</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">module.ckafka_instance.tencentcloud_ckafka_instance.this will be created</span></span><br><span class="line">  + resource &quot;tencentcloud_ckafka_instance&quot; &quot;this&quot; &#123;</span><br><span class="line">      + band_width          = 20</span><br><span class="line">      + charge_type         = &quot;POSTPAID_BY_HOUR&quot;</span><br><span class="line">      + disk_size           = 200</span><br><span class="line">      + disk_type           = &quot;CLOUD_BASIC&quot;</span><br><span class="line">      + id                  = (known after apply)</span><br><span class="line">      + instance_name       = &quot;ckafka-test&quot;</span><br><span class="line">      + instance_type       = (known after apply)</span><br><span class="line">      + kafka_version       = &quot;kafka_version&quot;</span><br><span class="line">      + max_message_byte    = (known after apply)</span><br><span class="line">      + msg_retention_time  = 1300</span><br><span class="line">      + partition           = 400</span><br><span class="line">      + public_network      = (known after apply)</span><br><span class="line">      + renew_flag          = (known after apply)</span><br><span class="line">      + specifications_type = &quot;profession&quot;</span><br><span class="line">      + subnet_id           = &quot;subnet-oy1pqvzv&quot;</span><br><span class="line">      + tag_set             = (known after apply)</span><br><span class="line">      + upgrade_strategy    = 1</span><br><span class="line">      + vip                 = (known after apply)</span><br><span class="line">      + vpc_id              = &quot;vpc-4tkroxts&quot;</span><br><span class="line">      + vport               = (known after apply)</span><br><span class="line">      + zone_id             = 200002</span><br><span class="line"></span><br><span class="line">      + config &#123;</span><br><span class="line">          + auto_create_topic_enable   = true</span><br><span class="line">          + default_num_partitions     = 3</span><br><span class="line">          + default_replication_factor = 3</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      + dynamic_retention_config &#123;</span><br><span class="line">          + bottom_retention        = (known after apply)</span><br><span class="line">          + disk_quota_percentage   = (known after apply)</span><br><span class="line">          + enable                  = 1</span><br><span class="line">          + step_forward_percentage = (known after apply)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      + tags (known after apply)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">Plan: 1 to add, 0 to change, 0 to destroy.</span><br><span class="line"></span><br><span class="line">Do you want to perform these actions?</span><br><span class="line">  Terraform will perform the actions described above.</span><br><span class="line">  Only &#x27;yes&#x27; will be accepted to approve.</span><br><span class="line"></span><br><span class="line">  Enter a value: yes</span><br><span class="line"></span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Creating...</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [10s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [20s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [30s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [40s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [50s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [1m0s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [1m10s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [1m20s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [1m30s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [1m40s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [1m50s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [2m0s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [2m10s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [2m20s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [2m30s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [2m40s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [2m50s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Still creating... [3m0s elapsed]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Creation complete after 3m7s [id=ckafka-9jnda3jn]</span><br><span class="line"></span><br><span class="line">Apply complete! Resources: 1 added, 0 changed, 0 destroyed.</span><br></pre></td></tr></table></figure>

<h3 id="éªŒè¯åˆ›å»º"><a href="#éªŒè¯åˆ›å»º" class="headerlink" title="éªŒè¯åˆ›å»º"></a>éªŒè¯åˆ›å»º</h3><p>åœ¨å‰ç«¯æŸ¥çœ‹æ˜¯å¦æˆåŠŸåˆ›å»ºå®ä¾‹ï¼š<br><img src="/img_1.png" alt="img_1.png"></p>
<h3 id="é”€æ¯èµ„æº"><a href="#é”€æ¯èµ„æº" class="headerlink" title="é”€æ¯èµ„æº"></a>é”€æ¯èµ„æº</h3><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿›è¡Œé”€æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">terraform destroy</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">module.ckafka_instance.data.tencentcloud_availability_zones_by_product.zone: Reading...</span><br><span class="line">module.ckafka_instance.data.tencentcloud_availability_zones_by_product.zone: Read complete after 1s [id=2066006299]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Refreshing state... [id=ckafka-9jnda3jn]</span><br><span class="line"></span><br><span class="line">Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:</span><br><span class="line">  - destroy</span><br><span class="line"></span><br><span class="line">Terraform will perform the following actions:</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">module.ckafka_instance.tencentcloud_ckafka_instance.this will be destroyed</span></span><br><span class="line">  - resource &quot;tencentcloud_ckafka_instance&quot; &quot;this&quot; &#123;</span><br><span class="line">      - band_width          = 20 -&gt; null</span><br><span class="line">      - charge_type         = &quot;POSTPAID_BY_HOUR&quot; -&gt; null</span><br><span class="line">      - disk_size           = 200 -&gt; null</span><br><span class="line">      - disk_type           = &quot;CLOUD_BASIC&quot; -&gt; null</span><br><span class="line">      - id                  = &quot;ckafka-9jnda3jn&quot; -&gt; null</span><br><span class="line">      - instance_name       = &quot;ckafka-test&quot; -&gt; null</span><br><span class="line">      - instance_type       = 1 -&gt; null</span><br><span class="line">      - kafka_version       = &quot;0.10.2.1&quot; -&gt; null</span><br><span class="line">      - msg_retention_time  = 1300 -&gt; null</span><br><span class="line">      - partition           = 400 -&gt; null</span><br><span class="line">      - public_network      = 3 -&gt; null</span><br><span class="line">      - renew_flag          = 0 -&gt; null</span><br><span class="line">      - specifications_type = &quot;profession&quot; -&gt; null</span><br><span class="line">      - subnet_id           = &quot;subnet-oy1pqvzv&quot; -&gt; null</span><br><span class="line">      - tag_set             = &#123;&#125; -&gt; null</span><br><span class="line">      - upgrade_strategy    = 1 -&gt; null</span><br><span class="line">      - vip                 = &quot;172.17.0.3&quot; -&gt; null</span><br><span class="line">      - vpc_id              = &quot;vpc-4tkroxts&quot; -&gt; null</span><br><span class="line">      - vport               = &quot;9092&quot; -&gt; null</span><br><span class="line">      - zone_id             = 200002 -&gt; null</span><br><span class="line"></span><br><span class="line">      - config &#123;</span><br><span class="line">          - auto_create_topic_enable   = true -&gt; null</span><br><span class="line">          - default_num_partitions     = 3 -&gt; null</span><br><span class="line">          - default_replication_factor = 3 -&gt; null</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      - dynamic_retention_config &#123;</span><br><span class="line">          - bottom_retention        = 0 -&gt; null</span><br><span class="line">          - disk_quota_percentage   = 0 -&gt; null</span><br><span class="line">          - enable                  = 1 -&gt; null</span><br><span class="line">          - step_forward_percentage = 0 -&gt; null</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">Plan: 0 to add, 0 to change, 1 to destroy.</span><br><span class="line"></span><br><span class="line">Do you really want to destroy all resources?</span><br><span class="line">  Terraform will destroy all your managed infrastructure, as shown above.</span><br><span class="line">  There is no undo. Only &#x27;yes&#x27; will be accepted to confirm.</span><br><span class="line"></span><br><span class="line">  Enter a value: yes</span><br><span class="line"></span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Destroying... [id=ckafka-9jnda3jn]</span><br><span class="line">module.ckafka_instance.tencentcloud_ckafka_instance.this: Destruction complete after 5s</span><br><span class="line"></span><br><span class="line">Destroy complete! Resources: 1 destroyed.</span><br></pre></td></tr></table></figure>

<h3 id="éªŒè¯é”€æ¯"><a href="#éªŒè¯é”€æ¯" class="headerlink" title="éªŒè¯é”€æ¯"></a>éªŒè¯é”€æ¯</h3><p><img src="/img_2.png" alt="img_2.png"></p>
]]></content>
  </entry>
  <entry>
    <title>gitç¯å¢ƒé…ç½®</title>
    <url>/2025/07/devops/environment/git%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h1 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h1><h2 id="è®¾ç½®ç”¨æˆ·ç­¾å"><a href="#è®¾ç½®ç”¨æˆ·ç­¾å" class="headerlink" title="è®¾ç½®ç”¨æˆ·ç­¾å"></a>è®¾ç½®ç”¨æˆ·ç­¾å</h2><p>é…ç½®ç”¨æˆ·åï¼š git config â€“global user.name ä½ çš„ç”¨æˆ·å<br>é…ç½®é‚®ç®±ï¼š git config â€“global user.email æ³¨å†Œçš„é‚®ç®±</p>
<p>é…ç½®å¥½ä¹‹åï¼Œå¯ä»¥ç”¨git config â€“global â€“listå‘½ä»¤æŸ¥çœ‹é…ç½®æ˜¯å¦OK</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git config --global --list</span></span><br><span class="line">user.name=xxx</span><br><span class="line">user.email=xxx@163.com</span><br></pre></td></tr></table></figure>

<h2 id="è®¾ç½®sshKey"><a href="#è®¾ç½®sshKey" class="headerlink" title="è®¾ç½®sshKey"></a>è®¾ç½®sshKey</h2><p>ç”Ÿæˆæ–°çš„rsaå¯†é’¥ï¼šssh-keygen -t rsa -C â€˜æ³¨å†ŒGitHubçš„é‚®ç®±â€™</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C xxx@163.com</span><br></pre></td></tr></table></figure>

<p>ä¸€ç›´å›è½¦å°±å¯ä»¥ï¼Œå³ä¸è®¾ç½®å¯†ç ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ssh-keygen -t rsa -C xxx@163.com</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/home/king/.ssh/id_rsa): </span><br><span class="line">Enter passphrase (empty for no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved in /home/king/.ssh/id_rsa</span><br><span class="line">Your public key has been saved in /home/king/.ssh/id_rsa.pub</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:n+yyy xxx@163.com</span><br><span class="line">The key&#x27;s randomart image is:</span><br><span class="line">+---[RSA 3072]----+</span><br><span class="line">|    .*=.+.       |</span><br><span class="line">|    = +=o= o     |</span><br><span class="line">|     * ++ o .    |</span><br><span class="line">|  o . o..  .     |</span><br><span class="line">| o * .  S o      |</span><br><span class="line">|. X o  o = +     |</span><br><span class="line">| + + .. = *      |</span><br><span class="line">|..o .  o E       |</span><br><span class="line">|.o==    .        |</span><br><span class="line">+----[SHA256]-----+</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶å·²ç»ç”Ÿæˆäº†ssh rasçš„å¯†é’¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> <span class="variable">$HOME</span>/.ssh</span></span><br><span class="line">authorized_keys  id_rsa  id_rsa.pub  known_hosts</span><br></pre></td></tr></table></figure>

<h2 id="è®¾ç½®githubçš„SSH-key"><a href="#è®¾ç½®githubçš„SSH-key" class="headerlink" title="è®¾ç½®githubçš„SSH key"></a>è®¾ç½®githubçš„SSH key</h2><p><img src="/img.png" alt="img.png"><br><img src="/img_1.png" alt="img_1.png"><br><img src="/img_2.png" alt="img_2.png"></p>
<p>å°†ä¸Šé¢ç”Ÿæˆçš„sshå…¬é’¥å¤åˆ¶è¿›å»ã€‚<br><img src="/img_3.png" alt="img_3.png"></p>
]]></content>
  </entry>
  <entry>
    <title>NPDä»‹ç»</title>
    <url>/2025/07/devops/npd/NPD%E4%BB%8B%E7%BB%8D/</url>
    <content><![CDATA[<h1 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1 ç®€ä»‹"></a>1 ç®€ä»‹</h1><p>å®˜æ–¹æ–‡æ¡£åº“åœ°å€ï¼š<a href="https://github.com/kubernetes/node-problem-detector">https://github.com/kubernetes/node-problem-detector</a></p>
<p>node-problem-detector æ—¨åœ¨ä½¿é›†ç¾¤ç®¡ç†å †æ ˆä¸­çš„ä¸Šæ¸¸å±‚èƒ½å¤Ÿçœ‹åˆ°å„ç§èŠ‚ç‚¹é—®é¢˜ã€‚</p>
<p>å®ƒæ˜¯ä¸€ä¸ªåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„å®ˆæŠ¤è¿›ç¨‹ï¼Œæ£€æµ‹èŠ‚ç‚¹é—®é¢˜å¹¶å°†å…¶æŠ¥å‘Šç»™apiserverã€‚</p>
<p>node-problem-detector å¯ä»¥ä½œä¸º DaemonSet è¿è¡Œï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹è¿è¡Œã€‚</p>
<p>ç°åœ¨å®ƒä½œä¸º GKEé›†ç¾¤ä¸­é»˜è®¤å¯ç”¨çš„Kubernetes Addonè¿è¡Œã€‚å®ƒä¹Ÿä½œä¸ºAKS Linux Extensionçš„ä¸€éƒ¨åˆ†åœ¨ AKS ä¸­é»˜è®¤å¯ç”¨ã€‚</p>
<h2 id="1-2-èƒŒæ™¯"><a href="#1-2-èƒŒæ™¯" class="headerlink" title="1.2 èƒŒæ™¯"></a>1.2 èƒŒæ™¯</h2><p>å¤§é‡èŠ‚ç‚¹é—®é¢˜å¯èƒ½ä¼šå½±å“èŠ‚ç‚¹ä¸Šè¿è¡Œçš„ podï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>åŸºç¡€è®¾æ–½å®ˆæŠ¤è¿›ç¨‹é—®é¢˜ï¼šntp æœåŠ¡å…³é—­ï¼›</li>
<li>ç¡¬ä»¶é—®é¢˜ï¼šCPUã€å†…å­˜æˆ–ç£ç›˜æŸåï¼›</li>
<li>å†…æ ¸é—®é¢˜ï¼šå†…æ ¸æ­»é”ã€æ–‡ä»¶ç³»ç»ŸæŸåï¼›</li>
<li>å®¹å™¨è¿è¡Œæ—¶é—®é¢˜ï¼šè¿è¡Œæ—¶å®ˆæŠ¤è¿›ç¨‹æ— å“åº”ï¼›</li>
<li>â€¦</li>
</ul>
<p>ç›®å‰ï¼Œè¿™äº›é—®é¢˜å¯¹äºé›†ç¾¤ç®¡ç†å †æ ˆä¸­çš„ä¸Šæ¸¸å±‚æ˜¯ä¸å¯è§çš„ï¼Œå› æ­¤ Kubernetes å°†ç»§ç»­å°† pod è°ƒåº¦åˆ°åèŠ‚ç‚¹ã€‚<br>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº†è¿™ä¸ªæ–°çš„å®ˆæŠ¤è¿›ç¨‹node-problem-detectoræ¥ä»å„ç§å®ˆæŠ¤è¿›ç¨‹æ”¶é›†èŠ‚ç‚¹é—®é¢˜ï¼Œå¹¶å°†å®ƒä»¬æä¾›ç»™ä¸Šæ¸¸å±‚ã€‚ä¸€æ—¦ä¸Šæ¸¸å±‚èƒ½å¤Ÿçœ‹åˆ°è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¨è®º <a href="https://github.com/kubernetes/node-problem-detector?tab=readme-ov-file#remedy-systems">remedy systems</a>äº†ã€‚</p>
<h2 id="1-3-Problem-API"><a href="#1-3-Problem-API" class="headerlink" title="1.3 Problem API"></a>1.3 Problem API</h2><p>node-problem-detector ä½¿ç”¨Eventå¹¶å‘NodeConditionapiserver æŠ¥å‘Šé—®é¢˜ã€‚</p>
<ul>
<li>NodeConditionï¼šå¯¼è‡´èŠ‚ç‚¹æ— æ³•ç”¨äº pod çš„æ°¸ä¹…æ€§é—®é¢˜åº”æŠ¥å‘Šä¸ºNodeConditionã€‚</li>
<li>Eventï¼šå¯¹ pod å½±å“æœ‰é™ä½†å…·æœ‰å‚è€ƒæ„ä¹‰çš„ä¸´æ—¶é—®é¢˜åº”æŠ¥å‘Šä¸ºEventã€‚</li>
</ul>
<h2 id="1-4-Problem-Daemon"><a href="#1-4-Problem-Daemon" class="headerlink" title="1.4 Problem Daemon"></a>1.4 Problem Daemon</h2><p>é—®é¢˜å®ˆæŠ¤è¿›ç¨‹æ˜¯ node-problem-detector çš„ä¸€ä¸ªå­å®ˆæŠ¤è¿›ç¨‹ã€‚å®ƒç›‘è§†ç‰¹å®šç±»å‹çš„èŠ‚ç‚¹é—®é¢˜å¹¶å°†å…¶æŠ¥å‘Šç»™ node-problem-detectorã€‚<br>å®ˆæŠ¤è¿›ç¨‹å¯èƒ½æ˜¯ï¼š</p>
<ul>
<li>ä¸“ä¸º Kubernetes ä¸“ç”¨ç”¨ä¾‹è®¾è®¡çš„å¾®å‹å®ˆæŠ¤è¿›ç¨‹ã€‚</li>
<li>ä¸èŠ‚ç‚¹é—®é¢˜æ£€æµ‹å™¨é›†æˆçš„ç°æœ‰èŠ‚ç‚¹å¥åº·ç›‘æ§å®ˆæŠ¤è¿›ç¨‹ã€‚</li>
</ul>
<p>ç›®å‰ï¼Œé—®é¢˜å®ˆæŠ¤è¿›ç¨‹åœ¨ node-problem-detector äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ä»¥ goroutine çš„å½¢å¼è¿è¡Œã€‚</p>
<p>æœªæ¥ï¼Œæˆ‘ä»¬ä¼šå°† node-problem-detectorå’Œé—®é¢˜å®ˆæŠ¤è¿›ç¨‹åˆ†ç¦»åˆ°ä¸åŒçš„å®¹å™¨ä¸­ï¼Œå¹¶ä½¿ç”¨ pod è§„èŒƒå°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ã€‚</p>
<p>æ¯ç§ç±»å‹çš„é—®é¢˜å®ˆæŠ¤è¿›ç¨‹éƒ½å¯ä»¥é€šè¿‡è®¾ç½®ç›¸åº”çš„æ„å»ºæ ‡ç­¾åœ¨ç¼–è¯‘æ—¶ç¦ç”¨ã€‚</p>
<p>å¦‚æœåœ¨ç¼–è¯‘æ—¶ç¦ç”¨å®ƒä»¬ï¼Œåˆ™å®ƒä»¬çš„æ‰€æœ‰æ„å»ºä¾èµ–é¡¹ã€å…¨å±€å˜é‡å’Œåå°goroutine éƒ½å°†ä»ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­å‰”é™¤ã€‚</p>
<p>æ”¯æŒçš„å®ˆæŠ¤è¿›ç¨‹åˆ—è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th>é—®é¢˜å®ˆæŠ¤è¿›ç¨‹ç±»å‹</th>
<th>èŠ‚ç‚¹çŠ¶æ€</th>
<th>è§£é‡Š</th>
<th>é…ç½®</th>
<th>ç¦ç”¨æ„å»ºæ ‡ç­¾</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://github.com/kubernetes/node-problem-detector/tree/master/pkg/systemlogmonitor">SystemLogMonitor</a></td>
<td>KernelDeadlock ReadonlyFilesystem FrequentKubeletRestart FrequentDockerRestart FrequentContainerdRestart</td>
<td>ç³»ç»Ÿæ—¥å¿—ç›‘è§†å™¨ç›‘è§†ç³»ç»Ÿæ—¥å¿—å¹¶æ ¹æ®é¢„å®šä¹‰çš„è§„åˆ™æŠ¥å‘Šé—®é¢˜å’ŒæŒ‡æ ‡ã€‚</td>
<td><a href="https://github.com/kubernetes/node-problem-detector/blob/master/config/kernel-monitor-filelog.json">filelog</a>, <a href="https://github.com/kubernetes/node-problem-detector/blob/master/config/kernel-monitor.json">kmsg</a>, <a href="https://github.com/kubernetes/node-problem-detector/blob/master/config/kernel-monitor-counter.json">kernel</a>, <a href="https://github.com/kubernetes/node-problem-detector/blob/master/config/systemd-monitor-counter.json">abrt</a>, <a href="https://github.com/kubernetes/node-problem-detector/blob/master/config/systemd-monitor-counter.json">systemd</a></td>
<td>disable_system_log_monitor</td>
</tr>
<tr>
<td><a href="https://github.com/kubernetes/node-problem-detector/tree/master/pkg/systemstatsmonitor">SystemStatsMonitor</a></td>
<td>None(Could be added in the future)</td>
<td>èŠ‚ç‚¹é—®é¢˜æ£€æµ‹å™¨çš„ç³»ç»Ÿç»Ÿè®¡ç›‘è§†å™¨ï¼Œç”¨äºæ”¶é›†å„ç§ä¸å¥åº·ç›¸å…³çš„ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯ä½œä¸ºæŒ‡æ ‡ã€‚è¯·å‚é˜…<a href="https://docs.google.com/document/d/1SeaUz6kBavI283Dq8GBpoEUDrHA2a795xtw0OvjM568/edit">æ­¤å¤„</a>çš„ææ¡ˆã€‚</td>
<td><a href="https://github.com/kubernetes/node-problem-detector/blob/master/config/system-stats-monitor.json">system-stats-monitor</a></td>
<td>disable_system_stats_monitor</td>
</tr>
<tr>
<td><a href="https://github.com/kubernetes/node-problem-detector/tree/master/pkg/custompluginmonitor">CustomPluginMonitor</a></td>
<td>On-demand(According to users configuration), existing example: NTPProblem</td>
<td>ä¸€ä¸ªè‡ªå®šä¹‰çš„ node-problem-detector æ’ä»¶ç›‘æ§å™¨ï¼Œç”¨äºè°ƒç”¨å’Œæ£€æŸ¥å„ç§èŠ‚ç‚¹é—®é¢˜ï¼Œå¹¶ä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„æ£€æŸ¥è„šæœ¬ã€‚è¯·å‚é˜…<a href="https://docs.google.com/document/d/1jK_5YloSYtboj-DtfjmYKxfNnUxCAvohLnsH5aGCAYQ/edit#">æ­¤å¤„</a>çš„ææ¡ˆã€‚</td>
<td><a href="https://github.com/kubernetes/node-problem-detector/blob/4ad49bbd84b8ced45ac825eac01ec93d9235935e/config/custom-plugin-monitor.json">example</a></td>
<td>disable_custom_plugin_monitor</td>
</tr>
<tr>
<td><a href="https://github.com/kubernetes/node-problem-detector/tree/master/pkg/healthchecker">HealthChecker</a></td>
<td>KubeletUnhealthy ContainerRuntimeUnhealthy</td>
<td>èŠ‚ç‚¹é—®é¢˜æ£€æµ‹å™¨çš„å¥åº·æ£€æŸ¥å™¨ç”¨äºæ£€æŸ¥ kubelet å’Œå®¹å™¨è¿è¡Œæ—¶çš„å¥åº·çŠ¶å†µã€‚</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="1-5-Exporter"><a href="#1-5-Exporter" class="headerlink" title="1.5 Exporter"></a>1.5 Exporter</h2><p>exporter æ˜¯ node-problem-detector çš„ä¸€ä¸ªç»„ä»¶ã€‚</p>
<p>å®ƒå‘æŸäº›åç«¯æŠ¥å‘ŠèŠ‚ç‚¹é—®é¢˜ å’Œ&#x2F;æˆ– æŒ‡æ ‡ã€‚</p>
<p>å…¶ä¸­ä¸€äº›å¯ä»¥åœ¨ç¼–è¯‘æ—¶ä½¿ç”¨æ„å»ºæ ‡è®°ç¦ç”¨ã€‚æ”¯æŒçš„å¯¼å‡ºå™¨åˆ—è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th>Exporter</th>
<th>è§£é‡Š</th>
<th>ç¦ç”¨æ„å»ºæ ‡ç­¾</th>
</tr>
</thead>
<tbody><tr>
<td>Kubernetes exporter</td>
<td>Kubernetes å¯¼å‡ºå™¨å‘ Kubernetes API æœåŠ¡å™¨æŠ¥å‘ŠèŠ‚ç‚¹é—®é¢˜ï¼šä¸´æ—¶é—®é¢˜æŠ¥å‘Šä¸ºäº‹ä»¶ï¼Œæ°¸ä¹…é—®é¢˜æŠ¥å‘Šä¸ºèŠ‚ç‚¹çŠ¶å†µã€‚</td>
<td></td>
</tr>
<tr>
<td>Prometheus exporter</td>
<td>Prometheus å¯¼å‡ºå™¨å°†èŠ‚ç‚¹é—®é¢˜å’ŒæŒ‡æ ‡æœ¬åœ°æŠ¥å‘Šä¸º Prometheus æŒ‡æ ‡</td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/kubernetes/node-problem-detector/blob/master/config/exporter/stackdriver-exporter.json">Stackdriver exporter</a></td>
<td>Stackdriver å¯¼å‡ºå™¨å‘ Stackdriver Monitoring API æŠ¥å‘ŠèŠ‚ç‚¹é—®é¢˜å’ŒæŒ‡æ ‡ã€‚</td>
<td>disable_stackdriver_exporter</td>
</tr>
</tbody></table>
<h2 id="1-6-ç”¨æ³•"><a href="#1-6-ç”¨æ³•" class="headerlink" title="1.6 ç”¨æ³•"></a>1.6 ç”¨æ³•</h2><h3 id="1-6-1-æ ‡å¿—"><a href="#1-6-1-æ ‡å¿—" class="headerlink" title="1.6.1 æ ‡å¿—"></a>1.6.1 æ ‡å¿—</h3><ul>
<li>â€“versionï¼šæ‰“å°èŠ‚ç‚¹é—®é¢˜æ£€æµ‹å™¨çš„å½“å‰ç‰ˆæœ¬ã€‚</li>
<li>â€“hostname-overrideï¼šnode-problem-detector ç”¨äºæ›´æ–°çŠ¶æ€å’Œå‘å‡ºäº‹ä»¶çš„è‡ªå®šä¹‰èŠ‚ç‚¹åç§°ã€‚node-problem-detector é¦–å…ˆä»hostname-overrideè·å–èŠ‚ç‚¹åç§°ï¼Œç„¶åä»NODE_NAMEç¯å¢ƒå˜é‡ è·å–ï¼Œæœ€åè¿”å›åˆ°os.Hostnameã€‚</li>
</ul>
<h3 id="1-6-2-å¯¹äºç³»ç»Ÿæ—¥å¿—ç›‘æ§"><a href="#1-6-2-å¯¹äºç³»ç»Ÿæ—¥å¿—ç›‘æ§" class="headerlink" title="1.6.2 å¯¹äºç³»ç»Ÿæ—¥å¿—ç›‘æ§"></a>1.6.2 å¯¹äºç³»ç»Ÿæ—¥å¿—ç›‘æ§</h3><ul>
<li>â€“config.system-log-monitorï¼šç³»ç»Ÿæ—¥å¿—ç›‘è§†å™¨é…ç½®æ–‡ä»¶è·¯å¾„åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ config&#x2F;kernel-monitor.jsonã€‚èŠ‚ç‚¹é—®é¢˜æ£€æµ‹å™¨å°†ä¸ºæ¯ä¸ªé…ç½®å¯åŠ¨å•ç‹¬çš„æ—¥å¿—ç›‘è§†å™¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ—¥å¿—ç›‘è§†å™¨æ¥ç›‘è§†ä¸åŒçš„ç³»ç»Ÿæ—¥å¿—ã€‚</li>
</ul>
<h3 id="1-6-3-å¯¹äºç³»ç»Ÿç»Ÿè®¡ç›‘æ§"><a href="#1-6-3-å¯¹äºç³»ç»Ÿç»Ÿè®¡ç›‘æ§" class="headerlink" title="1.6.3 å¯¹äºç³»ç»Ÿç»Ÿè®¡ç›‘æ§"></a>1.6.3 å¯¹äºç³»ç»Ÿç»Ÿè®¡ç›‘æ§</h3><ul>
<li>â€“config.system-stats-monitorï¼šç³»ç»Ÿç»Ÿè®¡ç›‘æ§é…ç½®æ–‡ä»¶çš„è·¯å¾„åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ <a href="https://github.com/kubernetes/node-problem-detector/blob/master/config/system-stats-monitor.json">config&#x2F;system-stats-monitor.json</a>ã€‚èŠ‚ç‚¹é—®é¢˜æ£€æµ‹å™¨å°†ä¸ºæ¯ä¸ªé…ç½®å¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„ç³»ç»Ÿç»Ÿè®¡ç›‘æ§å™¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸åŒçš„ç³»ç»Ÿç»Ÿè®¡ç›‘æ§å™¨æ¥ç›‘æ§ä¸é—®é¢˜ç›¸å…³çš„ä¸åŒç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯ã€‚</li>
</ul>
<h3 id="1-6-4-å¯¹äºè‡ªå®šä¹‰æ’ä»¶ç›‘è§†å™¨"><a href="#1-6-4-å¯¹äºè‡ªå®šä¹‰æ’ä»¶ç›‘è§†å™¨" class="headerlink" title="1.6.4 å¯¹äºè‡ªå®šä¹‰æ’ä»¶ç›‘è§†å™¨"></a>1.6.4 å¯¹äºè‡ªå®šä¹‰æ’ä»¶ç›‘è§†å™¨</h3><ul>
<li>â€“config.custom-plugin-monitorï¼šè‡ªå®šä¹‰æ’ä»¶ç›‘æ§é…ç½®æ–‡ä»¶è·¯å¾„åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ <a href="https://github.com/kubernetes/node-problem-detector/blob/master/config/custom-plugin-monitor.json">config&#x2F;custom-plugin-monitor.json</a>ã€‚èŠ‚ç‚¹é—®é¢˜æ£€æµ‹å™¨å°†ä¸ºæ¯ä¸ªé…ç½®å¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„è‡ªå®šä¹‰æ’ä»¶ç›‘æ§ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸åŒçš„è‡ªå®šä¹‰æ’ä»¶ç›‘æ§æ¥ç›‘æ§ä¸åŒçš„èŠ‚ç‚¹é—®é¢˜ã€‚</li>
</ul>
<h3 id="1-6-5-å¯¹äºå¥åº·æ£€æŸ¥è€…"><a href="#1-6-5-å¯¹äºå¥åº·æ£€æŸ¥è€…" class="headerlink" title="1.6.5 å¯¹äºå¥åº·æ£€æŸ¥è€…"></a>1.6.5 å¯¹äºå¥åº·æ£€æŸ¥è€…</h3><ul>
<li>â€“enable-k8s-exporterï¼šå¯ç”¨å‘ Kubernetes API æœåŠ¡å™¨æŠ¥å‘Šï¼Œé»˜è®¤ä¸ºtrueã€‚</li>
<li>â€“apiserver-overrideï¼šç”¨äºè‡ªå®šä¹‰ node-problem-detector å¦‚ä½•è¿æ¥ apiserver çš„ URI å‚æ•°ã€‚å¦‚æœâ€“enable-k8s-exporteræ˜¯ï¼Œåˆ™å¿½ç•¥æ­¤å‚æ•°ã€‚æ ¼å¼ä¸<a href="https://github.com/kubernetes/heapster">Heapster</a> çš„æ ‡å¿—falseç›¸åŒã€‚ä¾‹å¦‚ï¼Œè¦æ— éœ€èº«ä»½éªŒè¯å³å¯è¿è¡Œï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹é…ç½®ï¼š <a href="https://github.com/kubernetes/heapster/blob/master/docs/source-configuration.md#kubernetes">source</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://APISERVER_IP:APISERVER_PORT?inClusterConfig=false</span><br></pre></td></tr></table></figure>

<p>è¯·å‚é˜…<a href="https://github.com/kubernetes/heapster/blob/master/docs/source-configuration.md#kubernetes">heapster æ–‡æ¡£</a><br>ä»¥è·å–å¯ç”¨é€‰é¡¹çš„å®Œæ•´åˆ—è¡¨ã€‚</p>
<ul>
<li>â€“addressï¼šç»‘å®šèŠ‚ç‚¹é—®é¢˜æ£€æµ‹æœåŠ¡å™¨çš„åœ°å€ã€‚</li>
<li>â€“portï¼šç»‘å®šèŠ‚ç‚¹é—®é¢˜æ£€æµ‹æœåŠ¡å™¨çš„ç«¯å£ã€‚ä½¿ç”¨ 0 è¡¨ç¤ºç¦ç”¨ã€‚</li>
</ul>
<h3 id="1-6-6-å¯¹äº-Prometheus-exporter"><a href="#1-6-6-å¯¹äº-Prometheus-exporter" class="headerlink" title="1.6.6 å¯¹äº Prometheus exporter"></a>1.6.6 å¯¹äº Prometheus exporter</h3><ul>
<li>â€“prometheus-addressï¼šç»‘å®šPrometheusæŠ“å–ç«¯ç‚¹çš„åœ°å€ï¼Œé»˜è®¤ä¸º127.0.0.1ã€‚</li>
<li>â€“prometheus-portï¼šç»‘å®š Prometheus æŠ“å–ç«¯ç‚¹çš„ç«¯å£ï¼Œé»˜è®¤ä¸º 20257ã€‚ä½¿ç”¨ 0 è¡¨ç¤ºç¦ç”¨ã€‚</li>
</ul>
<h3 id="1-6-7-å¯¹äº-Stackdriver-exporter"><a href="#1-6-7-å¯¹äº-Stackdriver-exporter" class="headerlink" title="1.6.7 å¯¹äº Stackdriver exporter"></a>1.6.7 å¯¹äº Stackdriver exporter</h3><ul>
<li>â€“exporter.stackdriverï¼šStackdriver å¯¼å‡ºå™¨é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œä¾‹å¦‚config&#x2F;exporter&#x2F;stackdriver-exporter.jsonï¼Œé»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²ã€‚è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²å³å¯ç¦ç”¨ã€‚</li>
</ul>
<h3 id="1-6-8-å·²å¼ƒç”¨çš„æ ‡å¿—"><a href="#1-6-8-å·²å¼ƒç”¨çš„æ ‡å¿—" class="headerlink" title="1.6.8 å·²å¼ƒç”¨çš„æ ‡å¿—"></a>1.6.8 å·²å¼ƒç”¨çš„æ ‡å¿—</h3><ul>
<li>â€“system-log-monitorsï¼šç³»ç»Ÿæ—¥å¿—ç›‘æ§é…ç½®æ–‡ä»¶çš„è·¯å¾„åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”ã€‚æ­¤é€‰é¡¹å·²å¼ƒç”¨ï¼Œç”±â€“config.system-log-monitoræ›¿ä»£ï¼Œå¹¶å°†è¢«åˆ é™¤ã€‚å¦‚æœåŒæ—¶è®¾ç½®â€“system-log-monitorså’Œ â€“config.system-log-monitor ï¼Œ NPD å°†å´©æºƒã€‚</li>
<li>â€“custom-plugin-monitorsï¼šè‡ªå®šä¹‰æ’ä»¶ç›‘æ§é…ç½®æ–‡ä»¶çš„è·¯å¾„åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”ã€‚æ­¤é€‰é¡¹å·²å¼ƒç”¨ï¼Œç”±â€“config.custom-plugin-monitoræ›¿ä»£ï¼Œå¹¶å°†è¢«åˆ é™¤ã€‚å¦‚æœåŒæ—¶è®¾ç½®â€“custom-plugin-monitorså’Œ â€“config.custom-plugin-monitorï¼ŒNPD å°†å´©æºƒã€‚</li>
</ul>
<h2 id="1-7-æ„å»ºé•œåƒ"><a href="#1-7-æ„å»ºé•œåƒ" class="headerlink" title="1.7 æ„å»ºé•œåƒ"></a>1.7 æ„å»ºé•œåƒ</h2><ul>
<li>å®‰è£…libsystemdARM GCC å·¥å…·é“¾çš„å¼€å‘ä¾èµ–é¡¹<ul>
<li>Debian &#x2F; Ubuntuï¼šapt install libsystemd-dev gcc-aarch64-linux-gnu</li>
</ul>
</li>
<li>git clone <a href="mailto:&#x67;&#x69;&#x74;&#x40;&#x67;&#x69;&#116;&#x68;&#117;&#98;&#x2e;&#99;&#x6f;&#x6d;">&#x67;&#x69;&#x74;&#x40;&#x67;&#x69;&#116;&#x68;&#117;&#98;&#x2e;&#99;&#x6f;&#x6d;</a>:kubernetes&#x2F;node-problem-detector.git</li>
<li>åœ¨é¡¶å±‚ç›®å½•ä¸­è¿è¡Œmakeã€‚å®ƒå°†ï¼š<ul>
<li>æ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶ã€‚</li>
<li>æ„å»ºdockeré•œåƒã€‚äºŒè¿›åˆ¶æ–‡ä»¶å’Œconfig&#x2F;è¢«å¤åˆ¶åˆ°dockeré•œåƒä¸­ã€‚</li>
</ul>
</li>
</ul>
<p>å¦‚æœæ‚¨ä¸éœ€è¦æŸäº›ç±»åˆ«çš„é—®é¢˜å®ˆæŠ¤è¿›ç¨‹ï¼Œæ‚¨å¯ä»¥é€‰æ‹©åœ¨ç¼–è¯‘æ—¶ç¦ç”¨å®ƒä»¬ã€‚è¿™æ˜¯ä¿æŒ node-problem-detectorè¿è¡Œæ—¶ç´§å‡‘ä¸”æ²¡æœ‰ä¸å¿…è¦ä»£ç ï¼ˆä¾‹å¦‚å…¨å±€å˜é‡ã€goroutines ç­‰ï¼‰çš„æœ€ä½³æ–¹æ³•ã€‚</p>
<p>æ‚¨å¯ä»¥é€šè¿‡BUILD_TAGSåœ¨è¿è¡Œä¹‹å‰è®¾ç½®ç¯å¢ƒå˜é‡æ¥å®ç°è¿™ä¸€ç‚¹makeã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">BUILD_TAGS=&quot;disable_custom_plugin_monitor disable_system_stats_monitor&quot; make</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°å‘½ä»¤å°†åœ¨ä¸ä½¿ç”¨<a href="https://github.com/kubernetes/node-problem-detector/tree/master/pkg/custompluginmonitor">è‡ªå®šä¹‰æ’ä»¶ç›‘è§†å™¨</a>å’Œ<a href="https://github.com/kubernetes/node-problem-detector/tree/master/pkg/systemstatsmonitor">ç³»ç»Ÿç»Ÿè®¡ç›‘è§†å™¨</a>çš„æƒ…å†µä¸‹ç¼–è¯‘node-problem-detector ã€‚æŸ¥çœ‹<a href="https://github.com/kubernetes/node-problem-detector#problem-daemon">é—®é¢˜å®ˆæŠ¤è¿›ç¨‹</a>éƒ¨åˆ†ï¼Œäº†è§£å¦‚ä½•åœ¨ç¼–è¯‘æ—¶ç¦ç”¨æ¯ä¸ªé—®é¢˜å®ˆæŠ¤è¿›ç¨‹ã€‚</p>
<h2 id="1-8-æ¨é€é•œåƒ"><a href="#1-8-æ¨é€é•œåƒ" class="headerlink" title="1.8 æ¨é€é•œåƒ"></a>1.8 æ¨é€é•œåƒ</h2><p><code>make push</code>å°† docker é•œåƒä¸Šä¼ åˆ°æ³¨å†Œè¡¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé•œåƒå°†ä¸Šä¼ åˆ° <code>staging-k8s.gcr.io</code>ã€‚å¯ä»¥è½»æ¾ä¿®æ”¹<code>Makefile</code>ä»¥å°†é•œåƒæ¨é€åˆ°å¦ä¸€ä¸ªæ³¨å†Œè¡¨ã€‚</p>
<h2 id="1-9-å®‰è£…"><a href="#1-9-å®‰è£…" class="headerlink" title="1.9 å®‰è£…"></a>1.9 å®‰è£…</h2><p>å°† node-problem-detector<br>å®‰è£…åˆ°é›†ç¾¤ä¸­çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨<a href="https://github.com/deliveryhero/helm-charts/tree/master/stable/node-problem-detector">Helm å›¾è¡¨</a>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">helm repo add deliveryhero https://charts.deliveryhero.io/</span><br><span class="line">helm install --generate-name deliveryhero/node-problem-detector</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼Œæ‰‹åŠ¨å®‰è£… node-problem-detectorï¼š</p>
<p>ç¼–è¾‘<a href="https://github.com/kubernetes/node-problem-detector/blob/master/deployment/node-problem-detector.yaml">node-problem-detector.yaml</a>ä»¥é€‚åº”æ‚¨çš„ç¯å¢ƒã€‚å°†<code>log</code>å·è®¾ç½®ä¸ºæ‚¨çš„ç³»ç»Ÿæ—¥å¿—ç›®å½•ï¼ˆç”± SystemLogMonitor ä½¿ç”¨ï¼‰ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ ConfigMap è¦†ç›–<code>config</code> pod å†…çš„ç›®å½•ã€‚</p>
<p>ç¼–è¾‘<a href="https://github.com/kubernetes/node-problem-detector/blob/master/deployment/node-problem-detector-config.yaml">node-problem-detector-config.yaml</a>æ¥é…ç½® node-problem-detectorã€‚</p>
<ul>
<li>ç¼–è¾‘<a href="https://github.com/kubernetes/node-problem-detector/blob/master/deployment/rbac.yaml">rbac.yaml</a>ä»¥é€‚åˆæ‚¨çš„ç¯å¢ƒã€‚</li>
<li>ä½¿ç”¨ åˆ›å»º ServiceAccount å’Œ ClusterRoleBinding <code>kubectl create -f rbac.yaml</code>ã€‚</li>
<li>ä½¿ç”¨ åˆ›å»º ConfigMap <code>kubectl create -f node-problem-detector-config.yaml</code>ã€‚</li>
<li>ä½¿ç”¨ åˆ›å»º DaemonSet <code>kubectl create -f node-problem-detector.yaml</code>ã€‚</li>
</ul>
<h2 id="1-10-å¼€å§‹ç‹¬ç«‹è¿è¡Œ"><a href="#1-10-å¼€å§‹ç‹¬ç«‹è¿è¡Œ" class="headerlink" title="1.10 å¼€å§‹ç‹¬ç«‹è¿è¡Œ"></a>1.10 å¼€å§‹ç‹¬ç«‹è¿è¡Œ</h2><p>è¦ç‹¬ç«‹è¿è¡Œ node-problem-detectorï¼Œæ‚¨åº”è¯¥è®¾ç½®inClusterConfigä¸ºfalseï¼Œå¹¶ä¸”æ•™ node-problem-detector å¦‚ä½• è®¿é—® apiserverï¼Œä¹Ÿå°±æ˜¯apiserver-overrideã€‚</p>
<p>è¦ä½¿ç”¨ä¸å®‰å…¨çš„ apiserver è¿æ¥ç‹¬ç«‹è¿è¡Œ node-problem-detectorï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">node-problem-detector --apiserver-override=http://APISERVER_IP:APISERVER_INSECURE_PORT?inClusterConfig=false</span><br></pre></td></tr></table></figure>

<p>æ›´å¤šåœºæ™¯è¯·è§<a href="https://github.com/kubernetes/heapster/blob/master/docs/source-configuration.md#kubernetes">æ­¤å¤„</a></p>
<h2 id="1-11-è¯•ç”¨"><a href="#1-11-è¯•ç”¨" class="headerlink" title="1.11 è¯•ç”¨"></a>1.11 è¯•ç”¨</h2><p>æ‚¨å¯ä»¥åœ¨æ­£åœ¨è¿è¡Œçš„é›†ç¾¤ä¸­å°è¯•ä½¿ç”¨ node-problem-detectorï¼Œæ–¹æ³•æ˜¯å°†æ¶ˆæ¯æ³¨å…¥åˆ° node-problem-detector æ­£åœ¨ç›‘è§†çš„æ—¥å¿—ä¸­ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾ node-problem-detector æ­£åœ¨ä½¿ç”¨KernelMonitorã€‚</p>
<p>åœ¨æ‚¨çš„æœºå™¨ä¸Šè¿è¡Œ<code>kubectl get events -w</code>ã€‚åœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œ<code>sudo sh -c &quot;echo &#39;kernel: BUG: unable to handle kernel NULL pointer dereference at TESTING&#39; &gt;&gt; /dev/kmsg&quot;</code>ã€‚ç„¶åæ‚¨åº”è¯¥ä¼šçœ‹åˆ°è¯¥KernelOopssäº‹ä»¶ã€‚</p>
<p>æ·»åŠ æ–°è§„åˆ™æˆ–å¼€å‘èŠ‚ç‚¹é—®é¢˜æ£€æµ‹å™¨æ—¶ï¼Œåœ¨ç‹¬ç«‹æ¨¡å¼ä¸‹åœ¨æœ¬åœ°å·¥ä½œç«™ä¸Šè¿›è¡Œæµ‹è¯•å¯èƒ½æ›´å®¹æ˜“ã€‚</p>
<p>å¯¹äº API æœåŠ¡å™¨ï¼Œä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨kubectl proxyæ­£åœ¨è¿è¡Œçš„é›†ç¾¤çš„ API æœåŠ¡å™¨åœ¨æœ¬åœ°å¯ç”¨ã€‚</p>
<p>æ‚¨ä¼šæ”¶åˆ°ä¸€äº›é”™è¯¯ï¼Œå› ä¸º API æœåŠ¡å™¨æ— æ³•è¯†åˆ«æ‚¨çš„æœ¬åœ°å·¥ä½œç«™ã€‚ä½†æ— è®ºå¦‚ä½•ï¼Œæ‚¨ä»ç„¶åº”è¯¥èƒ½å¤Ÿæµ‹è¯•æ‚¨çš„æ–°è§„åˆ™ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæµ‹è¯•KernelMonitorè§„åˆ™ï¼š</p>
<ul>
<li><code>make</code>ï¼ˆæœ¬åœ°æ„å»ºnode-problem-detectorï¼‰</li>
<li><code>kubectl proxy --port=8080</code>ï¼ˆä½¿æ­£åœ¨è¿è¡Œçš„é›†ç¾¤çš„ API æœåŠ¡å™¨åœ¨æœ¬åœ°å¯ç”¨ï¼‰</li>
<li>å°†KernelMonitoræ›´æ–°åˆ°æ‚¨çš„æœ¬åœ°å†…æ ¸æ—¥å¿—ç›®å½•<code>logPath</code>ã€‚ä¾‹å¦‚ï¼Œåœ¨æŸäº› Linux ç³»ç»Ÿä¸Šï¼Œå®ƒæ˜¯<code>/run/log/journal</code>, è€Œä¸æ˜¯<code>/var/log/journal</code>ã€‚</li>
<li><code>./bin/node-problem-detector --logtostderr --apiserver-override=http://127.0.0.1:8080?inClusterConfig=false --config.system-log-monitor=config/kernel-monitor.json --config.system-stats-monitor=config/system-stats-monitor.json --port=20256 --prometheus-port=2025</code>ï¼ˆæˆ–æŒ‡å‘ä»»ä½• API æœåŠ¡å™¨åœ°å€ï¼šç«¯å£å’Œ Prometheus ç«¯å£ï¼‰</li>
<li><code>sudo sh -c &quot;echo &#39;kernel: BUG: unable to handle kernel NULL pointer dereference at TESTING&#39; &gt;&gt; /dev/kmsg&quot;</code></li>
<li>æ‚¨å¯ä»¥<code>KernelOops</code>åœ¨èŠ‚ç‚¹é—®é¢˜æ£€æµ‹å™¨æ—¥å¿—ä¸­çœ‹åˆ°äº‹ä»¶ã€‚</li>
<li><code>sudo sh -c &quot;echo &#39;kernel: INFO: task docker:20744 blocked for more than 120 seconds.&#39; &gt;&gt; /dev/kmsg&quot;</code></li>
<li>æ‚¨å¯ä»¥åœ¨node-problem-detector logçœ‹DockerHung eventå’ŒçŠ¶æ€</li>
<li>æ‚¨å¯ä»¥åœ¨<a href="http://127.0.0.1:20256/conditions%E6%9F%A5%E7%9C%8B%60DockerHung%60%E7%8A%B6%E6%80%81">http://127.0.0.1:20256/conditionsæŸ¥çœ‹DockerHungçŠ¶æ€</a></li>
<li>æ‚¨å¯ä»¥åœ¨<a href="http://127.0.0.1:20257/metrics%E4%B8%8A%E6%9F%A5%E7%9C%8B">http://127.0.0.1:20257/metrics</a>ä¸ŠæŸ¥çœ‹ Prometheus æ ¼å¼çš„ç£ç›˜ç›¸å…³ç³»ç»ŸæŒ‡æ ‡ã€‚</li>
</ul>
<p>æ³¨ï¼š æ‚¨å¯ä»¥åœ¨<a href="https://github.com/kubernetes/node-problem-detector/tree/master/test/kernel_log_generator/problems">test&#x2F;kernel_log_generator&#x2F;problems</a>ä¸‹æŸ¥çœ‹æ›´å¤šè§„åˆ™ç¤ºä¾‹ã€‚</p>
<ul>
<li>å¯¹äº<a href="https://github.com/kubernetes/node-problem-detector/blob/master/config/kernel-monitor.json">KernelMonitor</a><br>æ¶ˆæ¯æ³¨å…¥ï¼Œæ‰€æœ‰æ¶ˆæ¯éƒ½åº”è¯¥æœ‰kernel: å‰ç¼€ï¼ˆå¦è¯·æ³¨æ„ï¼Œåé¢æœ‰ä¸€ä¸ªç©ºæ ¼:ï¼‰ï¼›æˆ–è€…ä½¿ç”¨<a href="https://github.com/kubernetes/node-problem-detector/blob/master/test/kernel_log_generator/generator.sh">generator.sh</a>ã€‚</li>
<li>è¦å°†å…¶ä»–æ—¥å¿—ï¼ˆå¦‚ systemd æ—¥å¿—ï¼‰æ³¨å…¥ journaldï¼Œè¯·ä½¿ç”¨<code>echo &#39;Some systemd message&#39; | systemd-cat -t systemd</code>ã€‚</li>
</ul>
<h2 id="1-12-Remedy-Systems"><a href="#1-12-Remedy-Systems" class="headerlink" title="1.12 Remedy Systems"></a>1.12 Remedy Systems</h2><p>Remedy Systemsæ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ—¨åœ¨å°è¯•è§£å†³node-problem-detectoræ£€æµ‹åˆ°çš„é—®é¢˜çš„è¿‡ç¨‹ã€‚</p>
<p>Remedy Systemsä¼šè§‚å¯Ÿnode-problem-detectorå‘å‡ºçš„äº‹ä»¶ å’Œ&#x2F;æˆ– èŠ‚ç‚¹çŠ¶å†µï¼Œå¹¶é‡‡å–æªæ–½ä½¿ Kubernetes é›†ç¾¤æ¢å¤å¥åº·çŠ¶æ€ã€‚</p>
<p>è¡¥æ•‘ç³»ç»Ÿæœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li><a href="https://github.com/planetlabs/draino">Draino</a> æ ¹æ®æ ‡ç­¾å’ŒèŠ‚ç‚¹æ¡ä»¶è‡ªåŠ¨æ’ç©º KubernetesèŠ‚ç‚¹ã€‚ä¸æ‰€æœ‰æä¾›çš„æ ‡ç­¾å’Œä»»ä½•æä¾›çš„èŠ‚ç‚¹æ¡ä»¶åŒ¹é…çš„èŠ‚ç‚¹å°†è¢«é˜»æ­¢ç«‹å³æ¥å—æ–° podï¼ˆä¹Ÿç§°ä¸ºâ€œå°é”â€ï¼‰ï¼Œå¹¶åœ¨å¯é…ç½®çš„æ—¶é—´å<a href="https://kubernetes.io/docs/tasks/administer-cluster/safely-drain-node/">æ’ç©º</a>ã€‚Drainoå¯ä»¥ä¸ <a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler">Cluster Autoscaler</a>ç»“åˆä½¿ç”¨ï¼Œä»¥è‡ªåŠ¨ç»ˆæ­¢æ’ç©ºçš„èŠ‚ç‚¹ã€‚è¯·å‚é˜… <a href="https://github.com/kubernetes/node-problem-detector/issues/199">æ­¤é—®é¢˜</a> ï¼Œäº†è§£ Drainoçš„ç¤ºä¾‹ç”Ÿäº§ç”¨ä¾‹ã€‚</li>
<li><a href="https://github.com/kubernetes-sigs/descheduler">Descheduler</a> å–æ¶ˆè°ƒåº¦ç­–ç•¥RemovePodsViolatingNodeTaintsä¼šé©±é€èŠ‚ç‚¹ä¸Šè¿åNoScheduleæ±¡æŸ“çš„Podã€‚å¿…é¡»å¯ç”¨k8sè°ƒåº¦ç¨‹åºçš„TaintNodesByConditionåŠŸèƒ½ã€‚</li>
<li><a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler">Cluster Autoscaler</a> å¯ç”¨äºè‡ªåŠ¨ç»ˆæ­¢è€—å°½çš„èŠ‚ç‚¹ã€‚</li>
<li><a href="https://github.com/medik8s">mediK8S</a> æ˜¯ä¸€ä¸ªåŸºäº<a href="https://github.com/medik8s/node-healthcheck-operator">Node Health Check Operator (NHC)</a>æ„å»ºçš„è‡ªåŠ¨ä¿®å¤ç³»ç»Ÿçš„æ€»ä½“é¡¹ç›®ï¼Œè¯¥ç³»ç»Ÿç›‘æ§èŠ‚ç‚¹çŠ¶å†µå¹¶ä½¿ç”¨ä¿®å¤ APIå°†ä¿®å¤å§”æ‰˜ç»™å¤–éƒ¨ä¿®å¤ç¨‹åºã€‚</li>
<li><a href="https://github.com/medik8s/poison-pill">Poison-Pill</a>æ˜¯ä¸€ä¸ªä¿®å¤ç¨‹åºï¼Œå®ƒå°†é‡æ–°å¯åŠ¨èŠ‚ç‚¹å¹¶ç¡®ä¿æ‰€æœ‰æœ‰çŠ¶æ€çš„å·¥ä½œè´Ÿè½½éƒ½å¾—åˆ°é‡æ–°å®‰æ’ã€‚å¦‚æœé›†ç¾¤å…·æœ‰è¶³å¤Ÿçš„å¥åº·å®¹é‡ï¼ŒNHCæ”¯æŒæœ‰æ¡ä»¶åœ°è¿›è¡Œä¿®å¤ï¼Œæˆ–è€…æ‰‹åŠ¨æš‚åœä»»ä½•æ“ä½œä»¥æœ€å¤§é™åº¦åœ°å‡å°‘é›†ç¾¤ä¸­æ–­ã€‚</li>
<li><a href="https://cluster-api.sigs.k8s.io/">Cluster API</a> çš„<a href="https://cluster-api.sigs.k8s.io/developer/architecture/controllers/machine-health-check">MachineHealthCheck</a>è´Ÿè´£ä¿®å¤ä¸å¥åº·çš„æœºå™¨ã€‚</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>Npdä»£ç ç»“æ„äº†è§£</title>
    <url>/2025/07/devops/npd/Npd%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84%E4%BA%86%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="1-pkgç›®å½•ç»“æ„"><a href="#1-pkgç›®å½•ç»“æ„" class="headerlink" title="1 pkgç›®å½•ç»“æ„"></a>1 pkgç›®å½•ç»“æ„</h1><p>è¿™é‡Œæ˜¯å„ä¸ªmonitorçš„å®ç°ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ custompluginmonitor             -&gt; ç”¨äºå®ç°è‡ªå®šä¹‰ç›‘è§†æ’ä»¶ã€‚node-problem-detector æ”¯æŒé€šè¿‡æ’ä»¶ç›‘è§†ç‰¹å®šçŠ¶æ€æˆ–äº‹ä»¶ï¼Œæ­¤ç›®å½•ä¸­åŒ…å«ä¸ç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶ç›¸å…³çš„ä»£ç ã€‚</span><br><span class="line">â”œâ”€â”€ exporters                       -&gt; ç”¨äºåŒ…å«å¯¼å‡ºå™¨ï¼ˆexportersï¼‰çš„å®ç°ï¼Œå¯¼å‡ºå™¨è´Ÿè´£å°†ç›‘è§†åˆ°çš„æ•°æ®å‘é€åˆ°å¤–éƒ¨ç³»ç»Ÿï¼Œæ¯”å¦‚ç›‘æ§ç³»ç»Ÿï¼ˆä¾‹å¦‚ Prometheusï¼‰ã€‚å¯¼å‡ºå™¨åœ¨æ•°æ®æ”¶é›†å’Œç›‘æ§é›†æˆä¸­èµ·åˆ°å…³é”®ä½œç”¨ã€‚</span><br><span class="line">â”œâ”€â”€ healthchecker                   -&gt; å®ç°å¥åº·æ£€æŸ¥é€»è¾‘ï¼Œç¡®ä¿ node-problem-detector æœ¬èº«å’Œå…¶ä»–ä¾èµ–çš„ç»„ä»¶å¤„äºå¥åº·çŠ¶æ€ã€‚è¿™æ˜¯ç›‘æ§å’Œç»´æŠ¤è½¯ä»¶ç¨³å®šæ€§çš„é‡è¦éƒ¨åˆ†ã€‚</span><br><span class="line">â”œâ”€â”€ logcounter                      -&gt; å®ç°äº† logcounter çš„åŠŸèƒ½ï¼Œé€šå¸¸ç”¨äºè®¡æ•°å’Œåˆ†æç³»ç»Ÿæ—¥å¿—ï¼Œä»¥æ£€æµ‹å¼‚å¸¸è¡Œä¸ºæˆ–é—®é¢˜ã€‚å®ƒå¯ä»¥ä¸ç³»ç»Ÿæ—¥å¿—ç›‘æ§ç»“åˆä½¿ç”¨ã€‚</span><br><span class="line">â”œâ”€â”€ problemdaemon                   -&gt; å®ç°é—®é¢˜å®ˆæŠ¤ç¨‹åºã€‚è¿™ä¸ªå®ˆæŠ¤ç¨‹åºè´Ÿè´£ç›‘æµ‹å’Œè¯†åˆ«èŠ‚ç‚¹ä¸­çš„é—®é¢˜ï¼Œé€šè¿‡é—®é¢˜å‘ç°æœºåˆ¶æ”¶é›†æŒ‡æ ‡å¹¶ç”Ÿæˆå‘Šè­¦ã€‚</span><br><span class="line">â”œâ”€â”€ problemdetector                 -&gt; åŒ…å«é—®é¢˜æ£€æµ‹çš„æ ¸å¿ƒé€»è¾‘ã€‚è¿™æ˜¯ node-problem-detector çš„ä¸»è¦åŠŸèƒ½éƒ¨åˆ†ï¼Œè´Ÿè´£ä»ä¸åŒçš„æ¥æºæ”¶é›†ä¿¡æ¯ï¼Œå¹¶æ ¹æ®è¿™äº›ä¿¡æ¯è¯†åˆ«å’ŒæŠ¥å‘ŠèŠ‚ç‚¹é—®é¢˜ã€‚</span><br><span class="line">â”œâ”€â”€ problemmetrics                  -&gt; åŒ…å«é—®é¢˜æŒ‡æ ‡çš„å®ç°ï¼Œç”¨äºæ”¶é›†ã€å¤„ç†å’Œå¯¼å‡ºæœ‰å…³èŠ‚ç‚¹çŠ¶æ€å’Œé—®é¢˜çš„æ•°æ®ã€‚è¿™äº›æŒ‡æ ‡å¯ä»¥å±•ç¤ºåœ¨ç›‘æ§ç•Œé¢ä¸Šï¼Œå¸®åŠ©ç”¨æˆ·ç†è§£ç³»ç»Ÿçš„å¥åº·çŠ¶å†µã€‚</span><br><span class="line">â”œâ”€â”€ systemlogmonitor                -&gt; å®ç°äº†ç³»ç»Ÿæ—¥å¿—ç›‘æ§çš„åŠŸèƒ½ã€‚å®ƒå¤„ç†ç³»ç»Ÿæ—¥å¿—ï¼Œåˆ†ææ—¥å¿—å†…å®¹ï¼Œä»¥æ£€æµ‹å¯èƒ½å¯¼è‡´é—®é¢˜çš„äº‹ä»¶å’Œé”™è¯¯ã€‚</span><br><span class="line">â”œâ”€â”€ systemstatsmonitor              -&gt; ç”¨äºç›‘æ§ç³»ç»Ÿçš„å„ç§ç»Ÿè®¡æ•°æ®ï¼Œä¾‹å¦‚ CPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨æƒ…å†µç­‰ã€‚å®ƒè´Ÿè´£æ”¶é›†å’ŒæŠ¥å‘Šè¿™äº›ç»Ÿè®¡ä¿¡æ¯ï¼Œä»¥å¸®åŠ©éªŒè¯èŠ‚ç‚¹çš„å¥åº·çŠ¶æ€ã€‚</span><br><span class="line">â”œâ”€â”€ types                           -&gt; ç”¨äºå®šä¹‰é¡¹ç›®ä¸­ä½¿ç”¨çš„å„ç§ç±»å‹ç»“æ„ä½“å’Œå¸¸é‡ã€‚è¿™äº›ç±»å‹é€šå¸¸ç”¨äºæ•°æ®ä¼ è¾“å’Œå¤„ç†ï¼Œä¸ºæ ¸å¿ƒé€»è¾‘æä¾›æ•°æ®æ¨¡å‹ã€‚</span><br><span class="line">â”œâ”€â”€ util                            -&gt; åŒ…å«ä¸€äº›å…¬ç”¨å·¥å…·å‡½æ•°å’Œåº“ï¼Œè¿™äº›å‡½æ•°å¯ä»¥åœ¨å…¶ä»–æ¨¡å—ä¸­å¤ç”¨ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯è¯»æ€§ã€‚</span><br><span class="line">â””â”€â”€ version                         -&gt; ä¿å­˜ä¸ç‰ˆæœ¬ç›¸å…³çš„ä¿¡æ¯å’Œç»“æ„ã€‚å®ƒç”¨äºç®¡ç†ç‰ˆæœ¬å·å¹¶æä¾›ç‰ˆæœ¬ä¿¡æ¯çš„åŠŸèƒ½</span><br></pre></td></tr></table></figure>

<h1 id="2-problemdaemon"><a href="#2-problemdaemon" class="headerlink" title="2 problemdaemon"></a>2 problemdaemon</h1><h2 id="2-1-Register"><a href="#2-1-Register" class="headerlink" title="2.1 Register"></a>2.1 Register</h2><p>pkg&#x2F;problemdaemon&#x2F;problem_daemon.go:32</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">var (</span><br><span class="line">        handlers = make(map[types.ProblemDaemonType]types.ProblemDaemonHandler)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// Register registers a problem daemon factory method, which will be used to create the problem daemon.</span><br><span class="line">func Register(problemDaemonType types.ProblemDaemonType, handler types.ProblemDaemonHandler) &#123;</span><br><span class="line">        handlers[problemDaemonType] = handler</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨å†Œä¸€ä¸ªé—®é¢˜å®ˆæŠ¤è¿›ç¨‹å·¥å‚æ–¹æ³•ã€‚<br>å‚æ•°ï¼š</p>
<ul>
<li>problemDaemonType: éœ€è¦æ³¨å†Œçš„å®ˆæŠ¤è¿›ç¨‹ç±»å‹ã€‚</li>
<li>handler: å¯¹åº”çš„å¤„ç†å™¨ï¼Œå…¶ä¸­åŒ…å«åˆ›å»ºå®ˆæŠ¤è¿›ç¨‹çš„æ–¹æ³•ã€‚<br>ä½œç”¨ï¼šå°†æŒ‡å®šç±»å‹çš„å¤„ç†å™¨æ·»åŠ åˆ° handlers æ˜ å°„ä¸­ï¼Œä»¥ä¾¿åç»­æ ¹æ®ç±»å‹è·å–å¯¹åº”çš„å¤„ç†å™¨ã€‚</li>
</ul>
<h2 id="2-2-GetProblemDaemonNames"><a href="#2-2-GetProblemDaemonNames" class="headerlink" title="2.2 GetProblemDaemonNames"></a>2.2 GetProblemDaemonNames</h2><p>pkg&#x2F;problemdaemon&#x2F;problem_daemon.go:37</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// GetProblemDaemonNames retrieves all available problem daemon types.</span><br><span class="line">func GetProblemDaemonNames() []types.ProblemDaemonType &#123;</span><br><span class="line">        problemDaemonTypes := []types.ProblemDaemonType&#123;&#125;</span><br><span class="line">        for problemDaemonType := range handlers &#123;</span><br><span class="line">                problemDaemonTypes = append(problemDaemonTypes, problemDaemonType)</span><br><span class="line">        &#125;</span><br><span class="line">        return problemDaemonTypes</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ£€ç´¢æ‰€æœ‰å¯ç”¨çš„é—®é¢˜å®ˆæŠ¤è¿›ç¨‹ç±»å‹ã€‚</p>
<p>è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ³¨å†Œçš„å®ˆæŠ¤è¿›ç¨‹ç±»å‹çš„åˆ‡ç‰‡ã€‚</p>
<p>å®ç°ç»†èŠ‚ï¼šéå† handlers æ˜ å°„ï¼Œå°†æ¯ç§é—®é¢˜å®ˆæŠ¤è¿›ç¨‹ç±»å‹æ·»åŠ åˆ°è¿”å›çš„åˆ‡ç‰‡ä¸­ã€‚</p>
<h2 id="2-3-GetProblemDaemonHandlerOrDie"><a href="#2-3-GetProblemDaemonHandlerOrDie" class="headerlink" title="2.3 GetProblemDaemonHandlerOrDie"></a>2.3 GetProblemDaemonHandlerOrDie</h2><p>pkg&#x2F;problemdaemon&#x2F;problem_daemon.go:46</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// GetProblemDaemonHandlerOrDie retrieves the ProblemDaemonHandler for a specific type of problem daemon, panic if error occurs..</span><br><span class="line">func GetProblemDaemonHandlerOrDie(problemDaemonType types.ProblemDaemonType) types.ProblemDaemonHandler &#123;</span><br><span class="line">        handler, ok := handlers[problemDaemonType]</span><br><span class="line">        if !ok &#123;</span><br><span class="line">                panic(fmt.Sprintf(&quot;Problem daemon handler for %v does not exist&quot;, problemDaemonType))</span><br><span class="line">        &#125;</span><br><span class="line">        return handler</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è·å–ç‰¹å®šç±»å‹é—®é¢˜å®ˆæŠ¤è¿›ç¨‹çš„å¤„ç†å™¨ã€‚</p>
<p>å‚æ•°ï¼šé—®é¢˜å®ˆæŠ¤è¿›ç¨‹ç±»å‹ã€‚</p>
<p>è¿”å›å€¼ï¼šè¿”å›å¯¹åº”çš„å¤„ç†å™¨ã€‚</p>
<p>å®ç°ç»†èŠ‚ï¼šå¦‚æœæŒ‡å®šç±»å‹æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„å¤„ç†å™¨ï¼Œåˆ™è§¦å‘ææ…Œï¼ˆpanicï¼‰ï¼Œè¿™é€šå¸¸ç”¨äºåœ¨åˆå§‹åŒ–æ—¶ç¡®ä¿é…ç½®çš„æœ‰æ•ˆæ€§ã€‚</p>
<h2 id="2-4-NewProblemDaemons"><a href="#2-4-NewProblemDaemons" class="headerlink" title="2.4 NewProblemDaemons"></a>2.4 NewProblemDaemons</h2><p>pkg&#x2F;problemdaemon&#x2F;problem_daemon.go:55</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// NewProblemDaemons creates all problem daemons based on the configurations provided.</span><br><span class="line">func NewProblemDaemons(monitorConfigPaths types.ProblemDaemonConfigPathMap) []types.Monitor &#123;</span><br><span class="line">        problemDaemonMap := make(map[string]types.Monitor)</span><br><span class="line">        for problemDaemonType, configs := range monitorConfigPaths &#123;</span><br><span class="line">                for _, config := range *configs &#123;</span><br><span class="line">                        if _, ok := problemDaemonMap[config]; ok &#123;</span><br><span class="line">                                // Skip the config if it&#x27;s duplicated.</span><br><span class="line">                                klog.Warningf(&quot;Duplicated problem daemon configuration %q&quot;, config)</span><br><span class="line">                                continue</span><br><span class="line">                        &#125;</span><br><span class="line">                        problemDaemonMap[config] = handlers[problemDaemonType].CreateProblemDaemonOrDie(config)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        problemDaemons := []types.Monitor&#123;&#125;</span><br><span class="line">        for _, problemDaemon := range problemDaemonMap &#123;</span><br><span class="line">                problemDaemons = append(problemDaemons, problemDaemon)</span><br><span class="line">        &#125;</span><br><span class="line">        return problemDaemons</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®æä¾›çš„é…ç½®åˆ›å»ºæ‰€æœ‰é—®é¢˜å®ˆæŠ¤è¿›ç¨‹ã€‚</p>
<p>å‚æ•°ï¼š</p>
<p>monitorConfigPaths: åŒ…å«æ¯ç§é—®é¢˜å®ˆæŠ¤è¿›ç¨‹ç±»å‹åŠå…¶å¯¹åº”é…ç½®è·¯å¾„çš„æ˜ å°„ã€‚<br>è¿”å›å€¼ï¼šè¿”å›åˆ›å»ºçš„æ‰€æœ‰ Monitor å®ä¾‹çš„åˆ‡ç‰‡ã€‚<br>å®ç°ç»†èŠ‚</p>
<ul>
<li>åˆ›å»ºç©ºæ˜ å°„ï¼šä½¿ç”¨ problemDaemonMap å­˜å‚¨å·²åˆ›å»ºçš„å®ˆæŠ¤è¿›ç¨‹ï¼Œä»¥é¿å…é‡å¤ã€‚</li>
<li>éå†é…ç½®ï¼š<ul>
<li>å¯¹äºé…ç½®ä¸­çš„æ¯ç§é—®é¢˜å®ˆæŠ¤è¿›ç¨‹ç±»å‹åŠå…¶ç›¸åº”çš„é…ç½®è·¯å¾„ï¼Œæ£€æŸ¥æ˜¯å¦å·²ç»åˆ›å»ºã€‚</li>
<li>å¦‚æœé…ç½®å·²å­˜åœ¨ï¼Œåˆ™è®°å½•è­¦å‘Šå¹¶è·³è¿‡ã€‚</li>
<li>ä½¿ç”¨æ³¨å†Œçš„å¤„ç†å™¨åˆ›å»ºæ–°çš„é—®é¢˜å®ˆæŠ¤è¿›ç¨‹å¹¶å°†å…¶æ·»åŠ åˆ°æ˜ å°„ä¸­ã€‚</li>
</ul>
</li>
<li>è¿”å›å€¼æ„å»ºï¼šå°†åœ°å›¾ä¸­çš„æ‰€æœ‰å®ˆæŠ¤è¿›ç¨‹è½¬æ¢ä¸ºåˆ‡ç‰‡å¹¶è¿”å›ã€‚</li>
</ul>
<h1 id="3-problem-detector"><a href="#3-problem-detector" class="headerlink" title="3 problem_detector"></a>3 problem_detector</h1><h2 id="3-1-problemDetectorå®šä¹‰"><a href="#3-1-problemDetectorå®šä¹‰" class="headerlink" title="3.1 problemDetectorå®šä¹‰"></a>3.1 problemDetectorå®šä¹‰</h2><p>pkg&#x2F;problemdetector&#x2F;problem_detector.go:33</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// ProblemDetector collects statuses from all problem daemons and update the node condition and send node event.</span><br><span class="line">type ProblemDetector interface &#123;</span><br><span class="line">        Run(context.Context) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type problemDetector struct &#123;</span><br><span class="line">        monitors  []types.Monitor</span><br><span class="line">        exporters []types.Exporter</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å­—æ®µï¼š</p>
<p>monitors: å­˜å‚¨ç›‘æ§å™¨çš„åˆ‡ç‰‡ï¼Œç”¨äºæ”¶é›†é—®é¢˜çŠ¶æ€ã€‚</p>
<p>exporters: å­˜å‚¨å¯¼å‡ºå™¨çš„åˆ‡ç‰‡ï¼Œç”¨äºå°†æ”¶é›†åˆ°çš„çŠ¶æ€å‘é€åˆ°å¤–éƒ¨ç³»ç»Ÿæˆ–ç”¨æˆ·ã€‚</p>
<p>æ–¹æ³•è¯´æ˜ï¼š Run(context.Context) error å¯åŠ¨é—®é¢˜æ£€æµ‹å™¨ï¼Œå¹¶åœ¨ä¸Šä¸‹æ–‡è¢«å–æ¶ˆæˆ–å‡ºç°é”™è¯¯æ—¶è¿”å›é”™è¯¯ã€‚</p>
<h2 id="3-2-NewProblemDetector"><a href="#3-2-NewProblemDetector" class="headerlink" title="3.2 NewProblemDetector"></a>3.2 NewProblemDetector</h2><p>pkg&#x2F;problemdetector&#x2F;problem_detector.go:40</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// NewProblemDetector creates the problem detector. Currently we just directly passed in the problem daemons, but</span><br><span class="line">// in the future we may want to let the problem daemons register themselves.</span><br><span class="line">func NewProblemDetector(monitors []types.Monitor, exporters []types.Exporter) ProblemDetector &#123;</span><br><span class="line">        return &amp;problemDetector&#123;</span><br><span class="line">                monitors:  monitors,</span><br><span class="line">                exporters: exporters,</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„é—®é¢˜æ£€æµ‹å™¨å®ä¾‹ã€‚</p>
<p>å‚æ•°ï¼š</p>
<p>monitors: ç›‘æ§å™¨æ•°ç»„ï¼Œç”¨äºæ£€æµ‹ä¸åŒé—®é¢˜ã€‚</p>
<p>exporters: å¯¼å‡ºå™¨æ•°ç»„ï¼Œç”¨äºå°†çŠ¶æ€å‘é€ç»™å¤–éƒ¨ç³»ç»Ÿã€‚</p>
<p>è¿”å›å€¼ï¼šè¿”å›å®ç° ProblemDetector æ¥å£çš„æ–°çš„ problemDetector å®ä¾‹ã€‚</p>
<h2 id="3-3-Run"><a href="#3-3-Run" class="headerlink" title="3.3 Run"></a>3.3 Run</h2><p>pkg&#x2F;problemdetector&#x2F;problem_detector.go:48</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// Run starts the problem detector.</span><br><span class="line">func (p *problemDetector) Run(ctx context.Context) error &#123;</span><br><span class="line">        // Start the log monitors one by one.</span><br><span class="line">        var chans []&lt;-chan *types.Status</span><br><span class="line">        failureCount := 0</span><br><span class="line">        for _, m := range p.monitors &#123;</span><br><span class="line">                ch, err := m.Start()</span><br><span class="line">                if err != nil &#123;</span><br><span class="line">                        // Do not return error and keep on trying the following config files.</span><br><span class="line">                        klog.Errorf(&quot;Failed to start problem daemon %v: %v&quot;, m, err)</span><br><span class="line">                        failureCount++</span><br><span class="line">                        continue</span><br><span class="line">                &#125;</span><br><span class="line">                if ch != nil &#123;</span><br><span class="line">                        chans = append(chans, ch)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        allMonitors := p.monitors</span><br><span class="line"></span><br><span class="line">        if len(allMonitors) == failureCount &#123;</span><br><span class="line">                return fmt.Errorf(&quot;no problem daemon is successfully setup&quot;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        defer func() &#123;</span><br><span class="line">                for _, m := range allMonitors &#123;</span><br><span class="line">                        m.Stop()</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;()</span><br><span class="line"></span><br><span class="line">        ch := groupChannel(chans)</span><br><span class="line">        klog.Info(&quot;Problem detector started&quot;)</span><br><span class="line"></span><br><span class="line">        for &#123;</span><br><span class="line">                select &#123;</span><br><span class="line">                case &lt;-ctx.Done():</span><br><span class="line">                        return nil</span><br><span class="line">                case status := &lt;-ch:</span><br><span class="line">                        for _, exporter := range p.exporters &#123;</span><br><span class="line">                                exporter.ExportProblems(status)</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œé—®é¢˜æ£€æµ‹å™¨çš„ä¸»è¦è¿è¡Œé€»è¾‘ã€‚</p>
<p>å®ç°ç»†èŠ‚ï¼š</p>
<ul>
<li>å¼€å§‹ç›‘æ§å™¨ï¼šéå†å¹¶å¯åŠ¨æ¯ä¸ªç›‘æ§å™¨ã€‚</li>
<li>å¦‚æœå¯åŠ¨å¤±è´¥ï¼Œè®°å½•é”™è¯¯å¹¶å¢åŠ å¤±è´¥è®¡æ•°ã€‚</li>
<li>å¦‚æœæˆåŠŸï¼Œåˆ™å°†è¿”å›çš„é€šé“æ·»åŠ åˆ° chans åˆ‡ç‰‡ã€‚</li>
<li>æ£€æŸ¥å¤±è´¥æƒ…å†µï¼šå¦‚æœæ‰€æœ‰ç›‘æ§å™¨éƒ½å¤±è´¥ï¼Œåˆ™è¿”å›é”™è¯¯ã€‚</li>
<li>å»¶è¿Ÿå…³é—­ï¼šåœ¨å‡½æ•°ç»“æŸæ—¶åœæ­¢æ‰€æœ‰ç›‘æ§å™¨ã€‚</li>
<li>é€šé“ç»„åˆï¼šè°ƒç”¨ groupChannel å‡½æ•°ï¼Œç”¨äºå°†æ‰€æœ‰ç›‘æ§å™¨çš„çŠ¶æ€é€šé“ç»„åˆæˆå•ä¸€é€šé“ã€‚</li>
<li>ç›‘å¬çŠ¶æ€ï¼šä½¿ç”¨ select ä¸æ–­ç›‘å¬ä¸Šä¸‹æ–‡å’Œç›‘æ§å™¨çš„çŠ¶æ€ã€‚</li>
<li>å¦‚æœæ”¶åˆ°çŠ¶æ€ï¼Œä»æ‰€æœ‰å¯¼å‡ºå™¨å¯¼å‡ºé—®é¢˜ã€‚</li>
</ul>
<h2 id="3-4-groupChannel"><a href="#3-4-groupChannel" class="headerlink" title="3.4 groupChannel"></a>3.4 groupChannel</h2><p>pkg&#x2F;problemdetector&#x2F;problem_detector.go:91</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">func groupChannel(chans []&lt;-chan *types.Status) &lt;-chan *types.Status &#123;</span><br><span class="line">        statuses := make(chan *types.Status)</span><br><span class="line">        for _, ch := range chans &#123;</span><br><span class="line">                go func(c &lt;-chan *types.Status) &#123;</span><br><span class="line">                        for status := range c &#123;</span><br><span class="line">                                statuses &lt;- status</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;(ch)</span><br><span class="line">        &#125;</span><br><span class="line">        return statuses</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°†å¤šä¸ªçŠ¶æ€é€šé“ç»„åˆä¸ºä¸€ä¸ªé€šé“ã€‚</p>
<p>å‚æ•°ï¼šåˆ‡ç‰‡ chansï¼ŒåŒ…å«å¤šä¸ªçŠ¶æ€é€šé“ã€‚</p>
<p>è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ªæ–°çš„é€šé“ statusesï¼Œç”¨äºæ¥æ”¶æ¥è‡ªæ‰€æœ‰ç›‘æ§å™¨çš„çŠ¶æ€ã€‚</p>
<p>å®ç°ç»†èŠ‚</p>
<p>å¯åŠ¨å¤šä¸ª goroutineï¼Œæ¯ä¸ª goroutine ä»ä¸€ä¸ªç›‘æ§å™¨çš„é€šé“è¯»å–çŠ¶æ€ï¼Œå¹¶å°†å…¶è½¬å‘åˆ°æ–°çš„ statuses é€šé“ä¸­ã€‚</p>
<h1 id="4-problemmetrics"><a href="#4-problemmetrics" class="headerlink" title="4 problemmetrics"></a>4 problemmetrics</h1><h2 id="4-1-ProblemMetricsManagerå®šä¹‰"><a href="#4-1-ProblemMetricsManagerå®šä¹‰" class="headerlink" title="4.1 ProblemMetricsManagerå®šä¹‰"></a>4.1 ProblemMetricsManagerå®šä¹‰</h2><p>pkg&#x2F;problemmetrics&#x2F;problem_metrics.go:40</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// ProblemMetricsManager manages problem-converted metrics.</span><br><span class="line">// ProblemMetricsManager is thread-safe.</span><br><span class="line">type ProblemMetricsManager struct &#123;</span><br><span class="line">        problemCounter           metrics.Int64MetricInterface</span><br><span class="line">        problemGauge             metrics.Int64MetricInterface</span><br><span class="line">        problemTypeToReason      map[string]string</span><br><span class="line">        problemTypeToReasonMutex sync.Mutex</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å­—æ®µï¼š</p>
<ul>
<li>problemCounter: ä¸€ä¸ªæ•´å‹æŒ‡æ ‡æ¥å£ï¼Œç”¨äºè®¡æ•°ç‰¹å®šé—®é¢˜å‘ç”Ÿçš„æ¬¡æ•°ã€‚</li>
<li>problemGauge: ä¸€ä¸ªæ•´å‹æŒ‡æ ‡æ¥å£ï¼Œç”¨äºè¡¨ç¤ºç‰¹å®šé—®é¢˜æ˜¯å¦å¯¹èŠ‚ç‚¹äº§ç”Ÿå½±å“ã€‚</li>
<li>problemTypeToReason: ä¸€ä¸ªæ˜ å°„ï¼Œä¿å­˜é—®é¢˜ç±»å‹ä¸åŸå› çš„å…³ç³»ã€‚</li>
<li>problemTypeToReasonMutex: ä¸€ä¸ªäº’æ–¥é”ï¼Œç”¨äºä¿æŠ¤ problemTypeToReason çš„å¹¶å‘è®¿é—®ã€‚</li>
</ul>
<h2 id="4-2-init"><a href="#4-2-init" class="headerlink" title="4.2 init"></a>4.2 init</h2><p>pkg&#x2F;problemmetrics&#x2F;problem_metrics.go:31</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// GlobalProblemMetricsManager is a singleton of ProblemMetricsManager,</span><br><span class="line">// which should be used to manage all problem-converted metrics across all</span><br><span class="line">// problem daemons.</span><br><span class="line">var GlobalProblemMetricsManager *ProblemMetricsManager</span><br><span class="line"></span><br><span class="line">func init() &#123;</span><br><span class="line">        GlobalProblemMetricsManager = NewProblemMetricsManagerOrDie()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GlobalProblemMetricsManager: å…¨å±€å”¯ä¸€çš„ ProblemMetricsManager å®ä¾‹ï¼Œç”¨äºç®¡ç†æ‰€æœ‰é—®é¢˜ç›¸å…³çš„æŒ‡æ ‡ã€‚</p>
<p>init å‡½æ•°: åœ¨ç¨‹åºå¯åŠ¨æ—¶åˆå§‹åŒ– GlobalProblemMetricsManagerï¼Œç¡®ä¿å…¶å¯ç”¨ã€‚</p>
<h2 id="4-3-NewProblemMetricsManagerOrDie"><a href="#4-3-NewProblemMetricsManagerOrDie" class="headerlink" title="4.3 NewProblemMetricsManagerOrDie"></a>4.3 NewProblemMetricsManagerOrDie</h2><p>pkg&#x2F;problemmetrics&#x2F;problem_metrics.go:47</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">func NewProblemMetricsManagerOrDie() *ProblemMetricsManager &#123;</span><br><span class="line">        pmm := ProblemMetricsManager&#123;&#125;</span><br><span class="line"></span><br><span class="line">        var err error</span><br><span class="line">        pmm.problemCounter, err = metrics.NewInt64Metric(</span><br><span class="line">                metrics.ProblemCounterID,</span><br><span class="line">                string(metrics.ProblemCounterID),</span><br><span class="line">                &quot;Number of times a specific type of problem have occurred.&quot;,</span><br><span class="line">                &quot;1&quot;,</span><br><span class="line">                metrics.Sum,</span><br><span class="line">                []string&#123;&quot;reason&quot;&#125;)</span><br><span class="line">        if err != nil &#123;</span><br><span class="line">                klog.Fatalf(&quot;Failed to create problem_counter metric: %v&quot;, err)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        pmm.problemGauge, err = metrics.NewInt64Metric(</span><br><span class="line">                metrics.ProblemGaugeID,</span><br><span class="line">                string(metrics.ProblemGaugeID),</span><br><span class="line">                &quot;Whether a specific type of problem is affecting the node or not.&quot;,</span><br><span class="line">                &quot;1&quot;,</span><br><span class="line">                metrics.LastValue,</span><br><span class="line">                []string&#123;&quot;type&quot;, &quot;reason&quot;&#125;)</span><br><span class="line">        if err != nil &#123;</span><br><span class="line">                klog.Fatalf(&quot;Failed to create problem_gauge metric: %v&quot;, err)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        pmm.problemTypeToReason = make(map[string]string)</span><br><span class="line"></span><br><span class="line">        return &amp;pmm</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå¹¶åˆå§‹åŒ– ProblemMetricsManager å®ä¾‹ã€‚</p>
<p>å®ç°ç»†èŠ‚ï¼š</p>
<p>åˆ›å»º problemCounter æŒ‡æ ‡ï¼Œç”¨äºè®°å½•ç‰¹å®šé—®é¢˜çš„å‘ç”Ÿæ¬¡æ•°ï¼Œæ¥æ”¶æ ‡ç­¾ reasonã€‚</p>
<p>åˆ›å»º problemGauge æŒ‡æ ‡ï¼Œç”¨äºæŒ‡ç¤ºç‰¹å®šé—®é¢˜æ˜¯å¦æ­£åœ¨å½±å“èŠ‚ç‚¹ï¼Œæ¥æ”¶æ ‡ç­¾ type å’Œ reasonã€‚</p>
<p>å¦‚æœåˆ›å»ºæŒ‡æ ‡å¤±è´¥ï¼Œåˆ™ç¨‹åºä¼šå´©æºƒï¼ˆFatalfï¼‰ã€‚</p>
<p>åˆå§‹åŒ–é—®é¢˜ç±»å‹åˆ°åŸå› çš„æ˜ å°„ã€‚</p>
<h2 id="4-4-IncrementProblemCounter"><a href="#4-4-IncrementProblemCounter" class="headerlink" title="4.4 IncrementProblemCounter"></a>4.4 IncrementProblemCounter</h2><p>pkg&#x2F;problemmetrics&#x2F;problem_metrics.go:79</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// IncrementProblemCounter increments the value of a problem counter.</span><br><span class="line">func (pmm *ProblemMetricsManager) IncrementProblemCounter(reason string, count int64) error &#123;</span><br><span class="line">        if pmm.problemCounter == nil &#123;</span><br><span class="line">                return errors.New(&quot;problem counter is being incremented before initialized.&quot;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return pmm.problemCounter.Record(map[string]string&#123;&quot;reason&quot;: reason&#125;, count)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¢åŠ é—®é¢˜è®¡æ•°å™¨çš„å€¼ï¼Œæ ¹æ® reason æ ‡ç­¾è®°å½•ç»Ÿè®¡æ•°æ®ã€‚</p>
<p>å‚æ•°ï¼š</p>
<p>reason: é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚</p>
<p>count: è¦å¢åŠ çš„æ•°é‡ã€‚</p>
<p>è¿”å›å€¼ï¼šè¿”å›å¯èƒ½çš„é”™è¯¯ã€‚</p>
<h2 id="4-5-SetProblemGauge"><a href="#4-5-SetProblemGauge" class="headerlink" title="4.5 SetProblemGauge"></a>4.5 SetProblemGauge</h2><p>pkg&#x2F;problemmetrics&#x2F;problem_metrics.go:88</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// SetProblemGauge sets the value of a problem gauge.</span><br><span class="line">func (pmm *ProblemMetricsManager) SetProblemGauge(problemType string, reason string, value bool) error &#123;</span><br><span class="line">        if pmm.problemGauge == nil &#123;</span><br><span class="line">                return errors.New(&quot;problem gauge is being set before initialized.&quot;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        pmm.problemTypeToReasonMutex.Lock()</span><br><span class="line">        defer pmm.problemTypeToReasonMutex.Unlock()</span><br><span class="line"></span><br><span class="line">        // We clear the last reason, because the expected behavior is that at any point of time,</span><br><span class="line">        // for each type of permanent problem, there should be at most one reason got set to 1.</span><br><span class="line">        // This behavior is consistent with the behavior of node condition in Kubernetes.</span><br><span class="line">        // However, problemGauges with different &quot;type&quot; and &quot;reason&quot; are considered as different</span><br><span class="line">        // metrics in Prometheus. So we need to clear the previous metrics explicitly.</span><br><span class="line">        if lastReason, ok := pmm.problemTypeToReason[problemType]; ok &#123;</span><br><span class="line">                err := pmm.problemGauge.Record(map[string]string&#123;&quot;type&quot;: problemType, &quot;reason&quot;: lastReason&#125;, 0)</span><br><span class="line">                if err != nil &#123;</span><br><span class="line">                        return fmt.Errorf(&quot;failed to clear previous reason %q for type %q: %v&quot;,</span><br><span class="line">                                problemType, lastReason, err)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        pmm.problemTypeToReason[problemType] = reason</span><br><span class="line"></span><br><span class="line">        var valueInt int64</span><br><span class="line">        if value &#123;</span><br><span class="line">                valueInt = 1</span><br><span class="line">        &#125;</span><br><span class="line">        return pmm.problemGauge.Record(map[string]string&#123;&quot;type&quot;: problemType, &quot;reason&quot;: reason&#125;, valueInt)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è®¾ç½®é—®é¢˜é‡è§„çš„å€¼ï¼ŒæŒ‡ç¤ºç‰¹å®šé—®é¢˜å¯¹èŠ‚ç‚¹çš„å½±å“ã€‚</p>
<p>å‚æ•°ï¼š</p>
<ul>
<li>problemType: é—®é¢˜ç±»å‹ï¼ˆä¾‹å¦‚ï¼ŒèŠ‚ç‚¹ä¸å¯ç”¨ï¼‰ã€‚</li>
<li>reason: å…·ä½“åŸå› ã€‚</li>
<li>value: è¡¨ç¤ºé—®é¢˜çš„çŠ¶æ€ï¼Œtrueè¡¨ç¤ºé—®é¢˜å­˜åœ¨ (1)ï¼Œfalseè¡¨ç¤ºé—®é¢˜æ¶ˆå¤± (0)ã€‚</li>
</ul>
<p>å®ç°ç»†èŠ‚ï¼š</p>
<ul>
<li>ä½¿ç”¨äº’æ–¥é”ä¿æŠ¤å¯¹ problemTypeToReason çš„å¹¶å‘è®¿é—®ã€‚</li>
<li>æ¸…é™¤ä¹‹å‰çš„åŸå› ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œä¿è¯æ¯ä¸ªé—®é¢˜ç±»å‹åœ¨ä»»ä½•æ—¶åˆ»éƒ½æœ€å¤šåªæœ‰ä¸€ä¸ªåŸå› è¢«è®¾ç½®ä¸º 1ã€‚</li>
<li>è®°å½•æ–°çš„é‡è§„å€¼ã€‚</li>
</ul>
<h1 id="5-exporters"><a href="#5-exporters" class="headerlink" title="5 exporters"></a>5 exporters</h1><p>ç›®å½•ç»“æ„ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ k8sexporter</span><br><span class="line">â”‚   â”œâ”€â”€ condition</span><br><span class="line">â”‚   â”œâ”€â”€ k8s_exporter.go</span><br><span class="line">â”‚   â””â”€â”€ problemclient</span><br><span class="line">â”œâ”€â”€ prometheusexporter</span><br><span class="line">â”‚   â””â”€â”€ prometheus_exporter.go</span><br><span class="line">â”œâ”€â”€ register.go</span><br><span class="line">â”œâ”€â”€ register_test.go</span><br><span class="line">â””â”€â”€ stackdriver</span><br><span class="line">    â”œâ”€â”€ config</span><br><span class="line">    â”œâ”€â”€ gce</span><br><span class="line">    â”œâ”€â”€ stackdriver_exporter.go</span><br><span class="line">    â””â”€â”€ stackdriver_exporter_test.go</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå°±æ¶‰åŠåˆ°äº†ä¸‰ä¸ªexporterï¼Œåˆ†åˆ«æ˜¯k8sexporterã€prometheusexporterã€stackdriver_exporter</p>
<p>è¿™ä¸‰ä¸ªæ˜¯æ¯”è¾ƒç‹¬ç«‹çš„ï¼Œå› ä¸ºèƒ½åŠ›æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ï¼Œ</p>
<ul>
<li>exporterï¼šä¸“æ³¨äºå°†types.Statusçš„eventå’Œconditationä¸ŠæŠ¥ï¼Œå¹¶ä¸”ä¼šæœ‰ä¸€äº›httpæœåŠ¡æ¥å£å¼€æ”¾(healthzã€conditionsã€&#x2F;debug&#x2F;pprof)ï¼Œ</li>
<li>prometheusexporterï¼šç›´æ¥ç”¨çš„prometheuseçš„åº“ï¼Œç®€å•ç†è§£å°±æ˜¯ä¸ºäº†è®©prometheuseå¯ä»¥é‡‡é›†åˆ°æ•°æ®</li>
<li>stackdriver_exporterï¼šå¤„ç†ä¸ Google Stackdriver çš„é›†æˆï¼ŒStackdriver æ˜¯ Google Cloud æä¾›çš„ç›‘æ§å’Œç®¡ç†å¹³å°ï¼Œè¯¥exporterè´Ÿè´£å°†æŒ‡æ ‡æ•°æ®å‘é€åˆ°<br>Stackdriverï¼Œä»¥ä¾¿åœ¨ Google Cloud ç¯å¢ƒä¸­ç›‘æ§åº”ç”¨ç¨‹åºå’Œé›†ç¾¤çŠ¶æ€ã€‚</li>
</ul>
<p>è¿™é‡Œæ¥è¯´è¯´æˆ‘çš„ç†è§£å§ï¼Œprometheusexporterå’Œstackdriver_exporterè¿™ä¸¤ä¸ªexporteræ˜¯ä¸ºäº†å°†metricæ•°æ®å‘é€åˆ°å¯¹åº”çš„ç›‘æ§å¹³å°ï¼Œè€Œk8sexporteråˆ™æ˜¯ä¸ºäº†å°†types.Statuså‘é€åˆ°k8sï¼Œç›®å‰å·²ç»å¼€å§‹å‘registerç»§æ‰¿æ–¹å‘å»¶å±•ï¼Œå¦‚stackdriver_exporterå·²ç»ä½¿ç”¨è¯¥æ¨¡å¼å¹¶ä¸”å·²ç»ç»Ÿä¸€äº†structçš„å®ç°æ–¹æ³•ï¼Œä½†æ˜¯prometheusexporterå’Œk8sexporterè¿˜æ²¡å®Œæˆæ¼”å˜ï¼Œç›®å‰è¿˜æ˜¯é€šè¿‡packageç›´æ¥è°ƒç”¨çš„æ–¹å¼ä½¿ç”¨çš„ã€‚</p>
<p>è¿™ä¸ªæ¨¡å—å°±ä¸è¿›è¡Œä»£ç çº§åˆ«è§£æäº†ï¼Œæ•´ä½“æ˜¯éå¸¸ç®€å•çš„ã€‚</p>
<h1 id="6-healthchecker"><a href="#6-healthchecker" class="headerlink" title="6 healthchecker"></a>6 healthchecker</h1><p>ç›®å½•ç»“æ„ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”œâ”€â”€ health_checker.go</span><br><span class="line">â”œâ”€â”€ health_checker_darwin.go</span><br><span class="line">â”œâ”€â”€ health_checker_linux.go</span><br><span class="line">â”œâ”€â”€ health_checker_test.go</span><br><span class="line">â”œâ”€â”€ health_checker_windows.go</span><br><span class="line">â””â”€â”€ types</span><br><span class="line">â”œâ”€â”€ types.go</span><br><span class="line">â”œâ”€â”€ types_test.go</span><br><span class="line">â”œâ”€â”€ types_unix.go</span><br><span class="line">â””â”€â”€ types_windows.go</span><br></pre></td></tr></table></figure>

<p>6.1 healthCheckerå®šä¹‰<br>pkg&#x2F;healthchecker&#x2F;health_checker.go:31</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">type healthChecker struct &#123;</span><br><span class="line">  component       string</span><br><span class="line">  service         string</span><br><span class="line">  enableRepair    bool</span><br><span class="line">  healthCheckFunc func () (bool, error)</span><br><span class="line">  // The repair is &quot;best-effort&quot; and ignores the error from the underlying actions.</span><br><span class="line">  // The bash commands to kill the process will fail if the service is down and hence ignore.</span><br><span class="line">  repairFunc         func ()</span><br><span class="line">  uptimeFunc         func () (time.Duration, error)</span><br><span class="line">  crictlPath         string</span><br><span class="line">  healthCheckTimeout time.Duration</span><br><span class="line">  coolDownTime       time.Duration</span><br><span class="line">  loopBackTime       time.Duration</span><br><span class="line">  logPatternsToCheck map[string]int</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å­—æ®µå«ä¹‰ï¼š</p>
<ul>
<li>componentï¼šè¢«æ£€æŸ¥çš„ Kubernetes ç»„ä»¶åç§°ï¼ˆå¦‚ Kubeletã€Kube Proxy ç­‰ï¼‰ã€‚</li>
<li>serviceï¼šæœåŠ¡åç§°æˆ–æ ‡è¯†ç¬¦ã€‚</li>
<li>enableRepairï¼šå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºæ˜¯å¦åœ¨å‘ç°æœåŠ¡ä¸å¥åº·æ—¶å°è¯•ä¿®å¤å®ƒã€‚</li>
<li>healthCheckFuncï¼šä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ‰§è¡Œå¥åº·æ£€æŸ¥ï¼Œè¿”å›å¥åº·çŠ¶æ€å’Œå¯èƒ½çš„é”™è¯¯ã€‚</li>
<li>repairFuncï¼šä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå°è¯•ä¿®å¤ä¸å¥åº·çš„æœåŠ¡ã€‚</li>
<li>uptimeFuncï¼šä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè·å–æœåŠ¡çš„è¿è¡Œæ—¶é—´ã€‚</li>
<li>crictlPathï¼šæŒ‡å‘ CRI å·¥å…·çš„è·¯å¾„ã€‚</li>
<li>healthCheckTimeoutï¼šå¥åº·æ£€æŸ¥çš„è¶…æ—¶è®¾ç½®ã€‚</li>
<li>coolDownTimeï¼šåœ¨å°è¯•ä¿®å¤ä¹‹å‰è¦æ±‚æœåŠ¡å¿…é¡»æ­£å¸¸è¿è¡Œçš„æ—¶é—´ã€‚</li>
<li>loopBackTimeï¼šç”¨äºå›æº¯æ£€æŸ¥æ—¥å¿—çš„æ—¶é—´æ®µã€‚</li>
<li>logPatternsToCheckï¼šä¸€ä¸ªæ˜ å°„ï¼ŒåŒ…å«è¦æ£€æŸ¥çš„æ—¥å¿—æ¨¡å¼åŠå…¶å‡ºç°æ¬¡æ•°é˜ˆå€¼ã€‚</li>
</ul>
<h2 id="6-2-NewHealthChecker"><a href="#6-2-NewHealthChecker" class="headerlink" title="6.2 NewHealthChecker"></a>6.2 NewHealthChecker</h2><p>pkg&#x2F;healthchecker&#x2F;health_checker.go:48</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// NewHealthChecker returns a new health checker configured with the given options.</span><br><span class="line">func NewHealthChecker(hco *options.HealthCheckerOptions) (types.HealthChecker, error) &#123;</span><br><span class="line">  hc := &amp;healthChecker&#123;</span><br><span class="line">    component:          hco.Component,</span><br><span class="line">    enableRepair:       hco.EnableRepair,</span><br><span class="line">    crictlPath:         hco.CriCtlPath,</span><br><span class="line">    healthCheckTimeout: hco.HealthCheckTimeout,</span><br><span class="line">    coolDownTime:       hco.CoolDownTime,</span><br><span class="line">    service:            hco.Service,</span><br><span class="line">    loopBackTime:       hco.LoopBackTime,</span><br><span class="line">    logPatternsToCheck: hco.LogPatterns.GetLogPatternCountMap(),</span><br><span class="line">  &#125;</span><br><span class="line">  hc.healthCheckFunc = getHealthCheckFunc(hco)</span><br><span class="line">  hc.repairFunc = getRepairFunc(hco)</span><br><span class="line">  hc.uptimeFunc = getUptimeFunc(hco.Service)</span><br><span class="line">  return hc, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>NewHealthCheckerä¼šæ ¹æ®è¾“å…¥çš„options.HealthCheckerOptionsæ¥è¿›è¡Œtypes.HealthCheckerçš„æ„é€ ã€‚</p>
<h2 id="6-3-CheckHealth"><a href="#6-3-CheckHealth" class="headerlink" title="6.3 CheckHealth"></a>6.3 CheckHealth</h2><p>pkg&#x2F;healthchecker&#x2F;health_checker.go:67</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// CheckHealth checks for the health of the component and tries to repair if enabled.</span><br><span class="line">// Returns true if healthy, false otherwise.</span><br><span class="line">func (hc *healthChecker) CheckHealth() (bool, error) &#123;</span><br><span class="line">        healthy, err := hc.healthCheckFunc()</span><br><span class="line">        if err != nil &#123;</span><br><span class="line">                return healthy, err</span><br><span class="line">        &#125;</span><br><span class="line">        logPatternHealthy, err := logPatternHealthCheck(hc.service, hc.loopBackTime, hc.logPatternsToCheck)</span><br><span class="line">        if err != nil &#123;</span><br><span class="line">                return logPatternHealthy, err</span><br><span class="line">        &#125;</span><br><span class="line">        if healthy &amp;&amp; logPatternHealthy &#123;</span><br><span class="line">                return true, nil</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // The service is unhealthy.</span><br><span class="line">        // Attempt repair based on flag.</span><br><span class="line">        if hc.enableRepair &#123;</span><br><span class="line">                // repair if the service has been up for the cool down period.</span><br><span class="line">                uptime, err := hc.uptimeFunc()</span><br><span class="line">                if err != nil &#123;</span><br><span class="line">                        klog.Infof(&quot;error in getting uptime for %v: %v\n&quot;, hc.component, err)</span><br><span class="line">                        return false, nil</span><br><span class="line">                &#125;</span><br><span class="line">                klog.Infof(&quot;%v is unhealthy, component uptime: %v\n&quot;, hc.component, uptime)</span><br><span class="line">                if uptime &gt; hc.coolDownTime &#123;</span><br><span class="line">                        klog.Infof(&quot;%v cooldown period of %v exceeded, repairing&quot;, hc.component, hc.coolDownTime)</span><br><span class="line">                        hc.repairFunc()</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ£€æŸ¥ç»„ä»¶çš„å¥åº·çŠ¶æ€ï¼Œè¿”å›æ˜¯å¦å¥åº·ï¼Œå¹¶åœ¨ä¸å¥åº·çš„æƒ…å†µä¸‹å°è¯•ä¿®å¤ã€‚</p>
<p>é€»è¾‘ï¼š</p>
<ul>
<li>è°ƒç”¨ healthCheckFunc æ‰§è¡Œå¥åº·æ£€æŸ¥ã€‚</li>
<li>ä½¿ç”¨ logPatternHealthCheck æ£€æŸ¥æ—¥å¿—æ¨¡å¼ã€‚</li>
<li>å¦‚æœç»„ä»¶ä¸å¥åº·ä¸”å¯ç”¨äº†ä¿®å¤ï¼Œæ£€æŸ¥ç»„ä»¶çš„è¿è¡Œæ—¶é—´å¹¶è°ƒç”¨ä¿®å¤å‡½æ•°ã€‚</li>
</ul>
<h2 id="6-4-logPatternHealthCheck"><a href="#6-4-logPatternHealthCheck" class="headerlink" title="6.4 logPatternHealthCheck"></a>6.4 logPatternHealthCheck</h2><p>pkg&#x2F;healthchecker&#x2F;health_checker.go:100</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// logPatternHealthCheck checks for the provided logPattern occurrences in the service logs.</span><br><span class="line">// Returns true if the pattern is empty or does not exist logThresholdCount times since start of service, false otherwise.</span><br><span class="line">func logPatternHealthCheck(service string, loopBackTime time.Duration, logPatternsToCheck map[string]int) (bool, error) &#123;</span><br><span class="line">        if len(logPatternsToCheck) == 0 &#123;</span><br><span class="line">                return true, nil</span><br><span class="line">        &#125;</span><br><span class="line">        uptimeFunc := getUptimeFunc(service)</span><br><span class="line">        klog.Infof(&quot;Getting uptime for service: %v\n&quot;, service)</span><br><span class="line">        uptime, err := uptimeFunc()</span><br><span class="line">        if err != nil &#123;</span><br><span class="line">                klog.Warningf(&quot;Failed to get the uptime: %+v&quot;, err)</span><br><span class="line">                return true, err</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        logStartTime := time.Now().Add(-uptime).Format(types.LogParsingTimeLayout)</span><br><span class="line">        if loopBackTime &gt; 0 &amp;&amp; uptime &gt; loopBackTime &#123;</span><br><span class="line">                logStartTime = time.Now().Add(-loopBackTime).Format(types.LogParsingTimeLayout)</span><br><span class="line">        &#125;</span><br><span class="line">        for pattern, count := range logPatternsToCheck &#123;</span><br><span class="line">                healthy, err := checkForPattern(service, logStartTime, pattern, count)</span><br><span class="line">                if err != nil || !healthy &#123;</span><br><span class="line">                        return healthy, err</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return true, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ£€æŸ¥æœåŠ¡æ—¥å¿—ä¸­æŒ‡å®šæ¨¡å¼çš„å‡ºç°æ¬¡æ•°ã€‚</p>
<p>å‚æ•°ï¼š</p>
<ul>
<li>serviceï¼šè¢«ç›‘æ§çš„æœåŠ¡åç§°ã€‚</li>
<li>loopBackTimeï¼šç”¨äºç¡®å®šè¦æ£€æŸ¥çš„æ—¥å¿—æ—¶é—´èŒƒå›´ã€‚</li>
<li>logPatternsToCheckï¼šè¦æ£€æŸ¥çš„æ—¥å¿—æ¨¡å¼åŠå…¶å‡ºç°çš„é˜ˆå€¼ã€‚<br>è¿”å›å€¼ï¼šå¸ƒå°”å€¼è¡¨ç¤ºå¥åº·çŠ¶æ€å’Œå¯èƒ½çš„é”™è¯¯ã€‚</li>
</ul>
<h2 id="6-5-healthCheckEndpointOKFunc"><a href="#6-5-healthCheckEndpointOKFunc" class="headerlink" title="6.5 healthCheckEndpointOKFunc"></a>6.5 healthCheckEndpointOKFunc</h2><p>pkg&#x2F;healthchecker&#x2F;health_checker.go:126</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// healthCheckEndpointOKFunc returns a function to check the status of an http endpoint</span><br><span class="line">func healthCheckEndpointOKFunc(endpoint string, timeout time.Duration) func() (bool, error) &#123;</span><br><span class="line">        return func() (bool, error) &#123;</span><br><span class="line">                httpClient := http.Client&#123;Timeout: timeout&#125;</span><br><span class="line">                response, err := httpClient.Get(endpoint)</span><br><span class="line">                if err != nil || response.StatusCode != http.StatusOK &#123;</span><br><span class="line">                        return false, nil</span><br><span class="line">                &#125;</span><br><span class="line">                return true, nil</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ£€æŸ¥ç»™å®š HTTP ç«¯ç‚¹çš„å¥åº·çŠ¶æ€ã€‚</p>
<p>å‚æ•°ï¼šç«¯ç‚¹ URI å’Œè¶…æ—¶æ—¶é—´ã€‚</p>
<p>è¿”å›å€¼ï¼šå¥åº·æ£€æŸ¥å‡½æ•°ã€‚</p>
<h2 id="6-6-getHealthCheckFunc"><a href="#6-6-getHealthCheckFunc" class="headerlink" title="6.6 getHealthCheckFunc"></a>6.6 getHealthCheckFunc</h2><p>pkg&#x2F;healthchecker&#x2F;health_checker.go:138</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// getHealthCheckFunc returns the health check function based on the component.</span><br><span class="line">func getHealthCheckFunc(hco *options.HealthCheckerOptions) func() (bool, error) &#123;</span><br><span class="line">        switch hco.Component &#123;</span><br><span class="line">        case types.KubeletComponent:</span><br><span class="line">                return healthCheckEndpointOKFunc(types.KubeletHealthCheckEndpoint(), hco.HealthCheckTimeout)</span><br><span class="line">        case types.KubeProxyComponent:</span><br><span class="line">                return healthCheckEndpointOKFunc(types.KubeProxyHealthCheckEndpoint(), hco.HealthCheckTimeout)</span><br><span class="line">        case types.DockerComponent:</span><br><span class="line">                return func() (bool, error) &#123;</span><br><span class="line">                        if _, err := execCommand(hco.HealthCheckTimeout, getDockerPath(), &quot;ps&quot;); err != nil &#123;</span><br><span class="line">                                return false, nil</span><br><span class="line">                        &#125;</span><br><span class="line">                        return true, nil</span><br><span class="line">                &#125;</span><br><span class="line">        case types.CRIComponent:</span><br><span class="line">                return func() (bool, error) &#123;</span><br><span class="line">                        _, err := execCommand(</span><br><span class="line">                                hco.HealthCheckTimeout,</span><br><span class="line">                                hco.CriCtlPath,</span><br><span class="line">                                &quot;--timeout=&quot;+hco.CriTimeout.String(),</span><br><span class="line">                                &quot;--runtime-endpoint=&quot;+hco.CriSocketPath,</span><br><span class="line">                                &quot;pods&quot;,</span><br><span class="line">                                &quot;--latest&quot;,</span><br><span class="line">                        )</span><br><span class="line">                        if err != nil &#123;</span><br><span class="line">                                return false, nil</span><br><span class="line">                        &#125;</span><br><span class="line">                        return true, nil</span><br><span class="line">                &#125;</span><br><span class="line">        default:</span><br><span class="line">                klog.Warningf(&quot;Unsupported component: %v&quot;, hco.Component)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®ç»„ä»¶ç±»å‹è¿”å›ç›¸åº”çš„å¥åº·æ£€æŸ¥æ–¹æ³•ã€‚</p>
<p>å‚æ•°ï¼šå¥åº·æ£€æŸ¥é€‰é¡¹ã€‚</p>
<p>è¿”å›å€¼ï¼šæ‰§è¡Œå¥åº·æ£€æŸ¥çš„å‡½æ•°ã€‚</p>
<h2 id="6-7-execCommand"><a href="#6-7-execCommand" class="headerlink" title="6.7 execCommand"></a>6.7 execCommand</h2><p>pkg&#x2F;healthchecker&#x2F;health_checker.go:174</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// execCommand executes the bash command and returns the (output, error) from command, error if timeout occurs.</span><br><span class="line">func execCommand(timeout time.Duration, command string, args ...string) (string, error) &#123;</span><br><span class="line">        ctx, cancel := context.WithTimeout(context.Background(), timeout)</span><br><span class="line">        defer cancel()</span><br><span class="line">        cmd := exec.CommandContext(ctx, command, args...)</span><br><span class="line">        out, err := cmd.CombinedOutput()</span><br><span class="line">        if err != nil &#123;</span><br><span class="line">                klog.Infof(&quot;command %v failed: %v, %s\n&quot;, cmd, err, string(out))</span><br><span class="line">                return &quot;&quot;, err</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return strings.TrimSuffix(string(out), &quot;\n&quot;), nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»™å®šçš„å‘½ä»¤ï¼Œå¹¶åœ¨æŒ‡å®šçš„è¶…æ—¶æ—¶é—´å†…è¿”å›è¾“å‡ºå’Œé”™è¯¯ã€‚</p>
<p>å‚æ•°ï¼šè¶…æ—¶æ—¶é—´ã€å‘½ä»¤å’Œå‚æ•°ã€‚</p>
<p>è¿”å›å€¼ï¼šå‘½ä»¤çš„è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯ã€‚</p>
<h2 id="6-8-getUptimeFunc"><a href="#6-8-getUptimeFunc" class="headerlink" title="6.8 getUptimeFunc"></a>6.8 getUptimeFunc</h2><p>pkg&#x2F;healthchecker&#x2F;health_checker_linux.go:32</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// getUptimeFunc returns the time for which the given service has been running.</span><br><span class="line">func getUptimeFunc(service string) func() (time.Duration, error) &#123;</span><br><span class="line">        return func() (time.Duration, error) &#123;</span><br><span class="line">                // Using InactiveExitTimestamp to capture the exact time when systemd tried starting the service. The service will</span><br><span class="line">                // transition from inactive -&gt; activating and the timestamp is captured.</span><br><span class="line">                // Source : https://www.freedesktop.org/wiki/Software/systemd/dbus/</span><br><span class="line">                // Using ActiveEnterTimestamp resulted in race condition where the service was repeatedly killed by plugin when</span><br><span class="line">                // RestartSec of systemd and invoke interval of plugin got in sync. The service was repeatedly killed in</span><br><span class="line">                // activating state and hence ActiveEnterTimestamp was never updated.</span><br><span class="line">                out, err := execCommand(types.CmdTimeout, &quot;systemctl&quot;, &quot;show&quot;, service, &quot;--property=InactiveExitTimestamp&quot;)</span><br><span class="line"></span><br><span class="line">                if err != nil &#123;</span><br><span class="line">                        return time.Duration(0), err</span><br><span class="line">                &#125;</span><br><span class="line">                val := strings.Split(out, &quot;=&quot;)</span><br><span class="line">                if len(val) &lt; 2 &#123;</span><br><span class="line">                        return time.Duration(0), errors.New(&quot;could not parse the service uptime time correctly&quot;)</span><br><span class="line">                &#125;</span><br><span class="line">                t, err := time.Parse(types.UptimeTimeLayout, val[1])</span><br><span class="line">                if err != nil &#123;</span><br><span class="line">                        return time.Duration(0), err</span><br><span class="line">                &#125;</span><br><span class="line">                return time.Since(t), nil</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè®¡ç®—æŒ‡å®šæœåŠ¡çš„è¿è¡Œæ—¶é—´ã€‚</p>
<p>å‚æ•°ï¼š</p>
<ul>
<li><p>service string - è¢«ç›‘æ§æœåŠ¡çš„åç§°ã€‚</p>
</li>
<li><p>è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›æœåŠ¡è¿è¡Œçš„æŒç»­æ—¶é—´æˆ–é”™è¯¯ã€‚</p>
</li>
<li><p>å®ç°ç»†èŠ‚</p>
</li>
<li><p>ä½¿ç”¨ systemctl show å‘½ä»¤è·å– InactiveExitTimestampï¼Œè¿™æ˜¯æœåŠ¡ä» inactive çŠ¶æ€è½¬æ¢æ—¶çš„æ—¶é—´æˆ³ã€‚</p>
</li>
<li><p>è§£æå‘½ä»¤çš„è¾“å‡ºï¼Œå°†æ—¶é—´æˆ³è½¬æ¢ä¸º time.Time ç±»å‹ï¼Œå¹¶è®¡ç®—è‡ªè¯¥æ—¶é—´ä»¥æ¥çš„æŒç»­æ—¶é—´ã€‚</p>
</li>
<li><p>æ­¤æ–¹æ³•å¯ç”¨äºè·å–æœåŠ¡çš„å½“å‰è¿è¡Œæ—¶é—´ï¼Œä»¥ä¾¿è¯„ä¼°æ˜¯å¦åœ¨ä¿®å¤ä¹‹å‰è¾¾åˆ°å†·å´æ—¶é—´ã€‚</p>
</li>
</ul>
<h2 id="6-9-getRepairFunc"><a href="#6-9-getRepairFunc" class="headerlink" title="6.9 getRepairFunc"></a>6.9 getRepairFunc</h2><p>pkg&#x2F;healthchecker&#x2F;health_checker_linux.go:58</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// getRepairFunc returns the repair function based on the component.</span><br><span class="line">func getRepairFunc(hco *options.HealthCheckerOptions) func() &#123;</span><br><span class="line">        // Use `systemctl kill` instead of `systemctl restart` for the repair function.</span><br><span class="line">        // We start to rely on the kernel message difference for the two commands to</span><br><span class="line">        // indicate if the component restart is due to an administrative plan (restart)</span><br><span class="line">        // or a system issue that needs repair (kill).</span><br><span class="line">        // See https://github.com/kubernetes/node-problem-detector/issues/847.</span><br><span class="line">        switch hco.Component &#123;</span><br><span class="line">        case types.DockerComponent:</span><br><span class="line">                // Use &quot;docker ps&quot; for docker health check. Not using crictl for docker to remove</span><br><span class="line">                // dependency on the kubelet.</span><br><span class="line">                return func() &#123;</span><br><span class="line">                        execCommand(types.CmdTimeout, &quot;pkill&quot;, &quot;-SIGUSR1&quot;, &quot;dockerd&quot;)</span><br><span class="line">                        execCommand(types.CmdTimeout, &quot;systemctl&quot;, &quot;kill&quot;, &quot;--kill-who=main&quot;, hco.Service)</span><br><span class="line">                &#125;</span><br><span class="line">        default:</span><br><span class="line">                // Just kill the service for all other components</span><br><span class="line">                return func() &#123;</span><br><span class="line">                        execCommand(types.CmdTimeout, &quot;systemctl&quot;, &quot;kill&quot;, &quot;--kill-who=main&quot;, hco.Service)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®æœåŠ¡çš„ç»„ä»¶ç±»å‹è¿”å›ä¸€ä¸ªæ¼”ç¤ºä¿®å¤åŠŸèƒ½çš„æ–¹æ³•ã€‚</p>
<p>å‚æ•°ï¼š</p>
<ul>
<li>hco *options.HealthCheckerOptions - å¥åº·æ£€æŸ¥çš„é€‰é¡¹ã€‚</li>
<li>è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ‰§è¡Œç›¸åº”ä¿®å¤æ“ä½œã€‚</li>
</ul>
<p>å®ç°ç»†èŠ‚</p>
<ul>
<li>å¯¹äº Docker ç»„ä»¶ï¼Œé€šè¿‡ pkill å‘é€ SIGUSR1 ä¿¡å·ä»¥æ›´ä¼˜é›…åœ°åœæ­¢ Docker å®ˆæŠ¤è¿›ç¨‹ã€‚</li>
<li>å¯¹äºå…¶ä»–ç»„ä»¶ï¼Œè°ƒç”¨ systemctl kill å‘½ä»¤ç»ˆæ­¢ä¸»è¦è¿›ç¨‹ã€‚</li>
<li>è¿™ç§è®¾è®¡ä½¿å¾—ä¿®å¤åŠŸèƒ½èƒ½å¤Ÿæ ¹æ®ä¸åŒçš„ç»„ä»¶é‡‡å–åˆé€‚çš„å¤„ç†æ–¹å¼ã€‚</li>
</ul>
<h2 id="6-10-checkForPattern"><a href="#6-10-checkForPattern" class="headerlink" title="6.10 checkForPattern"></a>6.10 checkForPattern</h2><p>pkg&#x2F;healthchecker&#x2F;health_checker_linux.go:82</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// checkForPattern returns (true, nil) if logPattern occurs less than logCountThreshold number of times since last</span><br><span class="line">// service restart. (false, nil) otherwise.</span><br><span class="line">func checkForPattern(service, logStartTime, logPattern string, logCountThreshold int) (bool, error) &#123;</span><br><span class="line">        out, err := execCommand(types.CmdTimeout, &quot;/bin/sh&quot;, &quot;-c&quot;,</span><br><span class="line">                // Query service logs since the logStartTime</span><br><span class="line">                `journalctl --unit &quot;`+service+`&quot; --since &quot;`+logStartTime+</span><br><span class="line">                        // Grep the pattern</span><br><span class="line">                        `&quot; | grep -i &quot;`+logPattern+</span><br><span class="line">                        // Get the count of occurrences</span><br><span class="line">                        `&quot; | wc -l`)</span><br><span class="line">        if err != nil &#123;</span><br><span class="line">                return true, err</span><br><span class="line">        &#125;</span><br><span class="line">        occurrences, err := strconv.Atoi(out)</span><br><span class="line">        if err != nil &#123;</span><br><span class="line">                return true, err</span><br><span class="line">        &#125;</span><br><span class="line">        if occurrences &gt;= logCountThreshold &#123;</span><br><span class="line">                klog.Infof(&quot;%s failed log pattern check, %s occurrences: %v&quot;, service, logPattern, occurrences)</span><br><span class="line">                return false, nil</span><br><span class="line">        &#125;</span><br><span class="line">        return true, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ£€æŸ¥æŒ‡å®šæœåŠ¡çš„æ—¥å¿—ä¸­æ˜¯å¦åŒ…å«ç‰¹å®šæ¨¡å¼ï¼Œå¹¶è¿”å›å…¶å‡ºç°æ¬¡æ•°æ˜¯å¦è¾¾åˆ°é˜ˆå€¼ã€‚</p>
<p>å‚æ•°ï¼š</p>
<ul>
<li>serviceï¼šè¢«ç›‘æ§æœåŠ¡çš„åç§°ã€‚</li>
<li>logStartTimeï¼šèµ·å§‹æ—¶é—´ï¼Œç”¨äºè¿‡æ»¤æ—¥å¿—ã€‚</li>
<li>logPatternï¼šéœ€è¦æ£€æŸ¥çš„æ—¥å¿—æ¨¡å¼ã€‚</li>
<li>logCountThresholdï¼šæ¨¡å¼å‡ºç°çš„æœ€å¤§æ¬¡æ•°é˜ˆå€¼ã€‚</li>
<li>è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºæ˜¯å¦å¥åº·ï¼Œä»¥åŠå¯èƒ½çš„é”™è¯¯ã€‚</li>
</ul>
<p>å®ç°ç»†èŠ‚</p>
<ul>
<li>ä½¿ç”¨ journalctl å‘½ä»¤è·å–ä»æŒ‡å®šæ—¶é—´å¼€å§‹çš„æœåŠ¡æ—¥å¿—ï¼Œå¹¶é€šè¿‡ grep è¿‡æ»¤ç¬¦åˆæ¡ä»¶çš„æ—¥å¿—æ¨¡å¼ã€‚</li>
<li>ä½¿ç”¨ wc -l è®¡ç®—åŒ¹é…çš„è¡Œæ•°ã€‚</li>
<li>å¦‚æœæ—¥å¿—æ¨¡å¼å‡ºç°çš„æ¬¡æ•°å¤§äºé˜ˆå€¼ï¼Œè®°å½•ç›¸å…³ä¿¡æ¯å¹¶è¿”å›å¥åº·æ£€æŸ¥å¤±è´¥çš„ç»“æœã€‚</li>
</ul>
<h1 id="7-logcounter"><a href="#7-logcounter" class="headerlink" title="7 logcounter"></a>7 logcounter</h1><h2 id="7-1-logCounterå®šä¹‰"><a href="#7-1-logCounterå®šä¹‰" class="headerlink" title="7.1 logCounterå®šä¹‰"></a>7.1 logCounterå®šä¹‰</h2><p>pkg&#x2F;logcounter&#x2F;log_counter.go:42</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">type logCounter struct &#123;</span><br><span class="line">        logCh         &lt;-chan *systemtypes.Log</span><br><span class="line">        buffer        systemlogmonitor.LogBuffer</span><br><span class="line">        pattern       string</span><br><span class="line">        revertPattern string</span><br><span class="line">        clock         clock.Clock</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å­—æ®µè§£é‡Šï¼š</p>
<ul>
<li>logChï¼šåªè¯»é€šé“ï¼Œç”¨äºæ¥æ”¶ç³»ç»Ÿæ—¥å¿—ã€‚</li>
<li>bufferï¼šå­˜å‚¨æ—¥å¿—çš„ç¼“å†²åŒºï¼Œä»¥ä¾¿åˆ†æå’Œè®¡æ•°ã€‚</li>
<li>patternï¼šå¤„ç†æ—¥å¿—æ—¶ä½¿ç”¨çš„åŒ¹é…æ¨¡å¼ã€‚</li>
<li>revertPatternï¼šå¯ç”¨æ¥åå‘è®¡æ•°çš„æ¨¡å¼ã€‚</li>
<li>clockï¼šç”¨äºè·å–å½“å‰æ—¶é—´çš„æ—¶é’Ÿï¼Œæ”¯æŒæ¨¡æ‹Ÿæ—¶é’ŸåŠŸèƒ½ã€‚</li>
</ul>
<h2 id="7-2-NewJournaldLogCounter"><a href="#7-2-NewJournaldLogCounter" class="headerlink" title="7.2 NewJournaldLogCounter"></a>7.2 NewJournaldLogCounter</h2><p>pkg&#x2F;logcounter&#x2F;log_counter.go:50</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">func NewJournaldLogCounter(options *options.LogCounterOptions) (types.LogCounter, error) &#123;</span><br><span class="line">        watcher := journald.NewJournaldWatcher(watchertypes.WatcherConfig&#123;</span><br><span class="line">                Plugin:       &quot;journald&quot;,</span><br><span class="line">                PluginConfig: map[string]string&#123;journaldSourceKey: options.JournaldSource&#125;,</span><br><span class="line">                LogPath:      options.LogPath,</span><br><span class="line">                Lookback:     options.Lookback,</span><br><span class="line">                Delay:        options.Delay,</span><br><span class="line">        &#125;)</span><br><span class="line">        logCh, err := watcher.Watch()</span><br><span class="line">        if err != nil &#123;</span><br><span class="line">                return nil, fmt.Errorf(&quot;error watching journald: %v&quot;, err)</span><br><span class="line">        &#125;</span><br><span class="line">        return &amp;logCounter&#123;</span><br><span class="line">                logCh:         logCh,</span><br><span class="line">                buffer:        systemlogmonitor.NewLogBuffer(bufferSize),</span><br><span class="line">                pattern:       options.Pattern,</span><br><span class="line">                revertPattern: options.RevertPattern,</span><br><span class="line">                clock:         clock.RealClock&#123;&#125;,</span><br><span class="line">        &#125;, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆå§‹åŒ–å¹¶è¿”å›ä¸€ä¸ªæ–°çš„ logCounter å®ä¾‹ã€‚</p>
<p>å‚æ•°ï¼š</p>
<ul>
<li>options *options.LogCounterOptions - åŒ…å«é…ç½®ä¿¡æ¯ï¼ˆä¾‹å¦‚æ—¥å¿—æºã€è·¯å¾„ã€æ¨¡å¼ç­‰ï¼‰ã€‚</li>
<li>è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ªå®ç°äº† types.LogCounter æ¥å£çš„ logCounter å®ä¾‹ã€‚</li>
</ul>
<p>å®ç°ç»†èŠ‚</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ª journald æ—¥å¿—è§‚å¯Ÿè€…å®ä¾‹æ¥ç›‘æ§æŒ‡å®šçš„æ—¥å¿—è·¯å¾„ã€‚</li>
<li>å¦‚æœç›‘è§†æ“ä½œæˆåŠŸï¼Œå»ºç«‹æ—¥å¿—é€šé“å¹¶åˆ›å»º logCounter çš„å®ä¾‹ï¼Œè®¾ç½®ç¼“å†²åŒºã€åŒ¹é…æ¨¡å¼ç­‰ã€‚</li>
</ul>
<h2 id="7-3-Count"><a href="#7-3-Count" class="headerlink" title="7.3 Count"></a>7.3 Count</h2><p>pkg&#x2F;logcounter&#x2F;log_counter.go:71</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">func (e *logCounter) Count() (count int, err error) &#123;</span><br><span class="line">        start := e.clock.Now()</span><br><span class="line">        for &#123;</span><br><span class="line">                select &#123;</span><br><span class="line">                case log, ok := &lt;-e.logCh:</span><br><span class="line">                        if !ok &#123;</span><br><span class="line">                                err = fmt.Errorf(&quot;log channel closed unexpectedly&quot;)</span><br><span class="line">                                return</span><br><span class="line">                        &#125;</span><br><span class="line">                        if start.Before(log.Timestamp) &#123;</span><br><span class="line">                                return</span><br><span class="line">                        &#125;</span><br><span class="line">                        e.buffer.Push(log)</span><br><span class="line">                        if len(e.buffer.Match(e.pattern)) != 0 &#123;</span><br><span class="line">                                count++</span><br><span class="line">                        &#125;</span><br><span class="line">                        if e.revertPattern != &quot;&quot; &amp;&amp; len(e.buffer.Match(e.revertPattern)) != 0 &#123;</span><br><span class="line">                                count--</span><br><span class="line">                        &#125;</span><br><span class="line">                case &lt;-e.clock.After(timeout):</span><br><span class="line">                        return</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»Ÿè®¡åœ¨è¿è¡ŒæœŸé—´åŒ¹é…çš„æ—¥å¿—æ¡ç›®æ•°é‡ã€‚</p>
<p>è¿”å›å€¼ï¼šè¿”å›ç¬¦åˆæ¡ä»¶çš„æ—¥å¿—è®¡æ•°åŠä»»ä½•æ½œåœ¨çš„é”™è¯¯ã€‚</p>
<p>å®ç°ç»†èŠ‚</p>
<ul>
<li>ä½¿ç”¨å½“å‰æ—¶é—´ (start) è®°å½•å¼€å§‹æ—¶åˆ»ã€‚</li>
<li>åœ¨æ— é™å¾ªç¯ä¸­ï¼Œä½¿ç”¨ select è¯­å¥ç›‘å¬æ—¥å¿—é€šé“å’Œè¶…æ—¶äº‹ä»¶ã€‚</li>
<li>å¦‚æœä» logCh è¯»å–åˆ°æ—¥å¿—ï¼š<ul>
<li>æ£€æŸ¥é€šé“æ˜¯å¦å·²ç»å…³é—­ã€‚</li>
<li>å¦‚æœè¯»å–åˆ°çš„æ—¥å¿—æ—¶é—´æˆ³æ™šäºå¼€å§‹æ—¶é—´ï¼Œåˆ™åœæ­¢è®¡æ•°ã€‚</li>
<li>å°†æ—¥å¿—æ¡ç›®å‹å…¥ç¼“å†²åŒºã€‚</li>
<li>æ£€æŸ¥å½“å‰æ—¥å¿—æ˜¯å¦ä¸æ¨¡å¼åŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ™è®¡æ•°åŠ ä¸€ï¼›å¦‚æœåŒ¹é…åå‘æ¨¡å¼ï¼Œåˆ™è®¡æ•°å‡ä¸€ã€‚</li>
<li>å¦‚æœåœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ–°æ—¥å¿—ï¼Œç»“æŸå¾ªç¯å¹¶è¿”å›è®¡æ•°ã€‚</li>
</ul>
</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>ä»“åº“forkååŒæ­¥</title>
    <url>/2025/07/devops/environment/%E4%BB%93%E5%BA%93fork%E5%90%8E%E5%90%8C%E6%AD%A5/</url>
    <content><![CDATA[<h1 id="forkä»“åº“"><a href="#forkä»“åº“" class="headerlink" title="forkä»“åº“"></a>forkä»“åº“</h1><p><img src="/img_4.png" alt="img_4.png"><br><img src="/img_5.png" alt="img_5.png"></p>
<p>æ­¤æ—¶ä¼šå°†è¯¥ä»“åº“åœ¨å¤åˆ¶ä¸€ä»½ï¼Œå¹¶å­˜æ”¾åœ¨ä½ çš„è·¯å¾„ä¸‹ï¼š<br><img src="/img_6.png" alt="img_6.png"></p>
<h1 id="è®¾ç½®ä¸Šæ¸¸ä»£ç åº“"><a href="#è®¾ç½®ä¸Šæ¸¸ä»£ç åº“" class="headerlink" title="è®¾ç½®ä¸Šæ¸¸ä»£ç åº“"></a>è®¾ç½®ä¸Šæ¸¸ä»£ç åº“</h1><p>è¿›å…¥æœ¬åœ°ä»£ç åº“ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä»è‡ªå·±ä»“åº“è¿›è¡Œ<span class="built_in">clone</span>(fork)</span></span><br><span class="line">git clone https://github.com/qiqiuyang/bk-ci.git</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥ç›®å½•</span></span><br><span class="line">cd bk-ci/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ç›®å½•ç»“æ„</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">CHANGELOG              CONTRIBUTING.md  README_EN.md  support-files</span><br><span class="line">CODE_OF_CONDUCT.en.md  docker-images    README.md     THIRD-PARTY-NOTICES.txt</span><br><span class="line">CODE_OF_CONDUCT.md     docs             scripts</span><br><span class="line">CODEOWNERS             helm-charts      SECURITY.md</span><br><span class="line">CONTRIBUTING.en.md     LICENSE.txt      src</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹è¿œç¨‹ä»“åº“çš„è·¯å¾„</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git remote -v</span></span><br><span class="line">origin        https://github.com/qiqiuyang/bk-ci.git (fetch)</span><br><span class="line">origin        https://github.com/qiqiuyang/bk-ci.git (push)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥å‘ç°ä»è‡ªå·±ä»“åº“cloneä¸‹æ¥åï¼Œfetchå’Œpushçš„è·¯å¾„éƒ½æ˜¯è‡ªå·±çš„ã€‚</p>
<p>è®¾ç½®ä¸Šæ¸¸ä»£ç åº“</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git remote add upstream git@github.com:TencentBlueKing/bk-ci.git</span></span><br></pre></td></tr></table></figure>

<p>å†æ¬¡æŸ¥çœ‹è¿œç¨‹ä»“åº“åœ°å€ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git remote -v</span></span><br><span class="line">origin        https://github.com/qiqiuyang/bk-ci.git (fetch)</span><br><span class="line">origin        https://github.com/qiqiuyang/bk-ci.git (push)</span><br><span class="line">upstream        git@github.com:TencentBlueKing/bk-ci.git (fetch)</span><br><span class="line">upstream        git@github.com:TencentBlueKing/bk-ci.git (push)</span><br></pre></td></tr></table></figure>

<h1 id="åŒæ­¥æºä»“åº“çš„æ›´æ–°"><a href="#åŒæ­¥æºä»“åº“çš„æ›´æ–°" class="headerlink" title="åŒæ­¥æºä»“åº“çš„æ›´æ–°"></a>åŒæ­¥æºä»“åº“çš„æ›´æ–°</h1><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ‹‰å–æºä»“åº“çš„æ›´æ–°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git fetch upstream</span></span><br><span class="line">remote: Enumerating objects: 17643, done.</span><br><span class="line">remote: Counting objects: 100% (13492/13492), done.</span><br><span class="line">remote: Compressing objects: 100% (3960/3960), done.</span><br><span class="line">remote: Total 10070 (delta 4278), reused 8600 (delta 3184), pack-reused 0 (from 0)</span><br><span class="line">æ¥æ”¶å¯¹è±¡ä¸­: 100% (10070/10070), 2.44 MiB | 2.05 MiB/s, å®Œæˆ.</span><br><span class="line">å¤„ç† delta ä¸­: 100% (4278/4278), å®Œæˆ 657 ä¸ªæœ¬åœ°å¯¹è±¡.</span><br><span class="line">æ¥è‡ª github.com:TencentBlueKing/bk-ci</span><br><span class="line"> * [æ–°åˆ†æ”¯]                master          -&gt; upstream/master</span><br><span class="line"> * [æ–°åˆ†æ”¯]                release-1.11    -&gt; upstream/release-1.11</span><br><span class="line"> * [æ–°åˆ†æ”¯]                release-1.14    -&gt; upstream/release-1.14</span><br><span class="line"> * [æ–°åˆ†æ”¯]                release-1.2     -&gt; upstream/release-1.2</span><br><span class="line"> * [æ–°åˆ†æ”¯]                release-1.3     -&gt; upstream/release-1.3</span><br><span class="line">ã€‚ã€‚ã€‚</span><br><span class="line">ã€‚ã€‚ã€‚</span><br><span class="line"> * [æ–°æ ‡ç­¾]                v1.8.4          -&gt; v1.8.4</span><br><span class="line"> * [æ–°æ ‡ç­¾]                v1.8.5          -&gt; v1.8.5</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œå°±æ¯”è¾ƒæ¸…æ™°äº†ï¼Œåœ¨æ›´æ–°æ—¶å°±æ˜¯æŠŠæºä»“åº“çš„æ›´æ–°çš„åˆ†æ”¯æ”¾åœ¨upstreamä¸‹ï¼Œä¾‹å¦‚ï¼šupstream&#x2F;master</p>
<p>æ‰€ä»¥åŒæ­¥è¿œç«¯åˆ†æ”¯æ—¶ï¼Œå°±æ˜¯git fetch upstreamï¼Œç„¶åå°†è‡ªå·±çš„åˆ†æ”¯mergeç›®æ ‡åˆ†æ”¯å†…å®¹ï¼Œä¾‹å¦‚ï¼šgit merge upstream&#x2F;master</p>
<p>å¦‚æ­¤ä¾¿å¯ä»¥å®ç°è‡ªå·±çš„forkä»“åº“åŒæ­¥æºä»“åº“çš„æ–°å˜æ›´äº†ã€‚</p>
<h1 id="å‘åŸä»“åº“å‘èµ·PR"><a href="#å‘åŸä»“åº“å‘èµ·PR" class="headerlink" title="å‘åŸä»“åº“å‘èµ·PR"></a>å‘åŸä»“åº“å‘èµ·PR</h1><p>é¦–å…ˆåœ¨è‡ªå·±çš„ä»“åº“ç‚¹å‡»Pull Request-&gt;New Pull Requestï¼Œè¿›å…¥ä»¥ä¸‹æˆªå›¾é¡µé¢<br><img src="/img_7.png" alt="img_7.png"></p>
<p>base repositoryä¸ºåŸä»“åº“çš„æŸä¸ªåˆ†æ”¯ï¼Œhead repositoryä¸ºforkä»“åº“å‘æŸä¸ªåˆ†æ”¯, headçš„æŸä¸ªåˆ†æ”¯ä»£ç åˆåˆ°baseçš„æŸä¸ªåˆ†æ”¯<br><img src="/img_8.png" alt="img_8.png"></p>
<p>è¿›å…¥åŸä»“åº“çš„Pull requestså¯çœ‹åˆ°åˆšæ‰å‘èµ·çš„PRï¼Œ è¿™é‡Œå°±ä¸æ¼”ç¤ºäº†</p>
]]></content>
  </entry>
  <entry>
    <title>BK-CIæ’ä»¶å¼€å‘æŒ‡å¼•</title>
    <url>/2025/07/devops/blueking/BK-CI%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E6%8C%87%E5%BC%95/</url>
    <content><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><blockquote>
<p>å¼€å‘æ’ä»¶å‰ï¼Œå…ˆè¿›å…¥æ’ä»¶å·¥ä½œå°åˆå§‹åŒ–ä¸€ä¸ªæ’ä»¶ï¼Œç¡®å®šæ’ä»¶åœ¨å¹³å°ä¸­çš„å”¯ä¸€æ ‡è¯†</p>
</blockquote>
<h1 id="å·¥ä½œå°"><a href="#å·¥ä½œå°" class="headerlink" title="å·¥ä½œå°"></a>å·¥ä½œå°</h1><p>å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œæ–°å¢&#x2F;å‘å¸ƒ&#x2F;ä¸‹æ¶ç­‰ç®¡ç†æ’ä»¶çš„æ“ä½œ</p>
<h2 id="åŠŸèƒ½åŒºä»‹ç»"><a href="#åŠŸèƒ½åŒºä»‹ç»" class="headerlink" title="åŠŸèƒ½åŒºä»‹ç»"></a>åŠŸèƒ½åŒºä»‹ç»</h2><p><img src="/img.png" alt="img.png"></p>
<ol>
<li>åˆ‡æ¢èµ„æºç±»å‹</li>
<li>æ–°å¢æ’ä»¶</li>
<li>å•ä¸ªæ’ä»¶çš„ç®¡ç†å…¥å£</li>
<li>å‡çº§ã€ä¸‹æ¶ã€åˆ é™¤æ’ä»¶å¿«æ·å…¥å£</li>
<li>æŒ‡å¼•æ–‡æ¡£å’Œæ’ä»¶ UI è°ƒè¯•å·¥å…·å…¥å£</li>
</ol>
<h2 id="æ–°å¢æ’ä»¶"><a href="#æ–°å¢æ’ä»¶" class="headerlink" title="æ–°å¢æ’ä»¶"></a>æ–°å¢æ’ä»¶</h2><p><img src="/img_1.png" alt="img_1.png"></p>
<ol>
<li>æ ‡è¯†</li>
</ol>
<ul>
<li>æ’ä»¶åœ¨å¹³å°ä¸­çš„å”¯ä¸€æ ‡è¯†ï¼Œå»ºè®®å–å’Œæ’ä»¶åŠŸèƒ½ç›¸å…³çš„å¯è¯»æ€§å¥½çš„è‹±æ–‡æ ‡è¯†</li>
</ul>
<ol start="2">
<li>è°ƒè¯•é¡¹ç›®</li>
</ol>
<ul>
<li>æ’ä»¶å‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥åœ¨è°ƒè¯•é¡¹ç›®ä¸‹å°†æ’ä»¶æ·»åŠ åˆ°æµæ°´çº¿æ‰§è¡Œï¼Œå¯¹æ’ä»¶è¿›è¡Œæµ‹è¯•ï¼Œä¿è¯æ’ä»¶åŠŸèƒ½æ»¡è¶³é¢„æœŸã€‚</li>
<li>å»ºè®®æ–°å¢ä¸“ç”¨çš„æ’ä»¶è°ƒè¯•é¡¹ç›®ï¼Œé¿å…æµ‹è¯•è¿‡ç¨‹ä¸­å½±å“åˆ°ä¸šåŠ¡ã€‚</li>
</ul>
<ol start="3">
<li>å¼€å‘è¯­è¨€</li>
</ol>
<ul>
<li>æ”¯æŒå››ç§è¯­è¨€å¼€å‘æ’ä»¶ï¼š<ul>
<li>Javaï¼ˆæ¨èï¼‰</li>
<li>Python</li>
<li>Golang</li>
<li>Nodejs</li>
</ul>
</li>
</ul>
<h2 id="å¼€å‘æ’ä»¶"><a href="#å¼€å‘æ’ä»¶" class="headerlink" title="å¼€å‘æ’ä»¶"></a>å¼€å‘æ’ä»¶</h2><blockquote>
<p>åˆå§‹åŒ–å¥½æ’ä»¶ä¹‹åï¼Œå¯ä»¥å¼€å§‹å¼€å‘æ’ä»¶</p>
</blockquote>
<ul>
<li>æ ¹æ®å¼€å‘è¯­è¨€å‚è€ƒå¯¹åº”çš„å¼€å‘æŒ‡å¼•<ul>
<li><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Developer/plugins/plugin-dev-guide/java.md">Java æ’ä»¶å¼€å‘æŒ‡å¼•</a></li>
<li><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Developer/plugins/plugin-dev-guide/python.md">Python æ’ä»¶å¼€å‘æŒ‡å¼•</a></li>
<li><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Developer/plugins/plugin-dev-guide/golang.md">Golang æ’ä»¶å¼€å‘æŒ‡å¼•</a></li>
<li><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Developer/plugins/plugin-dev-guide/nodejs.md">Nodejs æ’ä»¶å¼€å‘æŒ‡å¼•</a></li>
</ul>
</li>
</ul>
<h2 id="æ’ä»¶ç§æœ‰é…ç½®"><a href="#æ’ä»¶ç§æœ‰é…ç½®" class="headerlink" title="æ’ä»¶ç§æœ‰é…ç½®"></a>æ’ä»¶ç§æœ‰é…ç½®</h2><blockquote>
<p>æ’ä»¶çº§åˆ«çš„æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚ tokenã€ç”¨æˆ·åå¯†ç ã€IPã€åŸŸåç­‰ï¼Œä¸å»ºè®®ç›´æ¥æäº¤åˆ°ä»£ç åº“ï¼Œé€šè¿‡å·¥ä½œå°ç§æœ‰é…ç½®ç•Œé¢ç®¡ç†</p>
</blockquote>
<p><img src="/img_2.png" alt="img_2.png"></p>
<h1 id="Golang-æ’ä»¶å¼€å‘"><a href="#Golang-æ’ä»¶å¼€å‘" class="headerlink" title="Golang æ’ä»¶å¼€å‘"></a>Golang æ’ä»¶å¼€å‘</h1><h2 id="æ’ä»¶å¼€å‘æ¡†æ¶è¯´æ˜"><a href="#æ’ä»¶å¼€å‘æ¡†æ¶è¯´æ˜" class="headerlink" title="æ’ä»¶å¼€å‘æ¡†æ¶è¯´æ˜"></a>æ’ä»¶å¼€å‘æ¡†æ¶è¯´æ˜</h2><blockquote>
<p>æ’ä»¶æœ€ç»ˆæ‰“åŒ…æˆä¸€ä¸ªå‘½ä»¤è¡Œå¯æ‰§è¡Œçš„å‘½ä»¤å³å¯ï¼Œå¯¹å¼€å‘æ¡†æ¶æ— ç¡¬æ€§è¦æ±‚ ä¸‹è¾¹ä»¥ demo æ’ä»¶ä¸ºä¾‹ç¤ºèŒƒ</p>
</blockquote>
<h2 id="ç¤ºä¾‹æ’ä»¶ä»£ç å·¥ç¨‹çš„æ•´ä½“ç»“æ„å¦‚ä¸‹"><a href="#ç¤ºä¾‹æ’ä»¶ä»£ç å·¥ç¨‹çš„æ•´ä½“ç»“æ„å¦‚ä¸‹" class="headerlink" title="ç¤ºä¾‹æ’ä»¶ä»£ç å·¥ç¨‹çš„æ•´ä½“ç»“æ„å¦‚ä¸‹"></a>ç¤ºä¾‹æ’ä»¶ä»£ç å·¥ç¨‹çš„æ•´ä½“ç»“æ„å¦‚ä¸‹</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">|- &lt;ä½ çš„æ’ä»¶æ ‡è¯†&gt;</span><br><span class="line">    |- cmd</span><br><span class="line">        |- application</span><br><span class="line">            |- main.go</span><br><span class="line"></span><br><span class="line">    |- hello</span><br><span class="line">        |- hello.go</span><br></pre></td></tr></table></figure>

<h2 id="å¦‚ä½•å¼€å‘æ’ä»¶ï¼š"><a href="#å¦‚ä½•å¼€å‘æ’ä»¶ï¼š" class="headerlink" title="å¦‚ä½•å¼€å‘æ’ä»¶ï¼š"></a>å¦‚ä½•å¼€å‘æ’ä»¶ï¼š</h2><blockquote>
<p>å‚è€ƒ <a href="https://github.com/ci-plugins/plugin-demo-golang">plugin-demo-golang</a></p>
</blockquote>
<ul>
<li>å»ºæ’ä»¶ä»£ç å·¥ç¨‹<ul>
<li>æ’ä»¶ä»£ç å»ºè®®ä¼ä¸šä¸‹ç»Ÿä¸€ç®¡ç†ã€‚ é€šç”¨çš„å¼€æºæ’ä»¶å¯ä»¥è”ç³»è“é²¸å®˜æ–¹æ”¾åˆ° <a href="https://github.com/TencentBlueKing">TencentBlueKing</a> ä¸‹ï¼Œä¾›æ›´å¤šç”¨æˆ·ä½¿ç”¨</li>
</ul>
</li>
<li>å®ç°æ’ä»¶åŠŸèƒ½</li>
<li>è§„èŒƒï¼š<ul>
<li><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Developer/plugins/plugin-dev-standard/plugin-specification.md">æ’ä»¶å¼€å‘è§„èŒƒ</a></li>
<li><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Developer/plugins/plugin-dev-standard/plugin-config.md">æ’ä»¶é…ç½®è§„èŒƒ</a></li>
</ul>
</li>
<li>æ’ä»¶å‰ç«¯ä¸ä»…å¯ä»¥é€šè¿‡ task.json è¿›è¡Œæ ‡å‡†åŒ–é…ç½®ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰å¼€å‘ï¼š<ul>
<li><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Developer/plugins/plugin-dev-standard/plugin-custom-ui.md">è‡ªå®šä¹‰æ’ä»¶ UI äº¤äº’æŒ‡å¼•</a></li>
<li><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Developer/plugins/plugin-dev-standard/plugin-output.md">æ’ä»¶è¾“å‡ºè§„èŒƒ</a></li>
<li><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Developer/plugins/plugin-dev-standard/plugin-error-code.md">æ’ä»¶é”™è¯¯ç è§„èŒƒ</a></li>
<li><a href="https://bk.tencent.com/docs/markdown/ZH/Devops/3.0/UserGuide/Developer/plugins/plugin-dev-standard/release.md">æ’ä»¶å‘å¸ƒåŒ…è§„èŒƒ</a></li>
</ul>
</li>
</ul>
<h2 id="Demoç¤ºä¾‹ç ”è¯»"><a href="#Demoç¤ºä¾‹ç ”è¯»" class="headerlink" title="Demoç¤ºä¾‹ç ”è¯»"></a>Demoç¤ºä¾‹ç ”è¯»</h2><p>å°† <a href="https://github.com/ci-plugins/plugin-demo-golang">plugin-demo-golang</a> cloneåˆ°æœ¬åœ°ã€‚<br>æ¥çœ‹ä¸‹é¡¹ç›®ç»“æ„ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ CONTRIBUTING.md</span><br><span class="line">â”œâ”€â”€ LICENSE</span><br><span class="line">â”œâ”€â”€ Makefile</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ go.mod</span><br><span class="line">â”œâ”€â”€ go.sum</span><br><span class="line">â”œâ”€â”€ i18n</span><br><span class="line">â”‚   â”œâ”€â”€ message_en_US.properties</span><br><span class="line">â”‚   â””â”€â”€ message_zh_CN.properties</span><br><span class="line">â”œâ”€â”€ main.go</span><br><span class="line">â”œâ”€â”€ task.json</span><br><span class="line">â””â”€â”€ translation</span><br><span class="line">    â””â”€â”€ translation.go</span><br><span class="line"></span><br><span class="line">3 directories, 11 files</span><br></pre></td></tr></table></figure>

<p>å’¦ï¼å’Œä¸Šé¢è¯´çš„æ’ä»¶ä»£ç å·¥ç¨‹çš„æ•´ä½“æ¶æ„ä¸ä¸€æ ·ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">|- &lt;ä½ çš„æ’ä»¶æ ‡è¯†&gt;</span><br><span class="line">    |- cmd</span><br><span class="line">        |- application</span><br><span class="line">            |- main.go</span><br><span class="line"></span><br><span class="line">    |- hello</span><br><span class="line">        |- hello.go</span><br></pre></td></tr></table></figure>

<p>ä¸è¿‡ï¼Œè¿™ä¸é‡è¦ï¼Œåªè¦æ’ä»¶æœ€ç»ˆèƒ½å¤Ÿæ‰“åŒ…æˆä¸€ä¸ªå‘½ä»¤è¡Œå¯æ‰§è¡Œçš„å‘½ä»¤å³å¯ã€‚<br>è¿™é‡Œi18næ˜¯å®ç°ä¸­è‹±æ–‡å›½é™…åŒ–ä½¿ç”¨çš„ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”œâ”€â”€ i18n</span><br><span class="line">â”‚   â”œâ”€â”€ message_en_US.properties</span><br><span class="line">â”‚   â””â”€â”€ message_zh_CN.properties</span><br></pre></td></tr></table></figure>

<p>çœ‹ä¸‹å†…å®¹å¯¹æ¯”ï¼š<br>message_en_US.propertiesï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">input.desc.label=desc</span><br><span class="line">100001=input param [&#123;0&#125;] invitated</span><br></pre></td></tr></table></figure>

<p>message_zh_CN.properties</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">input.desc.label=æè¿°</span><br><span class="line">100001=è¾“å…¥å‚æ•°[&#123;0&#125;]éæ³•</span><br></pre></td></tr></table></figure>

<p>é‚£æˆ‘ä»¬å°±å¯ä»¥çŒœæµ‹ï¼Œè¿™é‡Œæ˜¯å®ç°è¾“å…¥å‚æ•°[{0}]éæ³•è¿™å¥è¯çš„ä¸­è‹±æ–‡ï¼Œå…¶ä¸­[{0}]ä¼šä½¿ç”¨å…·ä½“çš„å‚æ•°å¡«å……ã€‚<br>ç„¶åi18ngeneratoråˆ™æ˜¯æ ¹æ®propertiesæ–‡ä»¶çš„é…ç½®ï¼Œç”Ÿæˆtranslationä»£ç ï¼Œå¦‚translation.goï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Code generated by &quot;i18ngenerator&quot;; DO NOT EDIT.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> translation</span><br><span class="line"></span><br><span class="line"><span class="comment">// Translations</span></span><br><span class="line"><span class="keyword">var</span> Translations <span class="keyword">map</span>[<span class="type">string</span>][][]<span class="type">string</span> = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>][][]<span class="type">string</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Translations[<span class="string">&quot;en-US&quot;</span>] = [][]<span class="type">string</span>&#123;</span><br><span class="line">       &#123;</span><br><span class="line">          <span class="string">&quot;100001&quot;</span>,</span><br><span class="line">          <span class="string">&quot;input param [&#123;0&#125;] invitated&quot;</span>,</span><br><span class="line">       &#125;,</span><br><span class="line">       &#123;</span><br><span class="line">          <span class="string">&quot;input.desc.label&quot;</span>,</span><br><span class="line">          <span class="string">&quot;desc&quot;</span>,</span><br><span class="line">       &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    Translations[<span class="string">&quot;zh-CN&quot;</span>] = [][]<span class="type">string</span>&#123;</span><br><span class="line">       &#123;</span><br><span class="line">          <span class="string">&quot;100001&quot;</span>,</span><br><span class="line">          <span class="string">&quot;è¾“å…¥å‚æ•°[&#123;0&#125;]éæ³•&quot;</span>,</span><br><span class="line">       &#125;,</span><br><span class="line">       &#123;</span><br><span class="line">          <span class="string">&quot;input.desc.label&quot;</span>,</span><br><span class="line">          <span class="string">&quot;æè¿°&quot;</span>,</span><br><span class="line">       &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥æ–‡ä»¶æ˜¯ç”±i18ngeneratorè‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä¸è¦è‡ªå·±æ”¹ã€‚<br>mainå‡½æ•°å†…ï¼Œå®ç°äº†ä¸€ä¸ªå°çš„è¾“å‡ºåŠŸèƒ½ï¼Œç®€å•çœ‹ä¸‹æºç ï¼Œç„¶åå»è¿›è¡Œæµ‹è¯•ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">    <span class="string">&quot;runtime&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;github.com/ci-plugins/golang-plugin-sdk/api&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/ci-plugins/golang-plugin-sdk/log&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/ci-plugins/plugin-demo-golang/translation&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//go:generate i18ngenerator i18n ./translation/translation.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> greetingParam <span class="keyword">struct</span> &#123;</span><br><span class="line">    UserName <span class="type">string</span> <span class="string">`json:&quot;userName&quot;`</span></span><br><span class="line">    Greeting <span class="type">string</span> <span class="string">`json:&quot;greeting&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *greetingParam)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;userName: %v, greeting: %v&quot;</span>, a.UserName, a.Greeting)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    runtime.GOMAXPROCS(<span class="number">4</span>)</span><br><span class="line">    log.Info(<span class="string">&quot;atom-demo-glang starts&quot;</span>)</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">       <span class="keyword">if</span> err := <span class="built_in">recover</span>(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">          log.Error(<span class="string">&quot;panic: &quot;</span>, err)</span><br><span class="line">          api.FinishBuild(api.StatusError, <span class="string">&quot;panic occurs&quot;</span>)</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    api.InitI18n(translation.Translations, api.GetRuntimeLanguage())</span><br><span class="line">    msg, err := api.Localize(<span class="string">&quot;input.desc.label&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">       log.Error(err)</span><br><span class="line">    &#125;</span><br><span class="line">    log.Info(msg)</span><br><span class="line"></span><br><span class="line">    helloBuild()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">helloBuild</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// è·å–å•ä¸ªè¾“å…¥å‚æ•°</span></span><br><span class="line">    userName := api.GetInputParam(<span class="string">&quot;userName&quot;</span>)</span><br><span class="line">    log.Info(<span class="string">&quot;userName: &quot;</span>, userName)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å±</span></span><br><span class="line">    log.Info(<span class="string">&quot;\nBuildInfo:&quot;</span>)</span><br><span class="line">    log.Info(<span class="string">&quot;Project Name:     &quot;</span>, api.GetProjectDisplayName())</span><br><span class="line">    log.Info(<span class="string">&quot;Pipeline Id:      &quot;</span>, api.GetPipelineId())</span><br><span class="line">    log.Info(<span class="string">&quot;Pipeline Name:    &quot;</span>, api.GetPipelineName())</span><br><span class="line">    log.Info(<span class="string">&quot;Pipeline Version: &quot;</span>, api.GetPipelineVersion())</span><br><span class="line">    log.Info(<span class="string">&quot;Build Id:         &quot;</span>, api.GetPipelineBuildId())</span><br><span class="line">    log.Info(<span class="string">&quot;Build Num:        &quot;</span>, api.GetPipelineBuildNumber())</span><br><span class="line">    log.Info(<span class="string">&quot;Start Type:       &quot;</span>, api.GetPipelineStartType())</span><br><span class="line">    log.Info(<span class="string">&quot;Start UserId:     &quot;</span>, api.GetPipelineStartUserId())</span><br><span class="line">    log.Info(<span class="string">&quot;Start UserName:   &quot;</span>, api.GetPipelineStartUserName())</span><br><span class="line">    log.Info(<span class="string">&quot;Start Time:       &quot;</span>, api.GetPipelineStartTimeMills())</span><br><span class="line">    log.Info(<span class="string">&quot;Workspace:        &quot;</span>, api.GetWorkspace())</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å…¥å‚æ•°è§£æåˆ°å¯¹è±¡</span></span><br><span class="line">    paramData := <span class="built_in">new</span>(greetingParam)</span><br><span class="line">    api.LoadInputParam(paramData)</span><br><span class="line">    log.Info(fmt.Sprintf(<span class="string">&quot;\n%vï¼Œ%v\n&quot;</span>, paramData.Greeting, paramData.UserName))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    log.Info(<span class="string">&quot;start build&quot;</span>)</span><br><span class="line">    build()</span><br><span class="line">    time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡º</span></span><br><span class="line">    <span class="comment">// å­—ç¬¦ä¸²è¾“å‡º</span></span><br><span class="line">    strData := api.NewStringData(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">    api.AddOutputData(<span class="string">&quot;strData_01&quot;</span>, strData)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–‡ä»¶å½’æ¡£è¾“å‡º</span></span><br><span class="line">    artifactData := api.NewArtifactData()</span><br><span class="line">    artifactData.AddArtifact(<span class="string">&quot;result.dat&quot;</span>)</span><br><span class="line">    api.AddOutputData(<span class="string">&quot;artifactData_02&quot;</span>, artifactData)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŠ¥å‘Šè¾“å‡º</span></span><br><span class="line">    reportData := api.NewReportData(<span class="string">&quot;label_01&quot;</span>, api.GetWorkspace()+<span class="string">&quot;/report&quot;</span>, <span class="string">&quot;report.htm&quot;</span>)</span><br><span class="line">    api.AddOutputData(<span class="string">&quot;report_01&quot;</span>, reportData)</span><br><span class="line"></span><br><span class="line">    api.WriteOutput()</span><br><span class="line">    log.Info(<span class="string">&quot;build done&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">build</span><span class="params">()</span></span> &#123;</span><br><span class="line">    log.Info(<span class="string">&quot;write result.dat&quot;</span>)</span><br><span class="line">    ioutil.WriteFile(api.GetWorkspace()+<span class="string">&quot;/result.dat&quot;</span>, []<span class="type">byte</span>(<span class="string">&quot;content&quot;</span>), <span class="number">0644</span>)</span><br><span class="line">    log.Info(<span class="string">&quot;write report.htm&quot;</span>)</span><br><span class="line">    os.Mkdir(api.GetWorkspace()+<span class="string">&quot;/report&quot;</span>, os.ModePerm)</span><br><span class="line">    ioutil.WriteFile(api.GetWorkspace()+<span class="string">&quot;/report/report.htm&quot;</span>, []<span class="type">byte</span>(<span class="string">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Report&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;H1&gt;This is a Report&lt;/H1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>), <span class="number">0644</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨æ ¹ç›®å½•ä¸‹å·²ç»ç»™æˆ‘ä»¬é¢„è®¾äº†ä¸€ä¸ªtask.jsonæ–‡ä»¶ï¼Œåé¢å¯ä»¥ç®€å•ä¿®æ”¹ä¸‹è¿™ä¸ªæ–‡ä»¶æ¥å®ç°æµ‹è¯•ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;atomCode&quot;</span>: <span class="string">&quot;goDemo&quot;</span>,</span><br><span class="line">  <span class="string">&quot;execution&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;language&quot;</span>: <span class="string">&quot;golang&quot;</span>,</span><br><span class="line">    <span class="string">&quot;packagePath&quot;</span>: <span class="string">&quot;goDemo&quot;</span>,</span><br><span class="line">    <span class="string">&quot;demands&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;chmod +x goDemo&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;target&quot;</span>: <span class="string">&quot;./goDemo&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;input&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;greeting&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;label&quot;</span>: <span class="string">&quot;æ¬¢è¿è¯&quot;</span>,</span><br><span class="line">      <span class="string">&quot;default&quot;</span>: <span class="string">&quot;Glad to see you&quot;</span>,</span><br><span class="line">      <span class="string">&quot;placeholder&quot;</span>: <span class="string">&quot;æ¬¢è¿è¯&quot;</span>,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;vuex-input&quot;</span>,</span><br><span class="line">      <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;æ¬¢è¿è¯&quot;</span>,</span><br><span class="line">      <span class="string">&quot;required&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;disabled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;hidden&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;isSensitive&quot;</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;label&quot;</span>: <span class="string">&quot;å§“å&quot;</span>,</span><br><span class="line">      <span class="string">&quot;default&quot;</span>: <span class="string">&quot;Mr. Huang&quot;</span>,</span><br><span class="line">      <span class="string">&quot;placeholder&quot;</span>: <span class="string">&quot;å§“å&quot;</span>,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;vuex-input&quot;</span>,</span><br><span class="line">      <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;å§“å&quot;</span>,</span><br><span class="line">      <span class="string">&quot;required&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;disabled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;hidden&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;isSensitive&quot;</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;output&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;strData_01&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;description&quot;</span>: <span class="string">&quot;æµ‹è¯•&quot;</span>,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">      <span class="string">&quot;isSensitive&quot;</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å¦‚ä½•æ‰“åŒ…å‘å¸ƒ"><a href="#å¦‚ä½•æ‰“åŒ…å‘å¸ƒ" class="headerlink" title="å¦‚ä½•æ‰“åŒ…å‘å¸ƒ"></a>å¦‚ä½•æ‰“åŒ…å‘å¸ƒ</h2><ol>
<li>è¿›å…¥æ’ä»¶ä»£ç å·¥ç¨‹ç›®å½•ä¸‹</li>
<li>æ‰“åŒ…</li>
</ol>
<ul>
<li>å¦‚æœæŒ‰ç…§æ­£å¸¸çš„demoçš„ç›®å½•ç»“æ„æ˜¯éœ€è¦è¿›å…¥cmd&#x2F;applicationå†…æ‰§è¡Œbuildå‘½ä»¤ï¼Œå› ä¸ºmainåœ¨æ­¤</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd cmd/application</span><br><span class="line">GO111MODULE=on GOOS=linux GOARCH=amd64 go build -o bin/$&#123;executable&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿™æ¬¡ç”¨çš„demoåˆ™ç›´æ¥åœ¨æ ¹ç›®å½•ä¸‹æ‰§è¡Œbuildå‘½ä»¤ï¼Œå› ä¸ºmainåœ¨æ ¹ç›®å½•ä¸‹</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">GO111MODULE=on GOOS=linux GOARCH=amd64 go build -o bin/$&#123;executable&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œgo build -o bin&#x2F;${executable}ä¼šåœ¨binç›®å½•ä¸‹ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ–‡ä»¶åæ˜¯${executable}ï¼Œå³é¡¹ç›®åã€‚<br>ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªåå­—ï¼Œå¦‚<code>GO111MODULE=on GOOS=linux GOARCH=amd64 go build -o bin/kingtest</code></p>
<ol>
<li>åœ¨ä»»æ„ä½ç½®æ–°å»ºæ–‡ä»¶å¤¹ï¼Œå‘½åç¤ºä¾‹ï¼šrelease_pkg &#x3D; &lt;ä½ çš„æ’ä»¶æ ‡è¯†&gt;_release</li>
<li>å°†æ­¥éª¤ 2 ç”Ÿäº§çš„æ‰§è¡ŒåŒ…æ‹·è´åˆ° ä¸‹</li>
<li>æ·»åŠ  task.json æ–‡ä»¶åˆ° ä¸‹ task.json è§ç¤ºä¾‹ï¼ŒæŒ‰ç…§æ’ä»¶åŠŸèƒ½é…ç½®ã€‚</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir kingtest_release</span><br><span class="line">cp bin/kingtest kingtest_release/kingtest</span><br><span class="line">touch kingtest_release/task.json</span><br></pre></td></tr></table></figure>

<ul>
<li>æ’ä»¶é…ç½®è§„èŒƒ</li>
<li>task.json ç¤ºä¾‹ï¼š</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;atomCode&quot;: &quot;king-test&quot;,                  # atomCode è¦ä¸å·¥ä½œå°å½•å…¥çš„ä¸€è‡´</span><br><span class="line">  &quot;execution&quot;: &#123;</span><br><span class="line">    &quot;language&quot;: &quot;golang&quot;,</span><br><span class="line">    &quot;packagePath&quot;: &quot;kingtest&quot;,              # å‘å¸ƒåŒ…ä¸­æ’ä»¶å®‰è£…åŒ…çš„ç›¸å¯¹è·¯å¾„</span><br><span class="line">    &quot;demands&quot;: [</span><br><span class="line">      &quot;echo start run chmod +x kingtest&quot;,   # æ’ä»¶å¯åŠ¨å‰éœ€è¦æ‰§è¡Œçš„å®‰è£…å‘½ä»¤ï¼Œé¡ºåºæ‰§è¡Œ</span><br><span class="line">      &quot;chmod +x kingtest&quot;,                  # æ’ä»¶å¯åŠ¨å‰éœ€è¦æ‰§è¡Œçš„å®‰è£…å‘½ä»¤ï¼Œé¡ºåºæ‰§è¡Œ</span><br><span class="line">      &quot;echo stop run chmod +x kingtest&quot;,    # æ’ä»¶å¯åŠ¨å‰éœ€è¦æ‰§è¡Œçš„å®‰è£…å‘½ä»¤ï¼Œé¡ºåºæ‰§è¡Œ</span><br><span class="line">    ],</span><br><span class="line">    &quot;target&quot;: &quot;./kingtest&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;input&quot;: &#123;</span><br><span class="line">    &quot;greeting&quot;: &#123;</span><br><span class="line">      &quot;label&quot;: &quot;æ¬¢è¿è¯&quot;,</span><br><span class="line">      &quot;default&quot;: &quot;Glad to see you&quot;,</span><br><span class="line">      &quot;placeholder&quot;: &quot;æ¬¢è¿è¯&quot;,</span><br><span class="line">      &quot;type&quot;: &quot;vuex-input&quot;,</span><br><span class="line">      &quot;desc&quot;: &quot;æ¬¢è¿è¯&quot;,</span><br><span class="line">      &quot;required&quot;: true,</span><br><span class="line">      &quot;disabled&quot;: false,</span><br><span class="line">      &quot;hidden&quot;: false,</span><br><span class="line">      &quot;isSensitive&quot;: false</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;userName&quot;: &#123;</span><br><span class="line">      &quot;label&quot;: &quot;å§“å&quot;,</span><br><span class="line">      &quot;default&quot;: &quot;Mr. Huang&quot;,</span><br><span class="line">      &quot;placeholder&quot;: &quot;å§“å&quot;,</span><br><span class="line">      &quot;type&quot;: &quot;vuex-input&quot;,</span><br><span class="line">      &quot;desc&quot;: &quot;å§“å&quot;,</span><br><span class="line">      &quot;required&quot;: true,</span><br><span class="line">      &quot;disabled&quot;: false,</span><br><span class="line">      &quot;hidden&quot;: false,</span><br><span class="line">      &quot;isSensitive&quot;: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;output&quot;: &#123;</span><br><span class="line">    &quot;strData_01&quot;: &#123;</span><br><span class="line">      &quot;description&quot;: &quot;æµ‹è¯•&quot;,</span><br><span class="line">      &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">      &quot;isSensitive&quot;: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>åœ¨ ç›®å½•ä¸‹ï¼ŒæŠŠæ‰€æœ‰æ–‡ä»¶æ‰“æˆ zip åŒ…å³å¯</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd kingtest_release &amp;&amp; zip kingtest_release.zip kingtest task.json</span><br></pre></td></tr></table></figure>

<p>zipåŒ…ç»“æ„ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">|- kingtest_release.zip         # å‘å¸ƒåŒ…</span><br><span class="line">   |- kingtest                  # æ’ä»¶æ‰§è¡ŒåŒ…</span><br><span class="line">   |- task.json                 # æ’ä»¶é…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<p>æ‰“åŒ…å®Œæˆåï¼Œåœ¨æ’ä»¶å·¥ä½œå°æå•å‘å¸ƒï¼Œå³å¯æµ‹è¯•æˆ–å‘å¸ƒæ’ä»¶</p>
<h1 id="ä¸Šä¼ ä¸€ä¸ªæµæ°´çº¿æ’ä»¶"><a href="#ä¸Šä¼ ä¸€ä¸ªæµæ°´çº¿æ’ä»¶" class="headerlink" title="ä¸Šä¼ ä¸€ä¸ªæµæ°´çº¿æ’ä»¶"></a>ä¸Šä¼ ä¸€ä¸ªæµæ°´çº¿æ’ä»¶</h1><blockquote>
<p>å¼€å‘å¥½æ’ä»¶ä¹‹åï¼Œé€šè¿‡ç ”å‘å•†åº—å·¥ä½œå°ï¼Œå°†æ’ä»¶å‘å¸ƒåˆ°ç ”å‘å•†åº—ï¼Œæä¾›ç»™ç”¨æˆ·æ·»åŠ åˆ°æµæ°´çº¿ä¸­ä½¿ç”¨ã€‚</p>
</blockquote>
<h2 id="å…¥å£"><a href="#å…¥å£" class="headerlink" title="å…¥å£"></a>å…¥å£</h2><p>åœ¨å·¥ä½œå°åˆ—è¡¨ï¼Œç‚¹å‡»å¦‚ä¸‹å…¥å£å‘èµ·å‘å¸ƒæµç¨‹ï¼š<br><img src="/img_3.png" alt="img_3.png"></p>
<p>é¦–æ¬¡å‘å¸ƒæ—¶ï¼Œå…¥å£åä¸ºä¸Šæ¶<br>åç»­æ›´æ–°ç‰ˆæœ¬æ—¶ï¼Œå…¥å£åä¸ºå‡çº§<br>æˆ–è€…åœ¨æ’ä»¶å‘å¸ƒç®¡ç†-&gt;ç‰ˆæœ¬ç®¡ç†ç•Œé¢å‘èµ·å‘å¸ƒæµç¨‹ï¼š<br><img src="/img_4.png" alt="img_4.png"></p>
<h2 id="å¡«å†™æ’ä»¶ç›¸å…³ä¿¡æ¯-ä¸Šä¼ æ’ä»¶å‘å¸ƒåŒ…"><a href="#å¡«å†™æ’ä»¶ç›¸å…³ä¿¡æ¯-ä¸Šä¼ æ’ä»¶å‘å¸ƒåŒ…" class="headerlink" title="å¡«å†™æ’ä»¶ç›¸å…³ä¿¡æ¯&#x2F;ä¸Šä¼ æ’ä»¶å‘å¸ƒåŒ…"></a>å¡«å†™æ’ä»¶ç›¸å…³ä¿¡æ¯&#x2F;ä¸Šä¼ æ’ä»¶å‘å¸ƒåŒ…</h2><p>ä¸Šæ¶&#x2F;å‡çº§æ’ä»¶æ—¶ï¼Œå¯ä»¥ä¿®æ”¹æ’ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="/img_5.png" alt="img_5.png"></p>
<ol>
<li>é€‚ç”¨ Job ç±»å‹ï¼š</li>
</ol>
<ul>
<li>å’Œæµæ°´çº¿ Job ç±»å‹å¯¹åº”ï¼Œè¯·æŒ‰ç…§æ’ä»¶å®é™…é€‚ç”¨æƒ…å†µé€‰æ‹©</li>
<li>è‹¥é€‰é”™ï¼Œéœ€æ–°å¢ç‰ˆæœ¬ä¿®æ”¹</li>
</ul>
<ol start="2">
<li>å‘å¸ƒåŒ…ï¼š</li>
</ol>
<ul>
<li>task.json ä¸­çš„ atomCode éœ€å’Œ æ–°å¢æ’ä»¶æ—¶å¡«å†™çš„æ ‡è¯†ä¸€è‡´ï¼Œå¦åˆ™ä¸Šä¼ ä¼šå¤±è´¥</li>
</ul>
<h2 id="æµ‹è¯•-å‘å¸ƒæ’ä»¶"><a href="#æµ‹è¯•-å‘å¸ƒæ’ä»¶" class="headerlink" title="æµ‹è¯•&#x2F;å‘å¸ƒæ’ä»¶"></a>æµ‹è¯•&#x2F;å‘å¸ƒæ’ä»¶</h2><blockquote>
<p>å¡«å†™å¥½ä¿¡æ¯ï¼Œæäº¤åï¼Œè¿›å…¥å‘å¸ƒæµç¨‹ï¼Œå¯ä»¥æµ‹è¯•-&gt;é‡æ–°ä¼ åŒ…-&gt;æµ‹è¯•ï¼Œç›´è‡³æ’ä»¶æ»¡è¶³é¢„æœŸåï¼Œæ‰‹åŠ¨ç»§ç»­æµç¨‹å°†æ’ä»¶å‘å¸ƒåˆ°ç ”å‘å•†åº—</p>
</blockquote>
<p><img src="/img_6.png" alt="img_6.png"></p>
<ol>
<li>æµ‹è¯•ï¼šç‚¹å‡»åè·³è½¬åˆ°æ’ä»¶è°ƒè¯•é¡¹ç›®çš„æµæ°´çº¿æœåŠ¡ä¸‹ï¼Œå¯ä»¥å°†å½“å‰æ’ä»¶æ·»åŠ åˆ°æµæ°´çº¿ï¼ŒéªŒè¯ UIã€åŠŸèƒ½æ˜¯å¦æ»¡è¶³é¢„æœŸ</li>
<li>é‡æ–°ä¼ åŒ…ï¼šå½“æµ‹è¯•å‘ç°é—®é¢˜ï¼Œä¿®å¤åï¼Œé‡æ–°ä¸Šä¼ å‘å¸ƒåŒ…ï¼Œå†æ¬¡è¿›è¡Œæµ‹è¯•</li>
<li>ç»§ç»­ï¼šæµ‹è¯• OKï¼Œæ»¡è¶³é¢„æœŸåï¼Œç¡®è®¤æäº¤å‘å¸ƒ</li>
<li>å–æ¶ˆå‘å¸ƒï¼šå‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œéšæ—¶å¯ä»¥ç»ˆæ­¢å‘å¸ƒ</li>
</ol>
<h2 id="é‡è§çš„å‡ ä¸ªé”™è¯¯"><a href="#é‡è§çš„å‡ ä¸ªé”™è¯¯" class="headerlink" title="é‡è§çš„å‡ ä¸ªé”™è¯¯"></a>é‡è§çš„å‡ ä¸ªé”™è¯¯</h2><h3 id="æ— æƒé™æ‰§è¡Œ"><a href="#æ— æƒé™æ‰§è¡Œ" class="headerlink" title="æ— æƒé™æ‰§è¡Œ"></a>æ— æƒé™æ‰§è¡Œ</h3><p>åœ¨æµ‹è¯•ä¸­é‡è§ä¸€ä¸ªé—®é¢˜ï¼šæ— æƒé™æ‰§è¡Œ<br><img src="/img_7.png" alt="img_7.png"></p>
<p>åœ¨<code>execution-&gt;demands</code>å¢åŠ ä¸€ä¸ªå‘½ä»¤<code>chmod +x kingtest</code>å³å¯è§£å†³</p>
<h3 id="å‘å¸ƒè¿›åº¦é‡Œé‡æ–°ä¼ åŒ…æŒç»­æŠ¥é”™task-jsonæ ¼å¼é”™è¯¯"><a href="#å‘å¸ƒè¿›åº¦é‡Œé‡æ–°ä¼ åŒ…æŒç»­æŠ¥é”™task-jsonæ ¼å¼é”™è¯¯" class="headerlink" title="å‘å¸ƒè¿›åº¦é‡Œé‡æ–°ä¼ åŒ…æŒç»­æŠ¥é”™task.jsonæ ¼å¼é”™è¯¯"></a>å‘å¸ƒè¿›åº¦é‡Œé‡æ–°ä¼ åŒ…æŒç»­æŠ¥é”™task.jsonæ ¼å¼é”™è¯¯</h3><p>è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œåœ¨å‘å¸ƒè¿›åº¦é‡Œé‡æ–°ä¼ åŒ…æ—¶ï¼Œä¸€ç›´æŠ¥é”™task.jsonæ ¼å¼é”™è¯¯ï¼Œä½†å®é™…æ ¼å¼æ˜¯å¯¹çš„ï¼<br>è§¦å‘çš„åŸå› æš‚ä¸çŸ¥é“ï¼Œä½†æ˜¯ç¡®å®æ˜¯ä¸€ä¸ªéšè—çš„bugã€‚<br><img src="/img_8.png" alt="img_8.png"></p>
<p>ç›´æ¥ç‚¹å‡»ç»§ç»­ï¼Œç„¶åèµ°å‡çº§æ’ä»¶çš„æ–¹å¼å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚</p>
<h3 id="cannot-execute-binary-file-Exec-format-error"><a href="#cannot-execute-binary-file-Exec-format-error" class="headerlink" title="cannot execute binary file: Exec format error"></a>cannot execute binary file: Exec format error</h3><p>è¿™é‡Œçš„é—®é¢˜æ˜¯æˆ‘é€ æˆçš„ï¼Œæœ€åˆæˆ‘åœ¨macç¯å¢ƒä¸‹ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå‘½ä»¤æ˜¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">macä¸‹æ‰§è¡Œ</span></span><br><span class="line">go build -o bin/kingtest</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æ’ä»¶é‡Œé€‰æ‹©çš„ç¼–è¯‘ç¯å¢ƒæ˜¯linuxã€‚<br><img src="/img_9.png" alt="img_9.png"></p>
<p>è§£å†³æ–¹å¼ï¼šè®©æ’ä»¶é€‰æ‹©çš„ç¼–è¯‘ç¯å¢ƒå’Œå¯æ‰§è¡Œæ–‡ä»¶çš„å¹³å°ç»Ÿä¸€ã€‚<br>æˆ‘è¿™é‡Œé€‰æ‹©é‡æ–°ç¼–è¯‘ä¸‹å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé‡‡ç”¨åœ¨macå¹³å°äº¤å‰ç¼–è¯‘linuxå¹³å°å¯æ‰§è¡Œæ–‡ä»¶çš„æ–¹å¼ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">GO111MODULE=on GOOS=linux GOARCH=amd64 go build -o bin/kingtest</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥æ–°å»ºä¸€ä¸ªæ’ä»¶ï¼Œç¼–è¯‘ç¯å¢ƒé€‰æ‹©macã€‚</p>
<h2 id="è¿è¡Œç»“æœ"><a href="#è¿è¡Œç»“æœ" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h2><p>æµæ°´çº¿ç»“æœï¼š<br><img src="/img_10.png" alt="img_10.png"></p>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[Plugin info]</span><br><span class="line">=====================================================================</span><br><span class="line">Task           : king-test</span><br><span class="line">Description    : bkæ’ä»¶æµ‹è¯•</span><br><span class="line">Version        : 1.0.3</span><br><span class="line">Author         : huari</span><br><span class="line">Help           : More Information</span><br><span class="line">=====================================================================</span><br><span class="line">-----</span><br><span class="line">[Input]</span><br><span class="line">input(normal): (æ¬¢è¿è¯)greeting=Glad to see you</span><br><span class="line">input(normal): (å§“å)userName=Mr. Huang</span><br><span class="line">-----</span><br><span class="line">[Install plugin]</span><br><span class="line">-----</span><br><span class="line">start run chmod +x kingtest</span><br><span class="line">stop run chmod +x kingtest</span><br><span class="line">atom-demo-glang starts</span><br><span class="line">æè¿°</span><br><span class="line">userName:  Mr. Huang</span><br><span class="line"></span><br><span class="line">BuildInfo:</span><br><span class="line">Project Name:      GOPS</span><br><span class="line">Pipeline Id:       p-8967ed52b08847c8a5b0140937db0975</span><br><span class="line">Pipeline Name:     king-test</span><br><span class="line">Pipeline Version:  11</span><br><span class="line">Build Id:          b-78947b5c39f34b32bbafb803042d1e22</span><br><span class="line">Build Num:         15</span><br><span class="line">Start Type:        MANUAL</span><br><span class="line">Start UserId:      huari</span><br><span class="line">Start UserName:    huari</span><br><span class="line">Start Time:        1733298107286</span><br><span class="line">Workspace:         /data/devops/workspace</span><br><span class="line"></span><br><span class="line">Glad to see youï¼ŒMr. Huang</span><br><span class="line">start build</span><br><span class="line">write result.dat</span><br><span class="line">write report.htm</span><br><span class="line">build done</span><br><span class="line">[Output]</span><br><span class="line">1 file match: </span><br><span class="line">  /data/devops/workspace/result.dat</span><br><span class="line">prepare to upload 7 B</span><br><span class="line">1/1 file(s) finished</span><br><span class="line">output(except): artifactData_02=result.dat</span><br><span class="line">å…¥å£æ–‡ä»¶æ£€æµ‹å®Œæˆ</span><br><span class="line">ä¸Šä¼ è‡ªå®šä¹‰äº§å‡ºç‰©æˆåŠŸï¼Œå…±äº§ç”Ÿäº†1ä¸ªæ–‡ä»¶</span><br><span class="line">output(except): report_01=report.htm</span><br><span class="line">output(normal): strData_01=test</span><br><span class="line">-----</span><br><span class="line"></span><br></pre></td></tr></table></figure>






]]></content>
  </entry>
  <entry>
    <title>Kindæ­å»ºæµ‹è¯•é›†ç¾¤</title>
    <url>/2025/07/kubernetes/Kind%E6%90%AD%E5%BB%BA%E6%B5%8B%E8%AF%95%E9%9B%86%E7%BE%A4/</url>
    <content><![CDATA[]]></content>
  </entry>
</search>
